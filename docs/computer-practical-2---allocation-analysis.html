<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>B Computer Practical 2 - Allocation &amp; Analysis | Clinical Trials 4H</title>
  <meta name="description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="B Computer Practical 2 - Allocation &amp; Analysis | Clinical Trials 4H" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="B Computer Practical 2 - Allocation &amp; Analysis | Clinical Trials 4H" />
  
  <meta name="twitter:description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  

<meta name="author" content="Rachel Oughton" />


<meta name="date" content="2025-01-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="computer-practical-1---missing-data.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Clinical Trials 4H!</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#practical-details"><i class="fa fa-check"></i>Practical details</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#lectures"><i class="fa fa-check"></i>Lectures</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#computer-classes"><i class="fa fa-check"></i>Computer classes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#office-hour"><i class="fa fa-check"></i>Office Hour</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#assessment"><i class="fa fa-check"></i>Assessment</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#books-and-resources"><i class="fa fa-check"></i>Books and resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect-from-this-module"><i class="fa fa-check"></i>What to expect from this module</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-i-expect-from-you"><i class="fa fa-check"></i>What I expect from you</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="rct-intro.html"><a href="rct-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to Clinical Trials</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rct-intro.html"><a href="rct-intro.html#causal-inference-and-clinical-trials"><i class="fa fa-check"></i><b>1.1</b> Causal inference and clinical trials</a></li>
<li class="chapter" data-level="1.2" data-path="rct-intro.html"><a href="rct-intro.html#the-structure-of-a-clinical-trial"><i class="fa fa-check"></i><b>1.2</b> The structure of a clinical trial</a>
<ul>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#the-population-of-eligible-patients"><i class="fa fa-check"></i>The population of eligible patients</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#entry-to-the-trial"><i class="fa fa-check"></i>Entry to the trial</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#allocation-to-groups"><i class="fa fa-check"></i>Allocation to groups</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#comparing-results"><i class="fa fa-check"></i>Comparing results</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#why-bother-with-a-control-group"><i class="fa fa-check"></i>Why bother with a control group?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="rct-intro.html"><a href="rct-intro.html#primout"><i class="fa fa-check"></i><b>1.3</b> The primary outcome</a></li>
<li class="chapter" data-level="1.4" data-path="rct-intro.html"><a href="rct-intro.html#ethical-issues"><i class="fa fa-check"></i><b>1.4</b> Ethical issues</a></li>
<li class="chapter" data-level="1.5" data-path="rct-intro.html"><a href="rct-intro.html#phases-of-clinical-trials"><i class="fa fa-check"></i><b>1.5</b> Phases of clinical trials</a>
<ul>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-zero"><i class="fa fa-check"></i>Phase zero</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-one"><i class="fa fa-check"></i>Phase one</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-two"><i class="fa fa-check"></i>Phase two</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-three"><i class="fa fa-check"></i>Phase three</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-four"><i class="fa fa-check"></i>Phase four</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Part I: Continuous outcome variables</b></span></li>
<li class="chapter" data-level="2" data-path="rct-plan.html"><a href="rct-plan.html"><i class="fa fa-check"></i><b>2</b> Sample size for a normally distributed primary outcome variable</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rct-plan.html"><a href="rct-plan.html#the-treatment-effect"><i class="fa fa-check"></i><b>2.1</b> The treatment effect</a></li>
<li class="chapter" data-level="2.2" data-path="rct-plan.html"><a href="rct-plan.html#reminder-hypothesis-tests-with-a-focus-on-rcts"><i class="fa fa-check"></i><b>2.2</b> Reminder: hypothesis tests (with a focus on RCTs)</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="rct-plan.html"><a href="rct-plan.html#one-tailed-or-two-tailed"><i class="fa fa-check"></i><b>2.2.1</b> One-tailed or two-tailed?</a></li>
<li class="chapter" data-level="2.2.2" data-path="rct-plan.html"><a href="rct-plan.html#insignificant-results"><i class="fa fa-check"></i><b>2.2.2</b> Insignificant results</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="rct-plan.html"><a href="rct-plan.html#sec-measDcont"><i class="fa fa-check"></i><b>2.3</b> Constructing a measure of effect size</a></li>
<li class="chapter" data-level="2.4" data-path="rct-plan.html"><a href="rct-plan.html#sec-power"><i class="fa fa-check"></i><b>2.4</b> Power: If <span class="math inline">\(H_0\)</span> is false</a></li>
<li class="chapter" data-level="2.5" data-path="rct-plan.html"><a href="rct-plan.html#sec-ssformulacont"><i class="fa fa-check"></i><b>2.5</b> A sample size formula</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="alloc.html"><a href="alloc.html"><i class="fa fa-check"></i><b>3</b> Allocation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="alloc.html"><a href="alloc.html#bias"><i class="fa fa-check"></i><b>3.1</b> Bias</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="alloc.html"><a href="alloc.html#where-does-bias-come-from"><i class="fa fa-check"></i><b>3.1.1</b> Where does bias come from?</a></li>
<li class="chapter" data-level="3.1.2" data-path="alloc.html"><a href="alloc.html#implications-for-allocation"><i class="fa fa-check"></i><b>3.1.2</b> Implications for allocation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="alloc.html"><a href="alloc.html#sec-allocation"><i class="fa fa-check"></i><b>3.2</b> Allocation methods</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="alloc.html"><a href="alloc.html#simple-random-allocation"><i class="fa fa-check"></i><b>3.2.1</b> Simple random allocation</a></li>
<li class="chapter" data-level="3.2.2" data-path="alloc.html"><a href="alloc.html#random-permuted-blocks"><i class="fa fa-check"></i><b>3.2.2</b> Random permuted blocks</a></li>
<li class="chapter" data-level="3.2.3" data-path="alloc.html"><a href="alloc.html#bcurn"><i class="fa fa-check"></i><b>3.2.3</b> Biased coin designs and urn schemes</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="alloc.html"><a href="alloc.html#incorporating-baseline-measurements"><i class="fa fa-check"></i><b>3.3</b> Incorporating baseline measurements</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="alloc.html"><a href="alloc.html#stratified-sampling"><i class="fa fa-check"></i><b>3.3.1</b> Stratified sampling</a></li>
<li class="chapter" data-level="3.3.2" data-path="alloc.html"><a href="alloc.html#minimization"><i class="fa fa-check"></i><b>3.3.2</b> Minimization</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="alloc.html"><a href="alloc.html#problems-around-allocation"><i class="fa fa-check"></i><b>3.4</b> Problems around allocation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rct-analysis.html"><a href="rct-analysis.html"><i class="fa fa-check"></i><b>4</b> Analyzing RCT data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rct-analysis.html"><a href="rct-analysis.html#ttest"><i class="fa fa-check"></i><b>4.1</b> Confidence intervals and P-values</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="rct-analysis.html"><a href="rct-analysis.html#what-do-we-do-with-this-outcome"><i class="fa fa-check"></i><b>4.1.1</b> What do we do with this outcome?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="rct-analysis.html"><a href="rct-analysis.html#baseline"><i class="fa fa-check"></i><b>4.2</b> Using baseline values</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rct-analysis.html"><a href="rct-analysis.html#the-variance-of-the-treatment-effect-estimate"><i class="fa fa-check"></i><b>4.2.1</b> The variance of the treatment effect estimate</a></li>
<li class="chapter" data-level="4.2.2" data-path="rct-analysis.html"><a href="rct-analysis.html#a-dodgy-way-to-use-baseline-variables"><i class="fa fa-check"></i><b>4.2.2</b> A dodgy way to use baseline variables</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rct-analysis.html"><a href="rct-analysis.html#analysis-of-covariance-ancova"><i class="fa fa-check"></i><b>4.3</b> Analysis of covariance (ANCOVA)</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rct-analysis.html"><a href="rct-analysis.html#ancovatheory"><i class="fa fa-check"></i><b>4.3.1</b> The theory</a></li>
<li class="chapter" data-level="4.3.2" data-path="rct-analysis.html"><a href="rct-analysis.html#ancova-practice"><i class="fa fa-check"></i><b>4.3.2</b> The practice</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="rct-analysis.html"><a href="rct-analysis.html#some-follow-up-questions."><i class="fa fa-check"></i><b>4.4</b> Some follow-up questions….</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="rct-analysis.html"><a href="rct-analysis.html#didnt-we-say-that-x_t---x_c-was-an-unbiased-estimator-of-tau"><i class="fa fa-check"></i><b>4.4.1</b> Didn’t we say that <span class="math inline">\(X_T - X_C\)</span> was an unbiased estimator of <span class="math inline">\(\tau\)</span>?</a></li>
<li class="chapter" data-level="4.4.2" data-path="rct-analysis.html"><a href="rct-analysis.html#what-if-the-lines-shouldnt-be-parallel-the-unequal-slopes-model"><i class="fa fa-check"></i><b>4.4.2</b> What if the lines shouldn’t be parallel? The unequal slopes model</a></li>
<li class="chapter" data-level="4.4.3" data-path="rct-analysis.html"><a href="rct-analysis.html#can-we-include-any-other-baseline-covariates"><i class="fa fa-check"></i><b>4.4.3</b> Can we include any other baseline covariates?</a></li>
<li class="chapter" data-level="" data-path="rct-analysis.html"><a href="rct-analysis.html#an-important-caution"><i class="fa fa-check"></i>An important caution!</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Computer practicals</b></span></li>
<li class="chapter" data-level="A" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html"><i class="fa fa-check"></i><b>A</b> Computer Practical 1 - Missing data</a>
<ul>
<li class="chapter" data-level="" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#r-practicalities"><i class="fa fa-check"></i>R practicalities</a></li>
<li class="chapter" data-level="A.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#missing-data"><i class="fa fa-check"></i><b>A.1</b> Missing data</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#datasets"><i class="fa fa-check"></i><b>A.1.1</b> Datasets</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#understanding-the-patterns-of-missingness"><i class="fa fa-check"></i><b>A.2</b> Understanding the patterns of missingness</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#visualising-missingness"><i class="fa fa-check"></i><b>A.2.1</b> Visualising missingness</a></li>
<li class="chapter" data-level="A.2.2" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#summary-tables"><i class="fa fa-check"></i><b>A.2.2</b> Summary tables</a></li>
<li class="chapter" data-level="A.2.3" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#mechanisms-of-missingness"><i class="fa fa-check"></i><b>A.2.3</b> Mechanisms of missingness</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#exploring-the-relationship-between-missingness-and-other-variables"><i class="fa fa-check"></i><b>A.3</b> Exploring the relationship between missingness and other variables</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#sec-statsum"><i class="fa fa-check"></i><b>A.3.1</b> Statistical summaries of the effect of missingness</a></li>
<li class="chapter" data-level="A.3.2" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#modelling-missingness"><i class="fa fa-check"></i><b>A.3.2</b> Modelling missingness</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#what-to-do-about-missing-data"><i class="fa fa-check"></i><b>A.4</b> What to do about missing data?!</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#discarding-some-non-missing-data"><i class="fa fa-check"></i><b>A.4.1</b> Discarding some (non-missing) data</a></li>
<li class="chapter" data-level="A.4.2" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#imputing-data"><i class="fa fa-check"></i><b>A.4.2</b> Imputing data</a></li>
<li class="chapter" data-level="A.4.3" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#multiple-imputation"><i class="fa fa-check"></i><b>A.4.3</b> Multiple imputation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html"><i class="fa fa-check"></i><b>B</b> Computer Practical 2 - Allocation &amp; Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#health-warning"><i class="fa fa-check"></i>Health warning!</a>
<ul>
<li class="chapter" data-level="" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#preliminaries"><i class="fa fa-check"></i>Preliminaries</a></li>
<li class="chapter" data-level="" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#r-practicalities-1"><i class="fa fa-check"></i>R practicalities</a></li>
</ul></li>
<li class="chapter" data-level="B.1" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#cp1allocation"><i class="fa fa-check"></i><b>B.1</b> Allocation</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#licorice-gargle-dataset"><i class="fa fa-check"></i><b>B.1.1</b> Licorice gargle dataset</a></li>
<li class="chapter" data-level="B.1.2" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#allocmethods"><i class="fa fa-check"></i><b>B.1.2</b> Allocation methods</a></li>
<li class="chapter" data-level="B.1.3" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#stratifying-the-dataset"><i class="fa fa-check"></i><b>B.1.3</b> Stratifying the dataset</a></li>
<li class="chapter" data-level="B.1.4" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#minimisation"><i class="fa fa-check"></i><b>B.1.4</b> Minimisation</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#cp1analysis"><i class="fa fa-check"></i><b>B.2</b> Analysis</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#polyps-data"><i class="fa fa-check"></i><b>B.2.1</b> Polyps data</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#extension-problems"><i class="fa fa-check"></i><b>B.3</b> Extension problems</a>
<ul>
<li class="chapter" data-level="B.3.1" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#a-simulation-experiment"><i class="fa fa-check"></i><b>B.3.1</b> A simulation experiment!</a></li>
<li class="chapter" data-level="B.3.2" data-path="computer-practical-2---allocation-analysis.html"><a href="computer-practical-2---allocation-analysis.html#treatment-for-maternal-periodontal-disease"><i class="fa fa-check"></i><b>B.3.2</b> Treatment for maternal periodontal disease</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Clinical Trials 4H</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="computer-practical-2---allocation-analysis" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">B</span> Computer Practical 2 - Allocation &amp; Analysis<a href="computer-practical-2---allocation-analysis.html#computer-practical-2---allocation-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This computer practical will cover two main parts:</p>
<ol style="list-style-type: decimal">
<li>Allocation (Section <a href="computer-practical-2---allocation-analysis.html#cp1allocation">B.1</a>)</li>
<li>Analysis (Section (<a href="computer-practical-2---allocation-analysis.html#cp1analysis">B.2</a>)</li>
</ol>
<div id="health-warning" class="section level2 unnumbered hasAnchor">
<h2>Health warning!<a href="computer-practical-2---allocation-analysis.html#health-warning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This practical, particularly the allocation section, is designed to help you investigate the behaviour of the various methods we’ve been looking at. There are lots of things we do here that you couldn’t do in a real trial. For example, you wouldn’t be able to plot the baseline covariates, since you wouldn’t have them all at the start of the allocation process. You also wouldn’t be re-do the allocation lots of times, because in most cases the participants join the trial (and are allocated) sequentially.</p>
<div id="preliminaries" class="section level3 unnumbered hasAnchor">
<h3>Preliminaries<a href="computer-practical-2---allocation-analysis.html#preliminaries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The idea is that you spend roughly half the time on each part, but there is probably more content for allocation. It might be sensible to work through some of the allocation exercises, jump ahead to analysis after a while, then go back to allocation if you have time.</p>
<p>You will need a lot of the techniques covered in this practical for your summative assignments, so consider it a sort of informal formative assignment to finish it if you don’t in class. Or, at the very least, you might need to return to it while working on your summative assignments.</p>
<p>There will be a mixture of full solutions, examples of possible solutions and example code to adapt. If you’re not sure how to do something, please ask!</p>
<p><strong>In the example code, I have used the same names for most objects. In order to store your results and avoid confusion, it will be sensible to name things intelligently! For example, suffix each allocation data frame so that you know which allocation method you used. Create an R file with the commands in that you use, so that you can easily replicate your work.</strong></p>
</div>
<div id="r-practicalities-1" class="section level3 unnumbered hasAnchor">
<h3>R practicalities<a href="computer-practical-2---allocation-analysis.html#r-practicalities-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are many, many packages in R that implement methods for designing and analysing clinical trials (see a list at <a href="https://cran.r-project.org/web/views/ClinicalTrials.html">CRAN task view</a>). We will look at some of these, and will also write our own code for some tasks. Remember that to install a package, you can do</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="computer-practical-2---allocation-analysis.html#cb135-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;&lt;packagename&gt;&quot;</span>)</span></code></pre></div>
<p>If you have problems running R on your laptop, or on the university machines, the most foolproof way might be to use Github codespaces (thanks to Louis Aslett, who developed this for Data Science and Statistical Computing II). You may be familiar with this approach if you did Bayesian Computational Modelling III.</p>
<p>An advantage of this is that you can open the same codespace (the same instance of R) from any computer, so if you plan to work on things (for example your summative assignment, which will involve some R) from more than one computer, this might be ideal.</p>
<p>This requires you to have a github account (you can sign up for free <a href="https://github.com/">here</a>) and there is a short guide to creating a github account <a href="https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.louisaslett.com%2FCourses%2FDSSC%2Fnotes%2Fgithub.html&amp;data=05%7C02%7Cr.h.oughton%40durham.ac.uk%7Ccd09b90284364f8558ba08dc1ccf06f8%7C7250d88b4b684529be44d59a2d8a6f94%7C0%7C0%7C638416922691502641%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=f5gJFI3CJPOQ1P16l%2FIdhtIAgQul7s5BhIPwi4GAyLk%3D&amp;reserved=0">here</a>.</p>
<p><a href="https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcodespaces.new%2Flouisaslett%2Fdssc%3Fquickstart%3D1&amp;data=05%7C02%7Cr.h.oughton%40durham.ac.uk%7Ccd09b90284364f8558ba08dc1ccf06f8%7C7250d88b4b684529be44d59a2d8a6f94%7C0%7C0%7C638416922691485947%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=Lsw6mz0L5G%2FvZoZN29D2FgOyOkPMNboJgXPJt7BMPk8%3D&amp;reserved=0">Direct link to codespace</a></p>
<p><a href="https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.louisaslett.com%2FCourses%2FDSSC%2Fnotes%2Finstallr.html%23codespaces&amp;data=05%7C02%7Cr.h.oughton%40durham.ac.uk%7Ccd09b90284364f8558ba08dc1ccf06f8%7C7250d88b4b684529be44d59a2d8a6f94%7C0%7C0%7C638416922691495230%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=hNtp7fT0qZWiQXRwEOUXbMvPWxy1jMtsCd9J7nXlAug%3D&amp;reserved=0">Instructions for how to use codespace</a></p>
</div>
</div>
<div id="cp1allocation" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">B.1</span> Allocation<a href="computer-practical-2---allocation-analysis.html#cp1allocation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll make use of several packages in this section. Installing them all now should hopefully prevent it from disrupting your flow! We’ll load them as we go along.</p>
<p><strong>Notice that where there are code snippets like this one that you want to copy directly, you can hover your cursor in the top right of the code box and a ‘copy’ icon will appear.</strong></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="computer-practical-2---allocation-analysis.html#cb136-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;medicaldata&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;gtsummary&quot;</span>, <span class="st">&quot;Minirand&quot;</span>, </span>
<span id="cb136-2"><a href="computer-practical-2---allocation-analysis.html#cb136-2" tabindex="-1"></a>                   <span class="st">&quot;blockrand&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;randomizeR&quot;</span>))</span></code></pre></div>
<div id="licorice-gargle-dataset" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">B.1.1</span> Licorice gargle dataset<a href="computer-practical-2---allocation-analysis.html#licorice-gargle-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To work with allocation, we will use the <code>licorice_gargle</code> dataset from the package <code>medicaldata</code>, which you can find by</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="computer-practical-2---allocation-analysis.html#cb137-1" tabindex="-1"></a><span class="fu">library</span>(medicaldata)</span>
<span id="cb137-2"><a href="computer-practical-2---allocation-analysis.html#cb137-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;licorice_gargle&quot;</span>)</span></code></pre></div>
<p>You can find out about the dataset by looking at the help file</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="computer-practical-2---allocation-analysis.html#cb138-1" tabindex="-1"></a>?licorice_gargle</span></code></pre></div>
<p>and at <a href="https://www.causeweb.org/tshs/licorice-gargle/">this website</a>, and if you’re feeling really keen you can even read the original paper: <span class="citation">Ruetzler et al. (<a href="#ref-ruetzler2013randomized">2013</a>)</span> (but please don’t do any of that now!).</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-48" class="exercise"><strong>Exercise B.1  </strong></span>Of the 19 columns, how many are baseline characteristics that we could use in the allocation?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-49" class="solution"><em>Solution</em>. </span>In this dataset the baseline characteristics are helpfully prefixed by <code>preOp</code>, so there are seven baseline characteristics.</p>
<pre><code>## [1] &quot;preOp_gender&quot;     &quot;preOp_asa&quot;        &quot;preOp_calcBMI&quot;    &quot;preOp_age&quot;       
## [5] &quot;preOp_mallampati&quot; &quot;preOp_smoking&quot;    &quot;preOp_pain&quot;</code></pre>
</div>
</details>
<p>In order to be able to work with the dataset, we need to convert several of the columns to factor variables (you can see by looking at the structure <code>str(licorice_gargle)</code> that all columns are numeric to begin with), so run the following code to convert the necessary columns to factors, and to restrict the dataset to only the columns we’re interested in.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="computer-practical-2---allocation-analysis.html#cb140-1" tabindex="-1"></a>lic_garg <span class="ot">=</span> licorice_gargle[ ,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb140-2"><a href="computer-practical-2---allocation-analysis.html#cb140-2" tabindex="-1"></a><span class="co"># vector of names of columns to be coerced to factor</span></span>
<span id="cb140-3"><a href="computer-practical-2---allocation-analysis.html#cb140-3" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;preOp_gender&quot;</span>, <span class="st">&quot;preOp_asa&quot;</span>,  </span>
<span id="cb140-4"><a href="computer-practical-2---allocation-analysis.html#cb140-4" tabindex="-1"></a><span class="st">&quot;preOp_mallampati&quot;</span>, <span class="st">&quot;preOp_smoking&quot;</span>, <span class="st">&quot;preOp_pain&quot;</span>, <span class="st">&quot;treat&quot;</span>)</span>
<span id="cb140-5"><a href="computer-practical-2---allocation-analysis.html#cb140-5" tabindex="-1"></a><span class="co"># convert each of those columns to factors</span></span>
<span id="cb140-6"><a href="computer-practical-2---allocation-analysis.html#cb140-6" tabindex="-1"></a>lic_garg[cols] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lic_garg[cols], factor) </span>
<span id="cb140-7"><a href="computer-practical-2---allocation-analysis.html#cb140-7" tabindex="-1"></a></span>
<span id="cb140-8"><a href="computer-practical-2---allocation-analysis.html#cb140-8" tabindex="-1"></a><span class="co"># Check the result:</span></span>
<span id="cb140-9"><a href="computer-practical-2---allocation-analysis.html#cb140-9" tabindex="-1"></a><span class="fu">str</span>(lic_garg)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    235 obs. of  8 variables:
##  $ preOp_gender    : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ preOp_asa       : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 3 2 2 2 1 2 3 2 3 3 ...
##  $ preOp_calcBMI   : num  33 23.7 26.8 28.4 30.4 ...
##  $ preOp_age       : num  67 76 58 59 73 61 66 61 83 69 ...
##  $ preOp_mallampati: Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 2 2 2 2 1 3 1 2 1 2 ...
##  $ preOp_smoking   : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 2 1 1 2 1 1 1 1 3 ...
##  $ preOp_pain      : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ treat           : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 2 2 2 2 2 2 2 2 ...</code></pre>
<div id="demographic-tables" class="section level4 hasAnchor" number="6.1.1.1">
<h4><span class="header-section-number">B.1.1.1</span> Demographic tables<a href="computer-practical-2---allocation-analysis.html#demographic-tables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For every allocation, we’ll want to see a summary table of how the patients are distributed between the groups. In this practical we’ll use the function <code>tbl_summary</code> from <code>gtsummary</code>, but there are plenty of other ways to create nice tables around clinical trials (for example the package <code>table1</code> and <code>atable</code>).</p>
<p>Notice that the licorice gargle data contains the allocation used in the trial, so we can create a table summarising the participants in each group.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="computer-practical-2---allocation-analysis.html#cb142-1" tabindex="-1"></a><span class="fu">tbl_summary</span>(lic_garg, <span class="at">by =</span> <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
<div id="qdvxesvwhc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qdvxesvwhc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qdvxesvwhc thead, #qdvxesvwhc tbody, #qdvxesvwhc tfoot, #qdvxesvwhc tr, #qdvxesvwhc td, #qdvxesvwhc th {
  border-style: none;
}

#qdvxesvwhc p {
  margin: 0;
  padding: 0;
}

#qdvxesvwhc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qdvxesvwhc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qdvxesvwhc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qdvxesvwhc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qdvxesvwhc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qdvxesvwhc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdvxesvwhc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qdvxesvwhc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qdvxesvwhc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qdvxesvwhc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qdvxesvwhc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qdvxesvwhc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qdvxesvwhc .gt_spanner_row {
  border-bottom-style: hidden;
}

#qdvxesvwhc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qdvxesvwhc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qdvxesvwhc .gt_from_md > :first-child {
  margin-top: 0;
}

#qdvxesvwhc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qdvxesvwhc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qdvxesvwhc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qdvxesvwhc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qdvxesvwhc .gt_row_group_first td {
  border-top-width: 2px;
}

#qdvxesvwhc .gt_row_group_first th {
  border-top-width: 2px;
}

#qdvxesvwhc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdvxesvwhc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qdvxesvwhc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qdvxesvwhc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdvxesvwhc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdvxesvwhc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qdvxesvwhc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qdvxesvwhc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qdvxesvwhc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qdvxesvwhc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qdvxesvwhc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdvxesvwhc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qdvxesvwhc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qdvxesvwhc .gt_left {
  text-align: left;
}

#qdvxesvwhc .gt_center {
  text-align: center;
}

#qdvxesvwhc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qdvxesvwhc .gt_font_normal {
  font-weight: normal;
}

#qdvxesvwhc .gt_font_bold {
  font-weight: bold;
}

#qdvxesvwhc .gt_font_italic {
  font-style: italic;
}

#qdvxesvwhc .gt_super {
  font-size: 65%;
}

#qdvxesvwhc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qdvxesvwhc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qdvxesvwhc .gt_indent_1 {
  text-indent: 5px;
}

#qdvxesvwhc .gt_indent_2 {
  text-indent: 10px;
}

#qdvxesvwhc .gt_indent_3 {
  text-indent: 15px;
}

#qdvxesvwhc .gt_indent_4 {
  text-indent: 20px;
}

#qdvxesvwhc .gt_indent_5 {
  text-indent: 25px;
}

#qdvxesvwhc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qdvxesvwhc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="label"><span class='gt_from_md'><strong>Characteristic</strong></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="stat_1"><span class='gt_from_md'><strong>0</strong><br />
N = 117</span><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="stat_2"><span class='gt_from_md'><strong>1</strong><br />
N = 118</span><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">preOp_gender</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    0</td>
<td headers="stat_1" class="gt_row gt_center">73 (62%)</td>
<td headers="stat_2" class="gt_row gt_center">69 (58%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">44 (38%)</td>
<td headers="stat_2" class="gt_row gt_center">49 (42%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_asa</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">19 (16%)</td>
<td headers="stat_2" class="gt_row gt_center">22 (19%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2</td>
<td headers="stat_1" class="gt_row gt_center">67 (57%)</td>
<td headers="stat_2" class="gt_row gt_center">67 (57%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    3</td>
<td headers="stat_1" class="gt_row gt_center">31 (26%)</td>
<td headers="stat_2" class="gt_row gt_center">29 (25%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_calcBMI</td>
<td headers="stat_1" class="gt_row gt_center">26.1 (22.4, 28.1)</td>
<td headers="stat_2" class="gt_row gt_center">25.7 (22.7, 28.6)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_age</td>
<td headers="stat_1" class="gt_row gt_center">63 (45, 68)</td>
<td headers="stat_2" class="gt_row gt_center">61 (48, 68)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_mallampati</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">31 (26%)</td>
<td headers="stat_2" class="gt_row gt_center">39 (33%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2</td>
<td headers="stat_1" class="gt_row gt_center">69 (59%)</td>
<td headers="stat_2" class="gt_row gt_center">66 (56%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    3</td>
<td headers="stat_1" class="gt_row gt_center">16 (14%)</td>
<td headers="stat_2" class="gt_row gt_center">13 (11%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    4</td>
<td headers="stat_1" class="gt_row gt_center">1 (0.9%)</td>
<td headers="stat_2" class="gt_row gt_center">0 (0%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_smoking</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">45 (38%)</td>
<td headers="stat_2" class="gt_row gt_center">45 (38%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2</td>
<td headers="stat_1" class="gt_row gt_center">36 (31%)</td>
<td headers="stat_2" class="gt_row gt_center">36 (31%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    3</td>
<td headers="stat_1" class="gt_row gt_center">36 (31%)</td>
<td headers="stat_2" class="gt_row gt_center">37 (31%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_pain</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    0</td>
<td headers="stat_1" class="gt_row gt_center">115 (98%)</td>
<td headers="stat_2" class="gt_row gt_center">118 (100%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">2 (1.7%)</td>
<td headers="stat_2" class="gt_row gt_center">0 (0%)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="3"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> <span class='gt_from_md'>n (%); Median (Q1, Q3)</span></td>
    </tr>
  </tfoot>
</table>
</div>
<p>Notice that we can also save this as an object and access the individual sub-tables, for example</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="computer-practical-2---allocation-analysis.html#cb143-1" tabindex="-1"></a>rb_tab <span class="ot">=</span> <span class="fu">randbalance</span>(</span>
<span id="cb143-2"><a href="computer-practical-2---allocation-analysis.html#cb143-2" tabindex="-1"></a>  <span class="at">trt =</span> lic_garg<span class="sc">$</span>treat, </span>
<span id="cb143-3"><a href="computer-practical-2---allocation-analysis.html#cb143-3" tabindex="-1"></a>  <span class="at">covmat =</span> lic_garg[,<span class="sc">-</span><span class="dv">8</span>], </span>
<span id="cb143-4"><a href="computer-practical-2---allocation-analysis.html#cb143-4" tabindex="-1"></a>  <span class="at">ntrt=</span><span class="dv">2</span>, </span>
<span id="cb143-5"><a href="computer-practical-2---allocation-analysis.html#cb143-5" tabindex="-1"></a>  <span class="at">trtseq =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>))</span>
<span id="cb143-6"><a href="computer-practical-2---allocation-analysis.html#cb143-6" tabindex="-1"></a>rb_tab<span class="sc">$</span>preOp_gender</span></code></pre></div>
<pre><code>##    
## trt  0  1
##   0 73 44
##   1 69 49</code></pre>
<p>There are also packages with functions to output these demographic tables formatted for use in latex documents, for example <a href="https://journal.r-project.org/archive/2019/RJ-2019-001/RJ-2019-001.pdf"><code>atable</code></a>.</p>
</div>
<div id="binning-continuous-variables" class="section level4 hasAnchor" number="6.1.1.2">
<h4><span class="header-section-number">B.1.1.2</span> Binning continuous variables<a href="computer-practical-2---allocation-analysis.html#binning-continuous-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Before we can use any of our allocation methods, we’re going to need to bin the two numeric variables <code>preOp_age</code> and <code>preOp_calcBMI</code>. The sort of information we’d be likely to get pre-trial (the point at which we need to decide on the bins) would be</p>
<ul>
<li>The study was open to all adults (aged 18+), but <code>preOp_age</code> was likely to centre around aged 60.</li>
<li><code>preOp_BMI</code> was expected to have mean 26 and standard deviation around 4.5.</li>
</ul>
<div class="exercise">
<p><span id="exr:unlabeled-div-50" class="exercise"><strong>Exercise B.2  </strong></span>Bin the two variables <code>preOp_age</code> and <code>preOp_calcBMI</code> to convert them into factor variables <code>BMI</code> and <code>age</code>.</p>
<p>Investigate how the bins you have chosen split the actual data - are you pleased with your choices?</p>
<p><em>In the solutions we’ll create a new data frame <code>lg_df</code> with the two new factor variables instead of the original two numeric variables. It might be helpful to you if you make sure your objects and columns are named the same (or else you may need to alter code further into the practical)</em></p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-51" class="solution"><em>Solution</em>. </span>These solutions show you one way to create such factor variables, but if you choose different bins that’s fine!</p>
<p>Based on the information given, one reasonable split for <code>preOp_age</code> would be <span class="math inline">\(&lt;50,\;50-70\)</span> and <span class="math inline">\(&gt;70\)</span>, in which case we could do</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="computer-practical-2---allocation-analysis.html#cb145-1" tabindex="-1"></a>lic_garg<span class="sc">$</span>age[lic_garg<span class="sc">$</span>preOp_age <span class="sc">&lt;</span> <span class="dv">50</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Under 50&quot;</span></span>
<span id="cb145-2"><a href="computer-practical-2---allocation-analysis.html#cb145-2" tabindex="-1"></a>lic_garg<span class="sc">$</span>age[lic_garg<span class="sc">$</span>preOp_age <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> lic_garg<span class="sc">$</span>preOp_age <span class="sc">&lt;</span> <span class="dv">70</span>] <span class="ot">&lt;-</span> <span class="st">&quot;50 to 70&quot;</span></span>
<span id="cb145-3"><a href="computer-practical-2---allocation-analysis.html#cb145-3" tabindex="-1"></a>lic_garg<span class="sc">$</span>age[lic_garg<span class="sc">$</span>preOp_age <span class="sc">&gt;=</span> <span class="dv">70</span>] <span class="ot">&lt;-</span> <span class="st">&quot;70 plus&quot;</span></span>
<span id="cb145-4"><a href="computer-practical-2---allocation-analysis.html#cb145-4" tabindex="-1"></a>lic_garg<span class="sc">$</span>age <span class="ot">=</span> <span class="fu">factor</span>(lic_garg<span class="sc">$</span>age, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Under 50&quot;</span>, <span class="st">&quot;50 to 70&quot;</span>, <span class="st">&quot;70 plus&quot;</span>))</span></code></pre></div>
<p>We can see how the data fall into these categories:</p>
<pre><code>## 
## Under 50 50 to 70  70 plus 
##       67      122       46</code></pre>
<p>These aren’t equal but we have a decent number in each group.</p>
<p>With the BMI measurement, we know that there are predefined boundaries between categories, so it might be sensible to use those. The boundary between ‘medium’ and ‘high’ is usually given as 25, so since that is near our given mean we could use that as the boundary.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="computer-practical-2---allocation-analysis.html#cb147-1" tabindex="-1"></a>lic_garg<span class="sc">$</span>BMI[lic_garg<span class="sc">$</span>preOp_calcBMI <span class="sc">&lt;</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">&quot;medium_or_low&quot;</span></span>
<span id="cb147-2"><a href="computer-practical-2---allocation-analysis.html#cb147-2" tabindex="-1"></a>lic_garg<span class="sc">$</span>BMI[lic_garg<span class="sc">$</span>preOp_calcBMI <span class="sc">&gt;=</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">&quot;high&quot;</span></span>
<span id="cb147-3"><a href="computer-practical-2---allocation-analysis.html#cb147-3" tabindex="-1"></a>lic_garg<span class="sc">$</span>BMI <span class="ot">=</span> <span class="fu">factor</span>(lic_garg<span class="sc">$</span>BMI, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;medium_or_low&quot;</span>, <span class="st">&quot;high&quot;</span>))</span></code></pre></div>
<p>Again, we can see how the participants fall into these bins</p>
<pre><code>## 
## medium_or_low          high 
##            99           136</code></pre>
<p>and the split is fairly even.</p>
<p>Finally, we can select the columns we want from <code>lic_garg</code> to create <code>lg_df</code></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="computer-practical-2---allocation-analysis.html#cb149-1" tabindex="-1"></a>lg_df <span class="ot">=</span> lic_garg[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">8</span>)]</span></code></pre></div>
<p>If you’ve chosen different bins, that’s fine! But it will help you if the column names and data frame names are the same as on this page.</p>
</div>
</details>
</div>
<div id="a-measure-of-imbalance" class="section level4 hasAnchor" number="6.1.1.3">
<h4><span class="header-section-number">B.1.1.3</span> A measure of imbalance<a href="computer-practical-2---allocation-analysis.html#a-measure-of-imbalance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>It will be useful to have a simple numerical summary of how imbalanced an allocation is. We will define the imbalance as in lectures,</p>
<p><span class="math display">\[D(n) = \lvert N_T\left(n\right) - N_C\left(n\right) \rvert \]</span>
This is pretty simple to define in R:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="computer-practical-2---allocation-analysis.html#cb150-1" tabindex="-1"></a>imbalance <span class="ot">=</span> <span class="cf">function</span>(</span>
<span id="cb150-2"><a href="computer-practical-2---allocation-analysis.html#cb150-2" tabindex="-1"></a>    df,   <span class="co"># participant data frame with allocation column included</span></span>
<span id="cb150-3"><a href="computer-practical-2---allocation-analysis.html#cb150-3" tabindex="-1"></a>    alloc <span class="co"># name of allocation column</span></span>
<span id="cb150-4"><a href="computer-practical-2---allocation-analysis.html#cb150-4" tabindex="-1"></a>    ){</span>
<span id="cb150-5"><a href="computer-practical-2---allocation-analysis.html#cb150-5" tabindex="-1"></a>  alloc_vec <span class="ot">=</span> <span class="fu">as.factor</span>(df[ ,<span class="fu">names</span>(df)<span class="sc">==</span>alloc])</span>
<span id="cb150-6"><a href="computer-practical-2---allocation-analysis.html#cb150-6" tabindex="-1"></a>  alloc_lev <span class="ot">=</span> <span class="fu">levels</span>(alloc_vec) <span class="co"># how the treatment groups are coded</span></span>
<span id="cb150-7"><a href="computer-practical-2---allocation-analysis.html#cb150-7" tabindex="-1"></a>  n1 <span class="ot">=</span> <span class="fu">nrow</span>(df[df[alloc]<span class="sc">==</span>alloc_lev[<span class="dv">1</span>],])</span>
<span id="cb150-8"><a href="computer-practical-2---allocation-analysis.html#cb150-8" tabindex="-1"></a>  n2 <span class="ot">=</span> <span class="fu">nrow</span>(df[df[alloc]<span class="sc">==</span>alloc_lev[<span class="dv">2</span>],])</span>
<span id="cb150-9"><a href="computer-practical-2---allocation-analysis.html#cb150-9" tabindex="-1"></a>  <span class="fu">abs</span>(n1<span class="sc">-</span>n2)</span>
<span id="cb150-10"><a href="computer-practical-2---allocation-analysis.html#cb150-10" tabindex="-1"></a>}</span></code></pre></div>
<div class="exercise">
<p><span id="exr:unlabeled-div-52" class="exercise"><strong>Exercise B.3  </strong></span>Use the <code>imbalance</code> function above to find the imbalance in the allocation recorded in the <code>lic_garg</code> dataset.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-53" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="computer-practical-2---allocation-analysis.html#cb151-1" tabindex="-1"></a><span class="fu">imbalance</span>(<span class="at">df =</span> lic_garg, <span class="at">alloc =</span> <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
</details>
</div>
</div>
<div id="allocmethods" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">B.1.2</span> Allocation methods<a href="computer-practical-2---allocation-analysis.html#allocmethods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To mimic the way that participants are recruited sequentially in a trial (which is generally the case), the code for each type of allocation will work its way through the participant data frame, even though this might not be the most efficient way to produce the end result. For the more complex methods we’ll use packages. Feel free to write your own code for the simpler methods if you want to!</p>
<p>We’ll start by performing each method once with the whole dataset, and then go on to include baseline variables, and finally we’ll perform a simulation study.</p>
<div id="simple-random-allocation-1" class="section level4 hasAnchor" number="6.1.2.1">
<h4><span class="header-section-number">B.1.2.1</span> Simple random allocation<a href="computer-practical-2---allocation-analysis.html#simple-random-allocation-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In simple random allocation, each participant is allocated to one of the two trial arms with equal probability.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="computer-practical-2---allocation-analysis.html#cb153-1" tabindex="-1"></a>srs <span class="ot">=</span> <span class="cf">function</span>(</span>
<span id="cb153-2"><a href="computer-practical-2---allocation-analysis.html#cb153-2" tabindex="-1"></a>    df, <span class="co"># DF should be the participant data frame. </span></span>
<span id="cb153-3"><a href="computer-practical-2---allocation-analysis.html#cb153-3" tabindex="-1"></a>        <span class="co"># A column &#39;treat&#39; will be added</span></span>
<span id="cb153-4"><a href="computer-practical-2---allocation-analysis.html#cb153-4" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>) <span class="co"># Levels of treat factor</span></span>
<span id="cb153-5"><a href="computer-practical-2---allocation-analysis.html#cb153-5" tabindex="-1"></a>){</span>
<span id="cb153-6"><a href="computer-practical-2---allocation-analysis.html#cb153-6" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">nrow</span>(df) <span class="co"># number of rows / participants</span></span>
<span id="cb153-7"><a href="computer-practical-2---allocation-analysis.html#cb153-7" tabindex="-1"></a><span class="co"># Create a new column &#39;treat&#39;</span></span>
<span id="cb153-8"><a href="computer-practical-2---allocation-analysis.html#cb153-8" tabindex="-1"></a>  df<span class="sc">$</span>treat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb153-9"><a href="computer-practical-2---allocation-analysis.html#cb153-9" tabindex="-1"></a><span class="co"># work through the rows, randomly allocating patients with probably 1/2</span></span>
<span id="cb153-10"><a href="computer-practical-2---allocation-analysis.html#cb153-10" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb153-11"><a href="computer-practical-2---allocation-analysis.html#cb153-11" tabindex="-1"></a>    df<span class="sc">$</span>treat[i] <span class="ot">=</span> <span class="fu">sample</span>(levels, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb153-12"><a href="computer-practical-2---allocation-analysis.html#cb153-12" tabindex="-1"></a>  }</span>
<span id="cb153-13"><a href="computer-practical-2---allocation-analysis.html#cb153-13" tabindex="-1"></a>  df<span class="sc">$</span>treat <span class="ot">=</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>treat)</span>
<span id="cb153-14"><a href="computer-practical-2---allocation-analysis.html#cb153-14" tabindex="-1"></a>  df</span>
<span id="cb153-15"><a href="computer-practical-2---allocation-analysis.html#cb153-15" tabindex="-1"></a>}</span></code></pre></div>
<div class="exercise">
<p><span id="exr:unlabeled-div-54" class="exercise"><strong>Exercise B.4  </strong></span>Use the function <code>srs</code> above to allocate the patients in the <code>licorice_gargle</code> dataset to groups T or C.</p>
<p>Generate the balance table and imbalance and comment on them.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-55" class="solution"><em>Solution</em>. </span>To allocate the patients, use</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="computer-practical-2---allocation-analysis.html#cb154-1" tabindex="-1"></a>lg_srs <span class="ot">=</span> <span class="fu">srs</span>(</span>
<span id="cb154-2"><a href="computer-practical-2---allocation-analysis.html#cb154-2" tabindex="-1"></a>  <span class="at">df =</span> lg_df[,<span class="sc">-</span><span class="dv">8</span>],</span>
<span id="cb154-3"><a href="computer-practical-2---allocation-analysis.html#cb154-3" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>)</span>
<span id="cb154-4"><a href="computer-practical-2---allocation-analysis.html#cb154-4" tabindex="-1"></a>)</span></code></pre></div>
<p>And to display the balance table</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="computer-practical-2---allocation-analysis.html#cb155-1" tabindex="-1"></a><span class="fu">tbl_summary</span>(lg_srs, <span class="at">by =</span> <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
<div id="ruczazazna" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ruczazazna table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ruczazazna thead, #ruczazazna tbody, #ruczazazna tfoot, #ruczazazna tr, #ruczazazna td, #ruczazazna th {
  border-style: none;
}

#ruczazazna p {
  margin: 0;
  padding: 0;
}

#ruczazazna .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ruczazazna .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ruczazazna .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ruczazazna .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ruczazazna .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ruczazazna .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ruczazazna .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ruczazazna .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ruczazazna .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ruczazazna .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ruczazazna .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ruczazazna .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ruczazazna .gt_spanner_row {
  border-bottom-style: hidden;
}

#ruczazazna .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ruczazazna .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ruczazazna .gt_from_md > :first-child {
  margin-top: 0;
}

#ruczazazna .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ruczazazna .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ruczazazna .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ruczazazna .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ruczazazna .gt_row_group_first td {
  border-top-width: 2px;
}

#ruczazazna .gt_row_group_first th {
  border-top-width: 2px;
}

#ruczazazna .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ruczazazna .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ruczazazna .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ruczazazna .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ruczazazna .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ruczazazna .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ruczazazna .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ruczazazna .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ruczazazna .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ruczazazna .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ruczazazna .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ruczazazna .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ruczazazna .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ruczazazna .gt_left {
  text-align: left;
}

#ruczazazna .gt_center {
  text-align: center;
}

#ruczazazna .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ruczazazna .gt_font_normal {
  font-weight: normal;
}

#ruczazazna .gt_font_bold {
  font-weight: bold;
}

#ruczazazna .gt_font_italic {
  font-style: italic;
}

#ruczazazna .gt_super {
  font-size: 65%;
}

#ruczazazna .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ruczazazna .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ruczazazna .gt_indent_1 {
  text-indent: 5px;
}

#ruczazazna .gt_indent_2 {
  text-indent: 10px;
}

#ruczazazna .gt_indent_3 {
  text-indent: 15px;
}

#ruczazazna .gt_indent_4 {
  text-indent: 20px;
}

#ruczazazna .gt_indent_5 {
  text-indent: 25px;
}

#ruczazazna .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ruczazazna div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="label"><span class='gt_from_md'><strong>Characteristic</strong></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="stat_1"><span class='gt_from_md'><strong>C</strong><br />
N = 103</span><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="stat_2"><span class='gt_from_md'><strong>T</strong><br />
N = 132</span><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">preOp_gender</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    0</td>
<td headers="stat_1" class="gt_row gt_center">61 (59%)</td>
<td headers="stat_2" class="gt_row gt_center">81 (61%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">42 (41%)</td>
<td headers="stat_2" class="gt_row gt_center">51 (39%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_asa</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">14 (14%)</td>
<td headers="stat_2" class="gt_row gt_center">27 (20%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2</td>
<td headers="stat_1" class="gt_row gt_center">68 (66%)</td>
<td headers="stat_2" class="gt_row gt_center">66 (50%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    3</td>
<td headers="stat_1" class="gt_row gt_center">21 (20%)</td>
<td headers="stat_2" class="gt_row gt_center">39 (30%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_mallampati</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">30 (29%)</td>
<td headers="stat_2" class="gt_row gt_center">40 (30%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2</td>
<td headers="stat_1" class="gt_row gt_center">53 (51%)</td>
<td headers="stat_2" class="gt_row gt_center">82 (62%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    3</td>
<td headers="stat_1" class="gt_row gt_center">19 (18%)</td>
<td headers="stat_2" class="gt_row gt_center">10 (7.6%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    4</td>
<td headers="stat_1" class="gt_row gt_center">1 (1.0%)</td>
<td headers="stat_2" class="gt_row gt_center">0 (0%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_smoking</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">38 (37%)</td>
<td headers="stat_2" class="gt_row gt_center">52 (39%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    2</td>
<td headers="stat_1" class="gt_row gt_center">29 (28%)</td>
<td headers="stat_2" class="gt_row gt_center">43 (33%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    3</td>
<td headers="stat_1" class="gt_row gt_center">36 (35%)</td>
<td headers="stat_2" class="gt_row gt_center">37 (28%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">preOp_pain</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    0</td>
<td headers="stat_1" class="gt_row gt_center">102 (99%)</td>
<td headers="stat_2" class="gt_row gt_center">131 (99%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">1 (1.0%)</td>
<td headers="stat_2" class="gt_row gt_center">1 (0.8%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">age</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    Under 50</td>
<td headers="stat_1" class="gt_row gt_center">30 (29%)</td>
<td headers="stat_2" class="gt_row gt_center">37 (28%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    50 to 70</td>
<td headers="stat_1" class="gt_row gt_center">52 (50%)</td>
<td headers="stat_2" class="gt_row gt_center">70 (53%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    70 plus</td>
<td headers="stat_1" class="gt_row gt_center">21 (20%)</td>
<td headers="stat_2" class="gt_row gt_center">25 (19%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">BMI</td>
<td headers="stat_1" class="gt_row gt_center"><br /></td>
<td headers="stat_2" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    medium_or_low</td>
<td headers="stat_1" class="gt_row gt_center">43 (42%)</td>
<td headers="stat_2" class="gt_row gt_center">56 (42%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    high</td>
<td headers="stat_1" class="gt_row gt_center">60 (58%)</td>
<td headers="stat_2" class="gt_row gt_center">76 (58%)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="3"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> <span class='gt_from_md'>n (%)</span></td>
    </tr>
  </tfoot>
</table>
</div>
<p>To find the imbalance, the command is</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="computer-practical-2---allocation-analysis.html#cb156-1" tabindex="-1"></a><span class="fu">imbalance</span>(lg_srs, <span class="at">alloc =</span> <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 29</code></pre>
<p>Since this uses the <code>sample</code> function, and we didn’t set a seed, you may well have got a different allocation (and therefore imbalance).</p>
</div>
</details>
</div>
<div id="randomly-permuted-blocks" class="section level4 hasAnchor" number="6.1.2.2">
<h4><span class="header-section-number">B.1.2.2</span> Randomly permuted blocks<a href="computer-practical-2---allocation-analysis.html#randomly-permuted-blocks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We will do this with the package <code>blockrand</code>.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="computer-practical-2---allocation-analysis.html#cb158-1" tabindex="-1"></a><span class="fu">library</span>(blockrand)</span></code></pre></div>
<p>The function for generating RPB designs is also called <code>blockrand</code>. The default for the function <code>blockrand</code> is that it will randomly vary block length within <span class="math inline">\(\left\lbrace 2,\,4,\,6,\,8 \right\rbrace\)</span>.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-56" class="exercise"><strong>Exercise B.5  </strong></span>Try playing around with the function <code>blockrand</code>, for example starting with</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="computer-practical-2---allocation-analysis.html#cb159-1" tabindex="-1"></a><span class="fu">blockrand</span>(<span class="at">n=</span><span class="dv">100</span>)</span></code></pre></div>
<p>Can you generate an allocation for the <code>licorice_gargle</code> data (remember our data frame is now <code>lg_df</code>) and produce the balance table?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-57" class="solution"><em>Solution</em>. </span>There are 235 rows/participants in <code>lg_df</code>, and to keep consistency we would like the levels of our treatment to be <code>"T"</code> and <code>"C"</code>. Therefore we can do</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="computer-practical-2---allocation-analysis.html#cb160-1" tabindex="-1"></a>rpb_lg <span class="ot">=</span> <span class="fu">blockrand</span>(<span class="at">n=</span><span class="dv">235</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>))</span></code></pre></div>
<p>Notice that this doesn’t have 235 rows: the <code>blockrand</code> function will always finish after a whole block.</p>
<p>Let’s add this to our participant data to create a new data frame <code>lg_rpb</code>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="computer-practical-2---allocation-analysis.html#cb161-1" tabindex="-1"></a><span class="co"># create the new data frame, a copy of lg_df</span></span>
<span id="cb161-2"><a href="computer-practical-2---allocation-analysis.html#cb161-2" tabindex="-1"></a>lg_rpb <span class="ot">=</span> lg_df  </span>
<span id="cb161-3"><a href="computer-practical-2---allocation-analysis.html#cb161-3" tabindex="-1"></a></span>
<span id="cb161-4"><a href="computer-practical-2---allocation-analysis.html#cb161-4" tabindex="-1"></a><span class="co"># Replace the original treat column with the RPB treatment column</span></span>
<span id="cb161-5"><a href="computer-practical-2---allocation-analysis.html#cb161-5" tabindex="-1"></a><span class="co"># Using only the first 235 allocations</span></span>
<span id="cb161-6"><a href="computer-practical-2---allocation-analysis.html#cb161-6" tabindex="-1"></a>lg_rpb<span class="sc">$</span>treat <span class="ot">=</span> rpb_lg<span class="sc">$</span>treatment[<span class="dv">1</span><span class="sc">:</span><span class="dv">235</span>]</span></code></pre></div>
<p>Then we can generate the demographic table as before:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="computer-practical-2---allocation-analysis.html#cb162-1" tabindex="-1"></a><span class="fu">tbl_summary</span>(lg_rpb, <span class="at">by =</span> <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
<p>and calculate the imbalance</p>
<pre><code>## [1] 1</code></pre>
</div>
</details>
<p>The package <code>blockrand</code> contains a function <code>plotblockrand</code>, which outputs PDFs of randomization cards, ready to be printed and put into envelopes!</p>
</div>
<div id="biased-coin-designs-1" class="section level4 hasAnchor" number="6.1.2.3">
<h4><span class="header-section-number">B.1.2.3</span> Biased coin designs<a href="computer-practical-2---allocation-analysis.html#biased-coin-designs-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can write code for a biased coin design by adapting the <code>srs</code> function above, setting <span class="math inline">\(p=\frac{2}{3}\)</span> by default as per <span class="citation">Efron (<a href="#ref-efron1971forcing">1971</a>)</span>.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="computer-practical-2---allocation-analysis.html#cb164-1" tabindex="-1"></a>biased_coin <span class="ot">=</span> <span class="cf">function</span>(</span>
<span id="cb164-2"><a href="computer-practical-2---allocation-analysis.html#cb164-2" tabindex="-1"></a>    data,</span>
<span id="cb164-3"><a href="computer-practical-2---allocation-analysis.html#cb164-3" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>),</span>
<span id="cb164-4"><a href="computer-practical-2---allocation-analysis.html#cb164-4" tabindex="-1"></a>    <span class="at">p=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb164-5"><a href="computer-practical-2---allocation-analysis.html#cb164-5" tabindex="-1"></a>){</span>
<span id="cb164-6"><a href="computer-practical-2---allocation-analysis.html#cb164-6" tabindex="-1"></a>  Dn <span class="ot">=</span> <span class="dv">0</span> <span class="co"># starting value of imbalance</span></span>
<span id="cb164-7"><a href="computer-practical-2---allocation-analysis.html#cb164-7" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">nrow</span>(data)</span>
<span id="cb164-8"><a href="computer-practical-2---allocation-analysis.html#cb164-8" tabindex="-1"></a>  alloc <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb164-9"><a href="computer-practical-2---allocation-analysis.html#cb164-9" tabindex="-1"></a>  </span>
<span id="cb164-10"><a href="computer-practical-2---allocation-analysis.html#cb164-10" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb164-11"><a href="computer-practical-2---allocation-analysis.html#cb164-11" tabindex="-1"></a>    <span class="cf">if</span> (Dn<span class="sc">==</span><span class="dv">0</span>){ <span class="co"># equally balanced</span></span>
<span id="cb164-12"><a href="computer-practical-2---allocation-analysis.html#cb164-12" tabindex="-1"></a>      alloc[i] <span class="ot">=</span> <span class="fu">sample</span>(levels, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>) )</span>
<span id="cb164-13"><a href="computer-practical-2---allocation-analysis.html#cb164-13" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(Dn<span class="sc">&lt;</span><span class="dv">0</span>){ <span class="co"># More allocations to levels[2] up to this point</span></span>
<span id="cb164-14"><a href="computer-practical-2---allocation-analysis.html#cb164-14" tabindex="-1"></a>      alloc[i] <span class="ot">=</span> <span class="fu">sample</span>(levels, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span><span class="fu">c</span>(p, <span class="dv">1</span><span class="sc">-</span>p) )</span>
<span id="cb164-15"><a href="computer-practical-2---allocation-analysis.html#cb164-15" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(Dn<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="co"># More allocations to levels[1] up to this point</span></span>
<span id="cb164-16"><a href="computer-practical-2---allocation-analysis.html#cb164-16" tabindex="-1"></a>      alloc[i] <span class="ot">=</span> <span class="fu">sample</span>(levels, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>p, p) )</span>
<span id="cb164-17"><a href="computer-practical-2---allocation-analysis.html#cb164-17" tabindex="-1"></a>    }</span>
<span id="cb164-18"><a href="computer-practical-2---allocation-analysis.html#cb164-18" tabindex="-1"></a>    <span class="co"># Compute imbalance at this stage</span></span>
<span id="cb164-19"><a href="computer-practical-2---allocation-analysis.html#cb164-19" tabindex="-1"></a>    alloc_to_n <span class="ot">=</span> alloc[<span class="dv">1</span><span class="sc">:</span>i]</span>
<span id="cb164-20"><a href="computer-practical-2---allocation-analysis.html#cb164-20" tabindex="-1"></a>    Dn <span class="ot">=</span> <span class="fu">sum</span>(alloc_to_n<span class="sc">==</span>levels[<span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">sum</span>(alloc_to_n <span class="sc">==</span> levels[<span class="dv">2</span>])</span>
<span id="cb164-21"><a href="computer-practical-2---allocation-analysis.html#cb164-21" tabindex="-1"></a>  }</span>
<span id="cb164-22"><a href="computer-practical-2---allocation-analysis.html#cb164-22" tabindex="-1"></a>  data<span class="sc">$</span>treat <span class="ot">=</span> <span class="fu">as.factor</span>(alloc)</span>
<span id="cb164-23"><a href="computer-practical-2---allocation-analysis.html#cb164-23" tabindex="-1"></a>  data</span>
<span id="cb164-24"><a href="computer-practical-2---allocation-analysis.html#cb164-24" tabindex="-1"></a>}</span></code></pre></div>
<div class="exercise">
<p><span id="exr:unlabeled-div-58" class="exercise"><strong>Exercise B.6  </strong></span>Use the function <code>biased_coin</code> above to allocate patients to the two groups. Produce the demographic table and calculate the imbalance. Try this for some different values of <code>p</code>.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-59" class="solution"><em>Solution</em>. </span>To create a biased coin design with <span class="math inline">\(p=0.9\)</span> (for example), we enter</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="computer-practical-2---allocation-analysis.html#cb165-1" tabindex="-1"></a>lg_bc1 <span class="ot">=</span> <span class="fu">biased_coin</span>(</span>
<span id="cb165-2"><a href="computer-practical-2---allocation-analysis.html#cb165-2" tabindex="-1"></a>  <span class="at">data=</span>lg_df[,<span class="sc">-</span><span class="dv">8</span>],</span>
<span id="cb165-3"><a href="computer-practical-2---allocation-analysis.html#cb165-3" tabindex="-1"></a>  <span class="at">p=</span><span class="fl">0.9</span></span>
<span id="cb165-4"><a href="computer-practical-2---allocation-analysis.html#cb165-4" tabindex="-1"></a>)</span></code></pre></div>
<p>and to produce a balance table:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="computer-practical-2---allocation-analysis.html#cb166-1" tabindex="-1"></a><span class="fu">tbl_summary</span>(lg_bc1, <span class="at">by =</span> <span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
<p>Finally we can find the imbalance:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="computer-practical-2---allocation-analysis.html#cb167-1" tabindex="-1"></a><span class="fu">imbalance</span>(lg_bc1, <span class="at">alloc=</span><span class="st">&quot;treat&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
</details>
</div>
<div id="urn-designs" class="section level4 hasAnchor" number="6.1.2.4">
<h4><span class="header-section-number">B.1.2.4</span> Urn designs<a href="computer-practical-2---allocation-analysis.html#urn-designs" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the urn design, we will use the function <code>udPar</code> from the package <code>randomizeR</code>. We wrote this in lectures as <span class="math inline">\(UD\left(r,s\right)\)</span>, where</p>
<ul>
<li><span class="math inline">\(r\)</span> is the number of balls for each treatment group in the urn to begin with</li>
<li><span class="math inline">\(s\)</span> is the number of balls added per treatment after each allocation</li>
</ul>
<div class="exercise">
<p><span id="exr:unlabeled-div-60" class="exercise"><strong>Exercise B.7  </strong></span>Look at the help file for <code>udPar</code>. Which arguments correspond to <span class="math inline">\(r\)</span> and <span class="math inline">\(s\)</span> (as we called them in Section <a href="alloc.html#bcurn">3.2.3</a>?</p>
</div>
<p>The function <code>udPar</code> creates a model object, storing the parameters for the particular Urn design. To generate sequences of allocations, we use the function <code>genSeq</code></p>
<div class="exercise">
<p><span id="exr:unlabeled-div-61" class="exercise"><strong>Exercise B.8  </strong></span>Create an urn design object using <code>udPar</code> with <span class="math inline">\(r=3,\;s=1\)</span>, set to create enough allocations for the licorice gargle data.</p>
<p>Use the function <code>genSeq</code> to generate a sequence of allocations.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-62" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="computer-practical-2---allocation-analysis.html#cb169-1" tabindex="-1"></a><span class="fu">library</span>(randomizeR)</span>
<span id="cb169-2"><a href="computer-practical-2---allocation-analysis.html#cb169-2" tabindex="-1"></a>ud_31 <span class="ot">=</span> <span class="fu">udPar</span>(<span class="dv">235</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>))</span>
<span id="cb169-3"><a href="computer-practical-2---allocation-analysis.html#cb169-3" tabindex="-1"></a>seq_ud31 <span class="ot">=</span> <span class="fu">genSeq</span>(ud_31)</span></code></pre></div>
<p>The allocation vector is stored as a row in the matrix <code>M</code> which is a slot in the <code>genSeq</code> object (part of the object). You can access it by</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="computer-practical-2---allocation-analysis.html#cb170-1" tabindex="-1"></a>seq_ud31<span class="sc">$</span>M[<span class="dv">1</span>,]</span></code></pre></div>
<pre><code>##   [1] 1 0 1 1 0 0 0 1 0 0 0 1 1 0 1 1 0 1 0 1 0 0 0 1 0 0 1 1 1 1 0 0 0 0 0 1 0 0 1 1 1
##  [42] 1 0 1 0 1 1 0 0 0 1 1 0 1 1 1 0 1 1 1 0 1 1 1 1 0 0 0 0 0 1 1 1 1 0 1 0 0 1 0 1 1
##  [83] 0 1 1 0 1 0 0 0 1 1 0 1 0 1 0 0 1 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 1 0 0 1 0 1
## [124] 1 1 1 0 0 0 1 0 1 1 0 1 1 1 1 1 1 1 1 0 1 0 0 0 1 1 1 0 0 1 1 0 1 1 0 0 0 0 0 0 1
## [165] 1 0 0 0 0 1 1 0 0 0 0 0 1 1 0 1 0 0 1 0 0 1 0 1 1 1 0 0 1 0 0 1 1 0 1 0 1 1 0 0 0
## [206] 0 1 0 1 1 1 0 0 1 0 0 1 1 0 0 0 0 1 1 1 0 0 0 0 0 1 0 1 1 0</code></pre>
<p>The argument <code>r</code> allows you to generate <code>r</code> sequences, in which case the matrix <code>M</code> has <code>r</code> rows.</p>
</div>
</details>
</div>
</div>
<div id="stratifying-the-dataset" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">B.1.3</span> Stratifying the dataset<a href="computer-practical-2---allocation-analysis.html#stratifying-the-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first way we thought about to account for baseline measurements was to use stratified sampling. For this, we split the dataset into a number of strata, within each of which the participants have the same levels of the stratifying factors. For example, in some hypothetical dataset one stratum might contain only women, aged 50-65, with a history of smoking.</p>
<p>Once we have stratified the dataset, we can apply any of the methods above by simply treating the different strata as separate ‘mini-trials’.</p>
<p>An obvious problem with applying stratification to this dataset is the number of strata. We have (if you have the same numbers of levels for <code>age</code> and <code>BMI</code> as I do)</p>
<p><span class="math display">\[2\times{3}\times{4}\times{3}\times{2}\times{3}\times{2} = 864 \]</span>
strata. Even by collecting levels together and so on, we are not going to get down to a sufficiently small number of strata. Therefore we will choose just a couple of covariates to stratify by. For example, gender and smoking status:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="computer-practical-2---allocation-analysis.html#cb172-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb172-2"><a href="computer-practical-2---allocation-analysis.html#cb172-2" tabindex="-1"></a><span class="co"># Add an ID variable so that we can keep track of the order of participants</span></span>
<span id="cb172-3"><a href="computer-practical-2---allocation-analysis.html#cb172-3" tabindex="-1"></a>lg_df<span class="sc">$</span>ID <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lg_df)</span>
<span id="cb172-4"><a href="computer-practical-2---allocation-analysis.html#cb172-4" tabindex="-1"></a><span class="co"># split the data frame according to levels of factors</span></span>
<span id="cb172-5"><a href="computer-practical-2---allocation-analysis.html#cb172-5" tabindex="-1"></a>strat_gen_sm <span class="ot">&lt;-</span> lg_df <span class="sc">%&gt;%</span></span>
<span id="cb172-6"><a href="computer-practical-2---allocation-analysis.html#cb172-6" tabindex="-1"></a>  <span class="fu">group_split</span>(preOp_gender, preOp_smoking) </span></code></pre></div>
<p>will create a list of data frames, one for each combination of <code>preOp_gender</code> and <code>preOp_smoking</code>. In this case there are six data frames, and for example the first (accessed by <code>strat_gen_sm[[1]]</code> contains all participants with <code>preOp_gender</code>=0 and <code>preOp_smoking</code>=1. You can choose different factors to stratify by if you want to!</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-63" class="exercise"><strong>Exercise B.9  </strong></span>Split your group using the code above, choosing two factors to stratify by. How many participants are in each stratum?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-64" class="solution"><em>Solution</em>. </span>We’ll stick with the group as above. To find the numbers of participants in each group we do</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="computer-practical-2---allocation-analysis.html#cb173-1" tabindex="-1"></a>group_sizes <span class="ot">=</span> <span class="fu">sapply</span>(</span>
<span id="cb173-2"><a href="computer-practical-2---allocation-analysis.html#cb173-2" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strat_gen_sm),</span>
<span id="cb173-3"><a href="computer-practical-2---allocation-analysis.html#cb173-3" tabindex="-1"></a>  <span class="cf">function</span>(i){</span>
<span id="cb173-4"><a href="computer-practical-2---allocation-analysis.html#cb173-4" tabindex="-1"></a>    <span class="fu">nrow</span>(strat_gen_sm[[i]])</span>
<span id="cb173-5"><a href="computer-practical-2---allocation-analysis.html#cb173-5" tabindex="-1"></a>  }</span>
<span id="cb173-6"><a href="computer-practical-2---allocation-analysis.html#cb173-6" tabindex="-1"></a>)</span>
<span id="cb173-7"><a href="computer-practical-2---allocation-analysis.html#cb173-7" tabindex="-1"></a>group_sizes</span></code></pre></div>
<pre><code>## [1] 63 47 32 27 25 41</code></pre>
</div>
</details>
<div id="margimbalance" class="section level4 hasAnchor" number="6.1.3.1">
<h4><span class="header-section-number">B.1.3.1</span> Another measure of imbalance<a href="computer-practical-2---allocation-analysis.html#margimbalance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To see how well balanced our allocations are in terms of each covariate, we will define a function summing the marginal imbalance</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="computer-practical-2---allocation-analysis.html#cb175-1" tabindex="-1"></a>marg_imbalance <span class="ot">=</span> <span class="cf">function</span>(</span>
<span id="cb175-2"><a href="computer-practical-2---allocation-analysis.html#cb175-2" tabindex="-1"></a>    df,  <span class="co"># participant data frame, including allocation and all factor variables</span></span>
<span id="cb175-3"><a href="computer-practical-2---allocation-analysis.html#cb175-3" tabindex="-1"></a>    alloc, <span class="co"># name of allocation column</span></span>
<span id="cb175-4"><a href="computer-practical-2---allocation-analysis.html#cb175-4" tabindex="-1"></a>    factors <span class="co"># names of prognostic factors to be included</span></span>
<span id="cb175-5"><a href="computer-practical-2---allocation-analysis.html#cb175-5" tabindex="-1"></a>    ){</span>
<span id="cb175-6"><a href="computer-practical-2---allocation-analysis.html#cb175-6" tabindex="-1"></a>  df <span class="ot">=</span> <span class="fu">as.data.frame</span>(df) <span class="co"># deals with tibbles</span></span>
<span id="cb175-7"><a href="computer-practical-2---allocation-analysis.html#cb175-7" tabindex="-1"></a>  n_fact <span class="ot">=</span> <span class="fu">length</span>(factors) <span class="co"># the numbers of factors</span></span>
<span id="cb175-8"><a href="computer-practical-2---allocation-analysis.html#cb175-8" tabindex="-1"></a>  imb_sum<span class="ot">=</span><span class="dv">0</span>                <span class="co"># a running total of imbalance</span></span>
<span id="cb175-9"><a href="computer-practical-2---allocation-analysis.html#cb175-9" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_fact){     <span class="co"># loop through the factors </span></span>
<span id="cb175-10"><a href="computer-practical-2---allocation-analysis.html#cb175-10" tabindex="-1"></a>    ind_i <span class="ot">=</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(df))[<span class="fu">names</span>(df)<span class="sc">==</span>factors[i]]</span>
<span id="cb175-11"><a href="computer-practical-2---allocation-analysis.html#cb175-11" tabindex="-1"></a>    col_i <span class="ot">=</span> <span class="fu">as.factor</span>(df[ ,ind_i])</span>
<span id="cb175-12"><a href="computer-practical-2---allocation-analysis.html#cb175-12" tabindex="-1"></a>    levels_i <span class="ot">=</span> <span class="fu">levels</span>(col_i)</span>
<span id="cb175-13"><a href="computer-practical-2---allocation-analysis.html#cb175-13" tabindex="-1"></a>    nlevels_i <span class="ot">=</span> <span class="fu">length</span>(levels_i)</span>
<span id="cb175-14"><a href="computer-practical-2---allocation-analysis.html#cb175-14" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nlevels_i){ <span class="co"># loop through the levels of factor i</span></span>
<span id="cb175-15"><a href="computer-practical-2---allocation-analysis.html#cb175-15" tabindex="-1"></a>      <span class="co"># df_ij contains just those entries with level j of factor i</span></span>
<span id="cb175-16"><a href="computer-practical-2---allocation-analysis.html#cb175-16" tabindex="-1"></a>      df_ij <span class="ot">=</span> df[df[ ,ind_i]<span class="sc">==</span>levels_i[j] , ] </span>
<span id="cb175-17"><a href="computer-practical-2---allocation-analysis.html#cb175-17" tabindex="-1"></a>      imb_ij <span class="ot">=</span> <span class="fu">imbalance</span>(<span class="at">df=</span>df_ij, <span class="at">alloc=</span>alloc) <span class="co"># find the imbalance for the sub-data-frame in which factor i has level j</span></span>
<span id="cb175-18"><a href="computer-practical-2---allocation-analysis.html#cb175-18" tabindex="-1"></a>      imb_sum <span class="ot">=</span> imb_sum <span class="sc">+</span> imb_ij</span>
<span id="cb175-19"><a href="computer-practical-2---allocation-analysis.html#cb175-19" tabindex="-1"></a>    }</span>
<span id="cb175-20"><a href="computer-practical-2---allocation-analysis.html#cb175-20" tabindex="-1"></a>  }</span>
<span id="cb175-21"><a href="computer-practical-2---allocation-analysis.html#cb175-21" tabindex="-1"></a>  imb_sum</span>
<span id="cb175-22"><a href="computer-practical-2---allocation-analysis.html#cb175-22" tabindex="-1"></a>}</span></code></pre></div>
<p>For example, to find the marginal imbalance over the gender and age factors, use</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="computer-practical-2---allocation-analysis.html#cb176-1" tabindex="-1"></a><span class="fu">marg_imbalance</span>(<span class="at">df=</span>lg_df, <span class="at">alloc=</span><span class="st">&quot;treat&quot;</span>, <span class="at">factors =</span> <span class="fu">c</span>(<span class="st">&quot;preOp_gender&quot;</span>, <span class="st">&quot;age&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<p><strong>Note that the larger the total number of factor levels, the larger the marginal imbalance will be, so if you’re comparing between methods, make sure you’re including all the same factors!</strong></p>
<div class="exercise">
<p><span id="exr:unlabeled-div-65" class="exercise"><strong>Exercise B.10  </strong></span>Choose a couple of methods from Section <a href="computer-practical-2---allocation-analysis.html#allocmethods">B.1.2</a>, and use them with your stratified dataset.
Use the <code>marg_imbalance</code> function to find the marginal imbalance. Try this for just the factors you stratified by, and for other collections of factors. What do you expect to see?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-66" class="solution"><em>Solution</em>. </span>The code for this will vary, but the basic idea is to work through the individual data sets individually, and apply the functions from Section <a href="computer-practical-2---allocation-analysis.html#allocmethods">B.1.2</a>. One way to do this is by creating a for loop. The code below shows how this would work for simple random sampling, but you can change the function to use whichever method you prefer.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="computer-practical-2---allocation-analysis.html#cb178-1" tabindex="-1"></a><span class="co"># This command creates an empty list, which we will fill with allocation data frames as we go through</span></span>
<span id="cb178-2"><a href="computer-practical-2---allocation-analysis.html#cb178-2" tabindex="-1"></a>alloc_list <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb178-3"><a href="computer-practical-2---allocation-analysis.html#cb178-3" tabindex="-1"></a><span class="co"># The loop works through the stratified data frames, applies SRS to allocate patients</span></span>
<span id="cb178-4"><a href="computer-practical-2---allocation-analysis.html#cb178-4" tabindex="-1"></a><span class="co"># and stores them in alloc_list</span></span>
<span id="cb178-5"><a href="computer-practical-2---allocation-analysis.html#cb178-5" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strat_gen_sm)){</span>
<span id="cb178-6"><a href="computer-practical-2---allocation-analysis.html#cb178-6" tabindex="-1"></a>  alloc_list[[i]] <span class="ot">=</span> <span class="fu">srs</span>(strat_gen_sm[[i]])</span>
<span id="cb178-7"><a href="computer-practical-2---allocation-analysis.html#cb178-7" tabindex="-1"></a>}</span>
<span id="cb178-8"><a href="computer-practical-2---allocation-analysis.html#cb178-8" tabindex="-1"></a><span class="co"># bind all the data frames back together again</span></span>
<span id="cb178-9"><a href="computer-practical-2---allocation-analysis.html#cb178-9" tabindex="-1"></a>alloc_full<span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(alloc_list)</span>
<span id="cb178-10"><a href="computer-practical-2---allocation-analysis.html#cb178-10" tabindex="-1"></a><span class="co"># re-order according to ID variable</span></span>
<span id="cb178-11"><a href="computer-practical-2---allocation-analysis.html#cb178-11" tabindex="-1"></a>alloc_full[<span class="fu">order</span>(alloc_full<span class="sc">$</span>ID),]</span></code></pre></div>
<pre><code>## # A tibble: 235 × 9
##    preOp_gender preOp_asa preOp_mallampati preOp_smoking preOp_pain age      BMI   treat
##    &lt;fct&gt;        &lt;fct&gt;     &lt;fct&gt;            &lt;fct&gt;         &lt;fct&gt;      &lt;fct&gt;    &lt;fct&gt; &lt;fct&gt;
##  1 0            3         2                1             0          50 to 70 high  0    
##  2 0            2         2                2             0          70 plus  medi… 0    
##  3 0            2         2                1             0          50 to 70 high  0    
##  4 0            2         2                1             0          50 to 70 high  1    
##  5 0            1         1                2             0          70 plus  high  0    
##  6 0            2         3                1             0          50 to 70 high  1    
##  7 0            3         1                1             0          50 to 70 high  1    
##  8 0            2         2                1             0          50 to 70 high  1    
##  9 0            3         1                1             0          70 plus  medi… 1    
## 10 0            3         2                3             0          50 to 70 high  0    
## # ℹ 225 more rows
## # ℹ 1 more variable: ID &lt;int&gt;</code></pre>
<p>It would be silly though to do this with SRS - why?</p>
<p>Once you’ve performed the allocation, you can find the demographic tables, imbalance and marginal imbalance as before (with <code>alloc_full</code>, or whatever your is called, as the data frame)</p>
</div>
</details>
</div>
</div>
<div id="minimisation" class="section level3 hasAnchor" number="6.1.4">
<h3><span class="header-section-number">B.1.4</span> Minimisation<a href="computer-practical-2---allocation-analysis.html#minimisation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If we want to try to achieve balance for all prognostic factors, minimisation is a more suitable method. The function <code>Minirand</code> in the package <code>Minirand</code> implements the minimisation algorithm.</p>
<p>Much like we did in lectures (and like we would in a real trial), the function <code>Minirand</code> works from the point of view of having already allocated <span class="math inline">\(j-1\)</span> particpants, and being presented with a <span class="math inline">\(j^{th}\)</span>.</p>
<p>This example code is copied from the function’s help file, but with some extra comments to help you to follow it. It first creates a participant data frame, then allocates the particpants to treatment groups using Minimisation.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="computer-practical-2---allocation-analysis.html#cb180-1" tabindex="-1"></a><span class="do">## Information about the treatment</span></span>
<span id="cb180-2"><a href="computer-practical-2---allocation-analysis.html#cb180-2" tabindex="-1"></a>ntrt <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># There will three treatment groups</span></span>
<span id="cb180-3"><a href="computer-practical-2---allocation-analysis.html#cb180-3" tabindex="-1"></a>trtseq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) <span class="co"># the treatment groups are indexed 1, 2, 3</span></span>
<span id="cb180-4"><a href="computer-practical-2---allocation-analysis.html#cb180-4" tabindex="-1"></a>ratio <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)  <span class="co"># the treatment groups will be allocated in a 2:2:1 ratio</span></span>
<span id="cb180-5"><a href="computer-practical-2---allocation-analysis.html#cb180-5" tabindex="-1"></a></span>
<span id="cb180-6"><a href="computer-practical-2---allocation-analysis.html#cb180-6" tabindex="-1"></a><span class="do">## The next few rows generate the participant data frame</span></span>
<span id="cb180-7"><a href="computer-practical-2---allocation-analysis.html#cb180-7" tabindex="-1"></a>nsample <span class="ot">&lt;-</span> <span class="dv">120</span> <span class="co"># we will have 120 participants</span></span>
<span id="cb180-8"><a href="computer-practical-2---allocation-analysis.html#cb180-8" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">0</span>), nsample, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>)) </span>
<span id="cb180-9"><a href="computer-practical-2---allocation-analysis.html#cb180-9" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">0</span>), nsample, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>))</span>
<span id="cb180-10"><a href="computer-practical-2---allocation-analysis.html#cb180-10" tabindex="-1"></a>c3 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>), nsample, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.33</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>)) </span>
<span id="cb180-11"><a href="computer-practical-2---allocation-analysis.html#cb180-11" tabindex="-1"></a>c4 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">0</span>), nsample, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.33</span>, <span class="fl">0.67</span>)) </span>
<span id="cb180-12"><a href="computer-practical-2---allocation-analysis.html#cb180-12" tabindex="-1"></a>covmat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(c1, c2, c3, c4) <span class="co"># generate the matrix of covariate factors for the subjects</span></span>
<span id="cb180-13"><a href="computer-practical-2---allocation-analysis.html#cb180-13" tabindex="-1"></a><span class="co"># label of the covariates </span></span>
<span id="cb180-14"><a href="computer-practical-2---allocation-analysis.html#cb180-14" tabindex="-1"></a><span class="fu">colnames</span>(covmat) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Gender&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;Hypertension&quot;</span>, <span class="st">&quot;Use of Antibiotics&quot;</span>) </span>
<span id="cb180-15"><a href="computer-practical-2---allocation-analysis.html#cb180-15" tabindex="-1"></a>covwt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="co"># equal weights/importance applied to each factor</span></span>
<span id="cb180-16"><a href="computer-practical-2---allocation-analysis.html#cb180-16" tabindex="-1"></a></span>
<span id="cb180-17"><a href="computer-practical-2---allocation-analysis.html#cb180-17" tabindex="-1"></a><span class="do">## Applying the algorithm - start here if you already have participant data!</span></span>
<span id="cb180-18"><a href="computer-practical-2---allocation-analysis.html#cb180-18" tabindex="-1"></a></span>
<span id="cb180-19"><a href="computer-practical-2---allocation-analysis.html#cb180-19" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, nsample) <span class="co"># Generate a vector to store the results (the allocations)</span></span>
<span id="cb180-20"><a href="computer-practical-2---allocation-analysis.html#cb180-20" tabindex="-1"></a><span class="co"># generate treatment assignment for the 1st subject</span></span>
<span id="cb180-21"><a href="computer-practical-2---allocation-analysis.html#cb180-21" tabindex="-1"></a>res[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">sample</span>(trtseq, <span class="dv">1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> ratio<span class="sc">/</span><span class="fu">sum</span>(ratio)) </span>
<span id="cb180-22"><a href="computer-practical-2---allocation-analysis.html#cb180-22" tabindex="-1"></a><span class="co"># work through the remaining patients sequentially</span></span>
<span id="cb180-23"><a href="computer-practical-2---allocation-analysis.html#cb180-23" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>nsample)</span>
<span id="cb180-24"><a href="computer-practical-2---allocation-analysis.html#cb180-24" tabindex="-1"></a>  {</span>
<span id="cb180-25"><a href="computer-practical-2---allocation-analysis.html#cb180-25" tabindex="-1"></a>  <span class="co"># get treatment assignment sequentially for all subjects</span></span>
<span id="cb180-26"><a href="computer-practical-2---allocation-analysis.html#cb180-26" tabindex="-1"></a>  <span class="co"># The vector res is updated and so all previous allocations are accounted for</span></span>
<span id="cb180-27"><a href="computer-practical-2---allocation-analysis.html#cb180-27" tabindex="-1"></a>  <span class="co"># covmat is the data frame of participant data</span></span>
<span id="cb180-28"><a href="computer-practical-2---allocation-analysis.html#cb180-28" tabindex="-1"></a>    res[j] <span class="ot">&lt;-</span> <span class="fu">Minirand</span>(</span>
<span id="cb180-29"><a href="computer-practical-2---allocation-analysis.html#cb180-29" tabindex="-1"></a>      <span class="at">covmat=</span>covmat, j, <span class="at">covwt=</span>covwt, <span class="at">ratio=</span>ratio, <span class="at">ntrt=</span>ntrt, <span class="at">trtseq=</span>trtseq, <span class="at">method=</span><span class="st">&quot;Range&quot;</span>, <span class="at">result=</span>res, <span class="at">p =</span> <span class="fl">0.9</span></span>
<span id="cb180-30"><a href="computer-practical-2---allocation-analysis.html#cb180-30" tabindex="-1"></a>      )</span>
<span id="cb180-31"><a href="computer-practical-2---allocation-analysis.html#cb180-31" tabindex="-1"></a>}</span>
<span id="cb180-32"><a href="computer-practical-2---allocation-analysis.html#cb180-32" tabindex="-1"></a><span class="do">## Store the allocation vector &#39;res&#39; as &#39;trt1&#39;</span></span>
<span id="cb180-33"><a href="computer-practical-2---allocation-analysis.html#cb180-33" tabindex="-1"></a>trt1 <span class="ot">&lt;-</span> res</span>
<span id="cb180-34"><a href="computer-practical-2---allocation-analysis.html#cb180-34" tabindex="-1"></a></span>
<span id="cb180-35"><a href="computer-practical-2---allocation-analysis.html#cb180-35" tabindex="-1"></a><span class="co"># Display the number of randomized subjects at covariate factors</span></span>
<span id="cb180-36"><a href="computer-practical-2---allocation-analysis.html#cb180-36" tabindex="-1"></a>balance1 <span class="ot">&lt;-</span> <span class="fu">randbalance</span>(trt1, covmat, ntrt, trtseq) </span>
<span id="cb180-37"><a href="computer-practical-2---allocation-analysis.html#cb180-37" tabindex="-1"></a>balance1</span></code></pre></div>
<pre><code>## $Gender
##    
## trt  0  1
##   1 29 18
##   2 30 19
##   3 15  9
## 
## $Age
##    
## trt  0  1
##   1 32 15
##   2 33 16
##   3 15  9
## 
## $Hypertension
##    
## trt  0  1  2
##   1 22  9 16
##   2 23  9 17
##   3 11  4  9
## 
## $`Use of Antibiotics`
##    
## trt  0  1
##   1 27 20
##   2 29 20
##   3 14 10</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="computer-practical-2---allocation-analysis.html#cb182-1" tabindex="-1"></a><span class="co"># Calculate the total imbalance of the allocation</span></span>
<span id="cb182-2"><a href="computer-practical-2---allocation-analysis.html#cb182-2" tabindex="-1"></a><span class="fu">totimbal</span>(<span class="at">trt =</span> trt1, <span class="at">covmat =</span> covmat, <span class="at">covwt =</span> covwt, </span>
<span id="cb182-3"><a href="computer-practical-2---allocation-analysis.html#cb182-3" tabindex="-1"></a><span class="at">ratio =</span> ratio, <span class="at">ntrt =</span> ntrt, <span class="at">trtseq =</span> trtseq, <span class="at">method =</span> <span class="st">&quot;Range&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 1.75</code></pre>
<div class="exercise">
<p><span id="exr:unlabeled-div-67" class="exercise"><strong>Exercise B.11  </strong></span>Adapt the code above to apply the minimisation algorithm to the licorice gargle data. Investigate how balanced the data set is.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-68" class="solution"><em>Solution</em>. </span>Notice in the code above that we only need to start about half way down if we already have a dataset (which we do).</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="computer-practical-2---allocation-analysis.html#cb184-1" tabindex="-1"></a>nsample <span class="ot">=</span> <span class="fu">nrow</span>(lg_df)</span>
<span id="cb184-2"><a href="computer-practical-2---allocation-analysis.html#cb184-2" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, nsample)</span>
<span id="cb184-3"><a href="computer-practical-2---allocation-analysis.html#cb184-3" tabindex="-1"></a>res[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>)) </span>
<span id="cb184-4"><a href="computer-practical-2---allocation-analysis.html#cb184-4" tabindex="-1"></a><span class="co"># work through the remaining patients sequentially</span></span>
<span id="cb184-5"><a href="computer-practical-2---allocation-analysis.html#cb184-5" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>nsample){</span>
<span id="cb184-6"><a href="computer-practical-2---allocation-analysis.html#cb184-6" tabindex="-1"></a>  <span class="co"># get treatment assignment sequentially for all subjects</span></span>
<span id="cb184-7"><a href="computer-practical-2---allocation-analysis.html#cb184-7" tabindex="-1"></a>  <span class="co"># The vector res is updated and so all previous allocations are accounted for</span></span>
<span id="cb184-8"><a href="computer-practical-2---allocation-analysis.html#cb184-8" tabindex="-1"></a>  <span class="co"># covmat is the data frame of participant data - including only the covariates</span></span>
<span id="cb184-9"><a href="computer-practical-2---allocation-analysis.html#cb184-9" tabindex="-1"></a>    res[j] <span class="ot">&lt;-</span> <span class="fu">Minirand</span>(</span>
<span id="cb184-10"><a href="computer-practical-2---allocation-analysis.html#cb184-10" tabindex="-1"></a>      <span class="at">covmat=</span>lg_df[ ,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>], j, <span class="at">covwt=</span><span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">7</span>)<span class="sc">/</span><span class="dv">7</span>, <span class="at">ratio=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">ntrt=</span><span class="dv">2</span>, <span class="at">trtseq=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">method=</span><span class="st">&quot;Range&quot;</span>, <span class="at">result=</span>res, <span class="at">p =</span> <span class="fl">0.9</span></span>
<span id="cb184-11"><a href="computer-practical-2---allocation-analysis.html#cb184-11" tabindex="-1"></a>      )</span>
<span id="cb184-12"><a href="computer-practical-2---allocation-analysis.html#cb184-12" tabindex="-1"></a>}</span>
<span id="cb184-13"><a href="computer-practical-2---allocation-analysis.html#cb184-13" tabindex="-1"></a></span>
<span id="cb184-14"><a href="computer-practical-2---allocation-analysis.html#cb184-14" tabindex="-1"></a>lg_df<span class="sc">$</span>treat <span class="ot">=</span> res</span>
<span id="cb184-15"><a href="computer-practical-2---allocation-analysis.html#cb184-15" tabindex="-1"></a></span>
<span id="cb184-16"><a href="computer-practical-2---allocation-analysis.html#cb184-16" tabindex="-1"></a><span class="do">## You can now investigate the balance of the design as usual</span></span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="cp1analysis" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">B.2</span> Analysis<a href="computer-practical-2---allocation-analysis.html#cp1analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For our analysis section, we will work with real datasets, and use them to explore and compare some of the different analysis methods we’ve covered in lectures. Both of these data sets are slightly awkward, as you will see, but that’s perhaps good practice for the real world!</p>
<div id="polyps-data" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">B.2.1</span> Polyps data<a href="computer-practical-2---allocation-analysis.html#polyps-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first dataset concerns a small trial in which patients with familial adenomatous polyposis (FAP) were treated either with Sulindac (group T) or a placebo (group C). People with FAP tend to have polyps (small growths) grow in their colon. Although the polyps themselves are not dangerous or harmful, they can turn into colon cancer. You can read about the study in <span class="citation">Giardiello et al. (<a href="#ref-giardiello1993treatment">1993</a>)</span>.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-69" class="exercise"><strong>Exercise B.12  </strong></span>First of all let’s explore the dataset:</p>
<ul>
<li>Look at the help file for <code>polyps</code></li>
<li>Which columns should you use for baseline and outcome variables?</li>
<li>Plot the data in these columns. Do you see any issues? Can you suggest a way to address them? What effect will this have on our estimator of the treatment effect?</li>
</ul>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-70" class="solution"><em>Solution</em>. </span>First of all, to access the data, enter</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="computer-practical-2---allocation-analysis.html#cb185-1" tabindex="-1"></a><span class="fu">data</span>(polyps, <span class="at">package =</span> <span class="st">&quot;medicaldata&quot;</span>)</span></code></pre></div>
<p>You can then view the help file by entering <code>?polyps</code>.</p>
<p>To investigate the columns in <code>polyps</code> we can use the structure function <code>str(polyps)</code></p>
<p>We have the baseline number of polyps for each patient in the column <code>baseline</code>, and a sensible column to use for the outcome would be <code>number12m</code>. Other baseline variables are <code>sex</code> and <code>age</code>.</p>
<p>To plot the baseline and outcome variables we can do</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="computer-practical-2---allocation-analysis.html#cb186-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>polyps, <span class="fu">aes</span>(<span class="at">x=</span>baseline)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-143-1.png" width="672" /></p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="computer-practical-2---allocation-analysis.html#cb187-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>polyps, <span class="fu">aes</span>(<span class="at">x=</span>number12m)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-143-2.png" width="672" /></p>
<p>These are both very right skewed, and exclusively positive (which makes sense given they are counts). A sensible thing to do therefore would be to take the log of these two variables. Since they are counts we will use the log to base 10, so that our results are easier to interpret. If you’d prefer to use natural logs that’s fine, some of your numbers will be different.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="computer-practical-2---allocation-analysis.html#cb188-1" tabindex="-1"></a>polyps<span class="sc">$</span>log_baseline <span class="ot">=</span> <span class="fu">log10</span>(polyps<span class="sc">$</span>baseline)</span>
<span id="cb188-2"><a href="computer-practical-2---allocation-analysis.html#cb188-2" tabindex="-1"></a>polyps<span class="sc">$</span>log_number12m <span class="ot">=</span> <span class="fu">log10</span>(polyps<span class="sc">$</span>number12m)</span></code></pre></div>
<p>Since we used the logarithms of the numbers of polyps, our treatment effect is
<span class="math display">\[\log\left(X_T\right) - \log\left(X_C\right) = \log\left(\frac{X_T}{X_C}\right).\]</span></p>
</div>
</details>
<p>We will work through the tests as we did in lectures, to see how the results differ.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-71" class="exercise"><strong>Exercise B.13  </strong></span>Using just the outcome variable (which should be <code>log_number12m</code> or something similar, see solution above if you aren’t sure why), test the hypothesis that the Sulindac has had some effect.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-72" class="solution"><em>Solution</em>. </span>We can either do this the long way or the short way! For sanity’s purposes, we’ll do it the long way once, then in subsequent questions I’ll only show the short way in the solutions.</p>
<p><strong>The long way</strong></p>
<p>The first thing to do is to calculate means for each group:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="computer-practical-2---allocation-analysis.html#cb189-1" tabindex="-1"></a>polyps_df <span class="ot">=</span> <span class="fu">na.omit</span>(polyps) <span class="co"># two participants (001 and 018) don&#39;t have data for 12m, so remove these</span></span>
<span id="cb189-2"><a href="computer-practical-2---allocation-analysis.html#cb189-2" tabindex="-1"></a>mean_T <span class="ot">=</span> <span class="fu">mean</span>(polyps_df<span class="sc">$</span>log_number12m[polyps_df<span class="sc">$</span>treatment<span class="sc">==</span><span class="st">&quot;sulindac&quot;</span>]) </span>
<span id="cb189-3"><a href="computer-practical-2---allocation-analysis.html#cb189-3" tabindex="-1"></a>sd_T <span class="ot">=</span> <span class="fu">sd</span>(polyps_df<span class="sc">$</span>log_number12m[polyps_df<span class="sc">$</span>treatment<span class="sc">==</span><span class="st">&quot;sulindac&quot;</span>])</span>
<span id="cb189-4"><a href="computer-practical-2---allocation-analysis.html#cb189-4" tabindex="-1"></a>mean_C <span class="ot">=</span> <span class="fu">mean</span>(polyps_df<span class="sc">$</span>log_number12m[polyps_df<span class="sc">$</span>treatment<span class="sc">==</span><span class="st">&quot;placebo&quot;</span>])</span>
<span id="cb189-5"><a href="computer-practical-2---allocation-analysis.html#cb189-5" tabindex="-1"></a>sd_C <span class="ot">=</span> <span class="fu">sd</span>(polyps_df<span class="sc">$</span>log_number12m[polyps_df<span class="sc">$</span>treatment<span class="sc">==</span><span class="st">&quot;placebo&quot;</span>])</span>
<span id="cb189-6"><a href="computer-practical-2---allocation-analysis.html#cb189-6" tabindex="-1"></a><span class="co"># There are 11 patients on Placebo (group C) and 9 on Sulindac (group T)</span></span>
<span id="cb189-7"><a href="computer-practical-2---allocation-analysis.html#cb189-7" tabindex="-1"></a><span class="co"># The pooled standard deviation </span></span>
<span id="cb189-8"><a href="computer-practical-2---allocation-analysis.html#cb189-8" tabindex="-1"></a>pooled_sd_polypsX <span class="ot">=</span> <span class="fu">sqrt</span>((<span class="dv">10</span><span class="sc">*</span>sd_C<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">8</span><span class="sc">*</span>sd_T<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">10</span><span class="sc">+</span><span class="dv">8</span>))</span>
<span id="cb189-9"><a href="computer-practical-2---allocation-analysis.html#cb189-9" tabindex="-1"></a><span class="co"># Finally we find the test statistic</span></span>
<span id="cb189-10"><a href="computer-practical-2---allocation-analysis.html#cb189-10" tabindex="-1"></a>test_stat <span class="ot">=</span> (mean_T <span class="sc">-</span> mean_C)<span class="sc">/</span>(pooled_sd_polypsX<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">11</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">9</span>))</span></code></pre></div>
<p>Under <span class="math inline">\(H_0\)</span> (that there is no treatment effect) the test statistic follows a <span class="math inline">\(t_{18}\)</span> distribution, and therefore we find our <span class="math inline">\(p\)</span>-value by</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="computer-practical-2---allocation-analysis.html#cb190-1" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>(test_stat, <span class="at">df=</span><span class="dv">18</span>)</span></code></pre></div>
<pre><code>## [1] 0.001046571</code></pre>
<p>Note that if the test statistic were positive, we’d have to do</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="computer-practical-2---allocation-analysis.html#cb192-1" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pt</span>(test_stat, <span class="at">df=</span><span class="dv">18</span>))</span></code></pre></div>
<p>Thus <span class="math inline">\(p=0.001\)</span> and we conclude that the treatment effect is significant. Our confidence interval is given by</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="computer-practical-2---allocation-analysis.html#cb193-1" tabindex="-1"></a>estimate <span class="ot">=</span> mean_T <span class="sc">-</span> mean_C</span>
<span id="cb193-2"><a href="computer-practical-2---allocation-analysis.html#cb193-2" tabindex="-1"></a>error <span class="ot">=</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df=</span><span class="dv">18</span>)<span class="sc">*</span>pooled_sd_polypsX<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">11</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">9</span>)</span>
<span id="cb193-3"><a href="computer-practical-2---allocation-analysis.html#cb193-3" tabindex="-1"></a><span class="fu">c</span>(estimate <span class="sc">-</span> error, estimate <span class="sc">+</span> error)</span></code></pre></div>
<pre><code>## [1] -1.2264748 -0.3678718</code></pre>
<p><strong>The short way</strong></p>
<p>R has a t-test function built in, so we can simply use that. Notice that it gives us everything our heart might desire (on a fairly mundane day), including a confidence interval!</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="computer-practical-2---allocation-analysis.html#cb195-1" tabindex="-1"></a><span class="fu">t.test</span>(</span>
<span id="cb195-2"><a href="computer-practical-2---allocation-analysis.html#cb195-2" tabindex="-1"></a>  <span class="at">x=</span>polyps_df<span class="sc">$</span>log_number12m[polyps_df<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;sulindac&quot;</span>],</span>
<span id="cb195-3"><a href="computer-practical-2---allocation-analysis.html#cb195-3" tabindex="-1"></a>  <span class="at">y=</span>polyps_df<span class="sc">$</span>log_number12m[polyps_df<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;placebo&quot;</span>],</span>
<span id="cb195-4"><a href="computer-practical-2---allocation-analysis.html#cb195-4" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>,</span>
<span id="cb195-5"><a href="computer-practical-2---allocation-analysis.html#cb195-5" tabindex="-1"></a>  <span class="at">var.equal=</span>T, <span class="co"># this makes the method use pooled variances, as we did in lectures</span></span>
<span id="cb195-6"><a href="computer-practical-2---allocation-analysis.html#cb195-6" tabindex="-1"></a>  <span class="at">conf.level =</span> <span class="fl">0.95</span> <span class="co"># note that this is 1-alpha</span></span>
<span id="cb195-7"><a href="computer-practical-2---allocation-analysis.html#cb195-7" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  polyps_df$log_number12m[polyps_df$treatment == &quot;sulindac&quot;] and polyps_df$log_number12m[polyps_df$treatment == &quot;placebo&quot;]
## t = -3.9012, df = 18, p-value = 0.001047
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.2264748 -0.3678718
## sample estimates:
## mean of x mean of y 
## 0.6671373 1.4643106</code></pre>
<p>Either way, our 95% confidence interval is (-1.226,;-0.368) (to 3 d.p).
Therefore, the confidence interval for <span class="math inline">\(\frac{X_T}{X_C}\)</span> is</p>
<p><span class="math display">\[\left(10^{-1.226},\;10^{-0.368}\right) =  \left(0.0594,\;0.429\right).\]</span>
That is, the number of polyps at 12 months for someone in group <span class="math inline">\(T\)</span> is likely to be somewhere between <span class="math inline">\(0.0594 X_C\)</span> and <span class="math inline">\(0.429 X_C\)</span>.</p>
</div>
</details>
<p>We’ll now move on to comparing the differences between baseline and outcome</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-73" class="exercise"><strong>Exercise B.14  </strong></span>Perform another <span class="math inline">\(t\)</span>-test, this time using the difference between outcome and baseline. <em>Hint: because we’ve taken logs, you’ll have to think about what variable to use and perhaps experiment with some possibilities</em></p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-74" class="solution"><em>Solution</em>. </span>The first step is to calculate a difference column. This is somewhat complicated by that fact that we have taken logs of the measurements. Taking logs of the difference would not work, since some are negative. Potentially it might work to just work with the (unlogged) differences</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="computer-practical-2---allocation-analysis.html#cb197-1" tabindex="-1"></a>polyps_df<span class="sc">$</span>diff <span class="ot">=</span> polyps_df<span class="sc">$</span>number12m <span class="sc">-</span> polyps_df<span class="sc">$</span>baseline</span>
<span id="cb197-2"><a href="computer-practical-2---allocation-analysis.html#cb197-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>polyps_df, <span class="fu">aes</span>(<span class="at">x=</span>diff, <span class="at">fill=</span>treatment)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="at">bins=</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-150-1.png" width="672" /></p>
<p>But the outliers look potentially problematic, and the central bulk of each distribution doesn’t look very normal. We could also try the difference of the logged measurements:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="computer-practical-2---allocation-analysis.html#cb198-1" tabindex="-1"></a>polyps_df<span class="sc">$</span>diff_log <span class="ot">=</span> polyps_df<span class="sc">$</span>log_number12m <span class="sc">-</span> polyps_df<span class="sc">$</span>log_baseline</span>
<span id="cb198-2"><a href="computer-practical-2---allocation-analysis.html#cb198-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>polyps_df, <span class="fu">aes</span>(<span class="at">x=</span>diff_log, <span class="at">fill=</span>treatment)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="at">bins=</span><span class="dv">10</span>)</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<p>This looks a lot better - no more outliers and closer to normal-looking. Obviously with so few observations we won’t have a nice normal curve.</p>
<p>To do a t-test, we can use R’s in-built function</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="computer-practical-2---allocation-analysis.html#cb199-1" tabindex="-1"></a><span class="fu">t.test</span>(</span>
<span id="cb199-2"><a href="computer-practical-2---allocation-analysis.html#cb199-2" tabindex="-1"></a>  <span class="at">x=</span>polyps_df<span class="sc">$</span>diff_log[polyps_df<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;sulindac&quot;</span>],</span>
<span id="cb199-3"><a href="computer-practical-2---allocation-analysis.html#cb199-3" tabindex="-1"></a>  <span class="at">y=</span>polyps_df<span class="sc">$</span>diff_log[polyps_df<span class="sc">$</span>treatment <span class="sc">==</span> <span class="st">&quot;placebo&quot;</span>],</span>
<span id="cb199-4"><a href="computer-practical-2---allocation-analysis.html#cb199-4" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>,</span>
<span id="cb199-5"><a href="computer-practical-2---allocation-analysis.html#cb199-5" tabindex="-1"></a>  <span class="at">var.equal=</span>T, <span class="co"># this makes the method use pooled variances, as we did in lectures</span></span>
<span id="cb199-6"><a href="computer-practical-2---allocation-analysis.html#cb199-6" tabindex="-1"></a>  <span class="at">conf.level =</span> <span class="fl">0.95</span> <span class="co"># note that this is 1-alpha</span></span>
<span id="cb199-7"><a href="computer-practical-2---allocation-analysis.html#cb199-7" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  polyps_df$diff_log[polyps_df$treatment == &quot;sulindac&quot;] and polyps_df$diff_log[polyps_df$treatment == &quot;placebo&quot;]
## t = -3.5142, df = 18, p-value = 0.002477
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.0242756 -0.2578053
## sample estimates:
##   mean of x   mean of y 
## -0.58476481  0.05627565</code></pre>
</div>
</details>
<p>Finally we can try fitting an ANCOVA model to the data, using the function <code>lm</code>. Remember that the general model function for ANCOVA is….</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-75" class="exercise"><strong>Exercise B.15  </strong></span>Fit an ANCOVA model to the licorice data, and interpret your results. If you aren’t familiar with the function <code>lm</code>, it might be a good idea to look at the solutions.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-76" class="solution"><em>Solution</em>. </span>In the ANCOVA model we saw in lectures so far, we fit a linear model with the outcome as dependent / target variable, and the trial group and baseline as independent / explanatory variables.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="computer-practical-2---allocation-analysis.html#cb201-1" tabindex="-1"></a>lm_polyp1 <span class="ot">=</span> <span class="fu">lm</span>(log_number12m <span class="sc">~</span> treatment <span class="sc">+</span> log_baseline, <span class="at">data=</span>polyps_df)</span>
<span id="cb201-2"><a href="computer-practical-2---allocation-analysis.html#cb201-2" tabindex="-1"></a><span class="fu">summary</span>(lm_polyp1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log_number12m ~ treatment + log_baseline, data = polyps_df)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.69628 -0.15530  0.04155  0.17288  0.68553 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         0.6291     0.2798   2.249 0.038084 *  
## treatmentsulindac  -0.7046     0.1675  -4.205 0.000595 ***
## log_baseline        0.5932     0.1824   3.251 0.004698 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3673 on 17 degrees of freedom
## Multiple R-squared:  0.6659, Adjusted R-squared:  0.6266 
## F-statistic: 16.94 on 2 and 17 DF,  p-value: 8.973e-05</code></pre>
<p>Based on this, the effect of the drug sulindac is significant (<span class="math inline">\(p=0.00595\)</span>, lower than our previous models). The 95% CI for the treatment effect (which is still <span class="math inline">\(\log\left(\frac{X_T}{X_C}\right)\)</span>) now is</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="computer-practical-2---allocation-analysis.html#cb203-1" tabindex="-1"></a><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.7046</span> <span class="sc">-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df=</span><span class="dv">17</span>)<span class="sc">*</span><span class="fl">0.1675</span>, <span class="sc">-</span><span class="fl">0.7046</span> <span class="sc">+</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="at">df=</span><span class="dv">17</span>)<span class="sc">*</span><span class="fl">0.1675</span> ) </span></code></pre></div>
<pre><code>## [1] -1.0579941 -0.3512059</code></pre>
<p>We could create a nicer-looking table of the coefficients using <code>tbl_regression</code> (from <code>gtsummary</code>):</p>
<div id="ffcxgczdkk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ffcxgczdkk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ffcxgczdkk thead, #ffcxgczdkk tbody, #ffcxgczdkk tfoot, #ffcxgczdkk tr, #ffcxgczdkk td, #ffcxgczdkk th {
  border-style: none;
}

#ffcxgczdkk p {
  margin: 0;
  padding: 0;
}

#ffcxgczdkk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ffcxgczdkk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ffcxgczdkk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ffcxgczdkk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ffcxgczdkk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ffcxgczdkk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ffcxgczdkk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ffcxgczdkk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ffcxgczdkk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ffcxgczdkk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ffcxgczdkk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ffcxgczdkk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ffcxgczdkk .gt_spanner_row {
  border-bottom-style: hidden;
}

#ffcxgczdkk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ffcxgczdkk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ffcxgczdkk .gt_from_md > :first-child {
  margin-top: 0;
}

#ffcxgczdkk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ffcxgczdkk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ffcxgczdkk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ffcxgczdkk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ffcxgczdkk .gt_row_group_first td {
  border-top-width: 2px;
}

#ffcxgczdkk .gt_row_group_first th {
  border-top-width: 2px;
}

#ffcxgczdkk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ffcxgczdkk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ffcxgczdkk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ffcxgczdkk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ffcxgczdkk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ffcxgczdkk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ffcxgczdkk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ffcxgczdkk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ffcxgczdkk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ffcxgczdkk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ffcxgczdkk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ffcxgczdkk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ffcxgczdkk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ffcxgczdkk .gt_left {
  text-align: left;
}

#ffcxgczdkk .gt_center {
  text-align: center;
}

#ffcxgczdkk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ffcxgczdkk .gt_font_normal {
  font-weight: normal;
}

#ffcxgczdkk .gt_font_bold {
  font-weight: bold;
}

#ffcxgczdkk .gt_font_italic {
  font-style: italic;
}

#ffcxgczdkk .gt_super {
  font-size: 65%;
}

#ffcxgczdkk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ffcxgczdkk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ffcxgczdkk .gt_indent_1 {
  text-indent: 5px;
}

#ffcxgczdkk .gt_indent_2 {
  text-indent: 10px;
}

#ffcxgczdkk .gt_indent_3 {
  text-indent: 15px;
}

#ffcxgczdkk .gt_indent_4 {
  text-indent: 20px;
}

#ffcxgczdkk .gt_indent_5 {
  text-indent: 25px;
}

#ffcxgczdkk .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ffcxgczdkk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="label"><span class='gt_from_md'><strong>Characteristic</strong></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="estimate"><span class='gt_from_md'><strong>Beta</strong></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="conf.low"><span class='gt_from_md'><strong>95% CI</strong></span><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="p.value"><span class='gt_from_md'><strong>p-value</strong></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">treatment</td>
<td headers="estimate" class="gt_row gt_center"><br /></td>
<td headers="conf.low" class="gt_row gt_center"><br /></td>
<td headers="p.value" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    placebo</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="conf.low" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br /></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    sulindac</td>
<td headers="estimate" class="gt_row gt_center">-0.70</td>
<td headers="conf.low" class="gt_row gt_center">-1.1, -0.35</td>
<td headers="p.value" class="gt_row gt_center"><0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">log_baseline</td>
<td headers="estimate" class="gt_row gt_center">0.59</td>
<td headers="conf.low" class="gt_row gt_center">0.21, 0.98</td>
<td headers="p.value" class="gt_row gt_center">0.005</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> <span class='gt_from_md'>CI = Confidence Interval</span></td>
    </tr>
  </tfoot>
</table>
</div>
<p>but note that this doesn’t show all the information that <code>summary</code> does.</p>
</div>
</details>
<p>Unlike in the <span class="math inline">\(t\)</span>-test where we can only compare measurements like-for-like, in ANCOVA we fit a coefficient to the baseline covariate. This means we are no longer limited to comparing the outcome variable to variables on the same scale, but can also include other baseline variables.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-77" class="exercise"><strong>Exercise B.16  </strong></span>Fit another linear model, this time including the other baseline variables.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-78" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="computer-practical-2---allocation-analysis.html#cb205-1" tabindex="-1"></a>lm_polyp2 <span class="ot">=</span> <span class="fu">lm</span>(log_number12m <span class="sc">~</span> treatment <span class="sc">+</span> log_baseline <span class="sc">+</span> sex <span class="sc">+</span> age, <span class="at">data =</span> polyps_df)</span>
<span id="cb205-2"><a href="computer-practical-2---allocation-analysis.html#cb205-2" tabindex="-1"></a><span class="fu">summary</span>(lm_polyp2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log_number12m ~ treatment + log_baseline + sex + 
##     age, data = polyps_df)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.59539 -0.32008  0.09788  0.17374  0.62089 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        0.888170   0.503801   1.763 0.098266 .  
## treatmentsulindac -0.730464   0.177936  -4.105 0.000936 ***
## log_baseline       0.495560   0.216900   2.285 0.037307 *  
## sexmale            0.197442   0.201555   0.980 0.342821    
## age               -0.009412   0.012205  -0.771 0.452620    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3779 on 15 degrees of freedom
## Multiple R-squared:  0.688,  Adjusted R-squared:  0.6048 
## F-statistic:  8.27 on 4 and 15 DF,  p-value: 0.0009895</code></pre>
<p>In this case it appears that the other two baseline covariates, age and sex, don’t have a significant effect on the outcome.</p>
</div>
</details>
<div class="exercise">
<p><span id="exr:unlabeled-div-79" class="exercise"><strong>Exercise B.17  </strong></span>Inspect some plots of the residuals, to check whether these models have any systematic problems. Does there appear to be any multicollinearity in the data?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-80" class="solution"><em>Solution</em>. </span>These solutions will demonstrate some methods with the first model.
First of all, we can add columns with the residuals and fitted values from the model.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="computer-practical-2---allocation-analysis.html#cb207-1" tabindex="-1"></a>polyps_df<span class="sc">$</span>resid1 <span class="ot">=</span> <span class="fu">resid</span>(lm_polyp1)</span>
<span id="cb207-2"><a href="computer-practical-2---allocation-analysis.html#cb207-2" tabindex="-1"></a>polyps_df<span class="sc">$</span>fitted1 <span class="ot">=</span> <span class="fu">fitted</span>(lm_polyp1)</span>
<span id="cb207-3"><a href="computer-practical-2---allocation-analysis.html#cb207-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>polyps_df, <span class="fu">aes</span>(<span class="at">x=</span>fitted1, <span class="at">y=</span>resid1, <span class="at">col=</span>treatment)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-157-1.png" width="672" /></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="computer-practical-2---allocation-analysis.html#cb208-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>polyps_df, <span class="fu">aes</span>(<span class="at">x=</span>log_baseline, <span class="at">y=</span>resid1, <span class="at">col=</span>treatment)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-157-2.png" width="672" /></p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="computer-practical-2---allocation-analysis.html#cb209-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>polyps_df, <span class="fu">aes</span>(<span class="at">x=</span>resid1, <span class="at">fill=</span>treatment)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>)</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-157-3.png" width="672" /></p>
<p>None of these ring huge alarm bells, but because the dataset is so small it’s quite hard to tell! Arguably the residuals for the <code>sulindac</code> group are more spread out than those for the plaecbo, but there are no obvious systematic trends.</p>
<p>We can find the variance inflation factor by</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="computer-practical-2---allocation-analysis.html#cb210-1" tabindex="-1"></a><span class="fu">vif</span>(lm_polyp1)</span></code></pre></div>
<pre><code>##    treatment log_baseline 
##     1.029768     1.029768</code></pre>
<p>and it indicates no problems. Another sign that the ANCOVA model is well-fitted is that the standard errors of the coefficients are all reasonably small. If there was a problem, for example multicollinearity, some of these would blow up.</p>
</div>
</details>
</div>
</div>
<div id="extension-problems" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">B.3</span> Extension problems<a href="computer-practical-2---allocation-analysis.html#extension-problems" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If you have time to spare, or want to look a bit deeper into things after the practical, these exercises are here for you!</p>
<div id="a-simulation-experiment" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">B.3.1</span> A simulation experiment!<a href="computer-practical-2---allocation-analysis.html#a-simulation-experiment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the allocation section we used each method once and produced summaries like the marginal imbalance. Because they are inherently random, to understand the general behaviour of each method, we’ll conduct a simulation experiment.</p>
<p>The general process for this is:</p>
<ol style="list-style-type: decimal">
<li><p>Choose a numerical summary (probably either the imbalance or the marginal imbalance)</p></li>
<li><p>Choose some large number <span class="math inline">\(n_{sim}\)</span> and create a vector of zeroes or NAs that length</p></li>
<li><p>Run through the following process <span class="math inline">\(n_{sim}\)</span> times:</p>
<ul>
<li>Perform the allocation</li>
<li>Find the numerical summary</li>
<li>Store the numerical summary in the vector you created in step 2.</li>
</ul></li>
<li><p>Plot (or otherwise summarise) the vector of summaries.</p></li>
</ol>
<div class="exercise">
<p><span id="exr:unlabeled-div-81" class="exercise"><strong>Exercise B.18  </strong></span>Perform the simulation experiment for some of the methods above. Make sure you store the summary vectors by different (and intelligible!) names.</p>
<p>Based on your results, comment on how plausible it is that <span class="citation">Ruetzler et al. (<a href="#ref-ruetzler2013randomized">2013</a>)</span> used each method in their trial.</p>
<p><em>Hint: think of the simulated summaries as approximations of probability distributions</em></p>
</div>
<p>For the licorice dataset, <span class="citation">Ruetzler et al. (<a href="#ref-ruetzler2013randomized">2013</a>)</span> say that “Randomization (1:1) to licorice or placebo was assigned by a Web-based system that was accessed just before treatment by an independent researcher who was not involved in data collection; no stratification was used.”</p>
</div>
<div id="treatment-for-maternal-periodontal-disease" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">B.3.2</span> Treatment for maternal periodontal disease<a href="computer-practical-2---allocation-analysis.html#treatment-for-maternal-periodontal-disease" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We looked at the <code>opt</code> dataset in the last practical in the context of missing data, but now we’re going to look at it for analysis. The <code>opt</code> data are in the package <code>medicaldata</code>, which you should already have loaded.</p>
<p>The aim of the study is to find out whether treating women for periodontal disease during the first 21 weeks of pregnancy resulted in a low birth weight or pre-term birth.</p>
<p>The groups are stored in the <code>group</code> variable</p>
<ul>
<li><code>group</code> T: those who received periodontal treatment, and tooth polishing at their follow-ups</li>
<li><code>group</code> C: Brief oral exams</li>
</ul>
<p>There are 823 participants and 171 variables - many of these are baseline covariates, but there are also quite a few interim measurements.</p>
<p>The study’s primary outcome variable is gestational age at end of pregnancy, but birth weight was also measured, as well as some clinical measures of periodontal disease and some microbiological and immunological outcomes.</p>
<p>To make this more managable, we will concentrate on the outcome <code>Birthweight</code>.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-82" class="exercise"><strong>Exercise B.19  </strong></span>Plot the variable <code>Birthweight</code>. Do we need to use any transformations before we model it?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-83" class="solution"><em>Solution</em>. </span></p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="computer-practical-2---allocation-analysis.html#cb212-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>opt, <span class="fu">aes</span>(<span class="at">x=</span>Birthweight, <span class="at">fill=</span>Group)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-159-1.png" width="672" />
This data looks very nice and normal (although there is a bit of a fat tail to the left), so we won’t transform it.</p>
</div>
</details>
<p>You’ll remember that there were lots of issues with the <code>opt</code> data.</p>
<p>We’ll reduce the dataset to a more managable size, by removing all outcomes except <code>Birthweight</code> and reducing the number of covariates. We’ll also impute the variables that we can do logically, eg. <code>BL.Cig.day</code>, as we did in computer practical 1.</p>
<p>If you still have your version of <code>opt</code> after performing regression imputation on the <code>BMI</code> variable you could use that!</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="computer-practical-2---allocation-analysis.html#cb213-1" tabindex="-1"></a>opt_red <span class="ot">=</span> opt[ ,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>,<span class="dv">72</span>)] </span>
<span id="cb213-2"><a href="computer-practical-2---allocation-analysis.html#cb213-2" tabindex="-1"></a><span class="co"># Change NAs to &quot;None&quot; for diabetic</span></span>
<span id="cb213-3"><a href="computer-practical-2---allocation-analysis.html#cb213-3" tabindex="-1"></a><span class="co"># since in opt the non-diabetic people are coded as NA (and therefore excluded from the model)</span></span>
<span id="cb213-4"><a href="computer-practical-2---allocation-analysis.html#cb213-4" tabindex="-1"></a>diab <span class="ot">=</span> <span class="fu">as.character</span>(opt_red<span class="sc">$</span>BL.Diab.Type)</span>
<span id="cb213-5"><a href="computer-practical-2---allocation-analysis.html#cb213-5" tabindex="-1"></a>diab[<span class="fu">is.na</span>(diab)] <span class="ot">=</span> <span class="st">&quot;None&quot;</span></span>
<span id="cb213-6"><a href="computer-practical-2---allocation-analysis.html#cb213-6" tabindex="-1"></a>opt_red<span class="sc">$</span>BL.Diab.Type <span class="ot">=</span> <span class="fu">as.factor</span>(diab)</span>
<span id="cb213-7"><a href="computer-practical-2---allocation-analysis.html#cb213-7" tabindex="-1"></a><span class="co"># similar problem with smokers and how many cigarettes per day</span></span>
<span id="cb213-8"><a href="computer-practical-2---allocation-analysis.html#cb213-8" tabindex="-1"></a></span>
<span id="cb213-9"><a href="computer-practical-2---allocation-analysis.html#cb213-9" tabindex="-1"></a><span class="co"># If people are non-smokers and have missing for number of cigarettes per day</span></span>
<span id="cb213-10"><a href="computer-practical-2---allocation-analysis.html#cb213-10" tabindex="-1"></a><span class="co"># change their number of cigarettes to zero</span></span>
<span id="cb213-11"><a href="computer-practical-2---allocation-analysis.html#cb213-11" tabindex="-1"></a>sm <span class="ot">=</span> opt_red<span class="sc">$</span>Use.Tob</span>
<span id="cb213-12"><a href="computer-practical-2---allocation-analysis.html#cb213-12" tabindex="-1"></a>cigs <span class="ot">=</span> opt_red<span class="sc">$</span>BL.Cig.Day</span>
<span id="cb213-13"><a href="computer-practical-2---allocation-analysis.html#cb213-13" tabindex="-1"></a>cigs[(<span class="fu">is.na</span>(cigs)<span class="sc">&amp;</span>(sm<span class="sc">==</span><span class="st">&quot;No &quot;</span>))] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb213-14"><a href="computer-practical-2---allocation-analysis.html#cb213-14" tabindex="-1"></a>opt_red<span class="sc">$</span>BL.Cig.Day <span class="ot">=</span> cigs</span>
<span id="cb213-15"><a href="computer-practical-2---allocation-analysis.html#cb213-15" tabindex="-1"></a></span>
<span id="cb213-16"><a href="computer-practical-2---allocation-analysis.html#cb213-16" tabindex="-1"></a><span class="co"># Same for alcohol and drinks per day</span></span>
<span id="cb213-17"><a href="computer-practical-2---allocation-analysis.html#cb213-17" tabindex="-1"></a></span>
<span id="cb213-18"><a href="computer-practical-2---allocation-analysis.html#cb213-18" tabindex="-1"></a>alc <span class="ot">=</span> opt_red<span class="sc">$</span>Use.Alc</span>
<span id="cb213-19"><a href="computer-practical-2---allocation-analysis.html#cb213-19" tabindex="-1"></a>dr <span class="ot">=</span> opt_red<span class="sc">$</span>BL.Drks.Day</span>
<span id="cb213-20"><a href="computer-practical-2---allocation-analysis.html#cb213-20" tabindex="-1"></a>dr[(<span class="fu">is.na</span>(dr)<span class="sc">&amp;</span>(alc<span class="sc">==</span><span class="st">&quot;No &quot;</span>))] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb213-21"><a href="computer-practical-2---allocation-analysis.html#cb213-21" tabindex="-1"></a>opt_red<span class="sc">$</span>BL.Drks.Day <span class="ot">=</span> dr</span>
<span id="cb213-22"><a href="computer-practical-2---allocation-analysis.html#cb213-22" tabindex="-1"></a></span>
<span id="cb213-23"><a href="computer-practical-2---allocation-analysis.html#cb213-23" tabindex="-1"></a><span class="co"># If a participant hasn&#39;t had a previous pregnancy, her N.prev.preg should be zero (not NA)</span></span>
<span id="cb213-24"><a href="computer-practical-2---allocation-analysis.html#cb213-24" tabindex="-1"></a></span>
<span id="cb213-25"><a href="computer-practical-2---allocation-analysis.html#cb213-25" tabindex="-1"></a>pp <span class="ot">=</span> opt_red<span class="sc">$</span>Prev.preg</span>
<span id="cb213-26"><a href="computer-practical-2---allocation-analysis.html#cb213-26" tabindex="-1"></a>npp <span class="ot">=</span> opt_red<span class="sc">$</span>N.prev.preg</span>
<span id="cb213-27"><a href="computer-practical-2---allocation-analysis.html#cb213-27" tabindex="-1"></a>npp[pp<span class="sc">==</span><span class="st">&quot;No &quot;</span>] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb213-28"><a href="computer-practical-2---allocation-analysis.html#cb213-28" tabindex="-1"></a>opt_red<span class="sc">$</span>N.prev.preg <span class="ot">=</span> npp</span></code></pre></div>
<p>When we use <code>lm</code> to fit an ANCOVA model, all rows with an <code>NA</code> in will be ignored. It’s therefore important to try to eradicate any <code>NA</code>s where we actually do know the value!</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-84" class="exercise"><strong>Exercise B.20  </strong></span>Perform a <span class="math inline">\(t\)</span>-test on the outcome <code>Birthweight</code>. What do you find? Can you also perform a <span class="math inline">\(t\)</span>-test using difference from baseline?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-85" class="solution"><em>Solution</em>. </span>To perform the <span class="math inline">\(t\)</span>-test we can use the inbuilt R function</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="computer-practical-2---allocation-analysis.html#cb214-1" tabindex="-1"></a><span class="co"># Check SDs are fairly close before proceeding</span></span>
<span id="cb214-2"><a href="computer-practical-2---allocation-analysis.html#cb214-2" tabindex="-1"></a><span class="fu">sd</span>(opt_red<span class="sc">$</span>Birthweight[opt_red<span class="sc">$</span>Group <span class="sc">==</span> <span class="st">&quot;T&quot;</span>], <span class="at">na.rm=</span>T)</span></code></pre></div>
<pre><code>## [1] 636.82</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="computer-practical-2---allocation-analysis.html#cb216-1" tabindex="-1"></a><span class="fu">sd</span>(opt_red<span class="sc">$</span>Birthweight[opt_red<span class="sc">$</span>Group <span class="sc">==</span> <span class="st">&quot;C&quot;</span>], <span class="at">na.rm=</span>T)</span></code></pre></div>
<pre><code>## [1] 727.4854</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="computer-practical-2---allocation-analysis.html#cb218-1" tabindex="-1"></a><span class="fu">t.test</span>(</span>
<span id="cb218-2"><a href="computer-practical-2---allocation-analysis.html#cb218-2" tabindex="-1"></a>  <span class="at">x=</span>opt_red<span class="sc">$</span>Birthweight[opt_red<span class="sc">$</span>Group <span class="sc">==</span> <span class="st">&quot;T&quot;</span>],</span>
<span id="cb218-3"><a href="computer-practical-2---allocation-analysis.html#cb218-3" tabindex="-1"></a>  <span class="at">y=</span>opt_red<span class="sc">$</span>Birthweight[opt_red<span class="sc">$</span>Group <span class="sc">==</span> <span class="st">&quot;C&quot;</span>],</span>
<span id="cb218-4"><a href="computer-practical-2---allocation-analysis.html#cb218-4" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>,</span>
<span id="cb218-5"><a href="computer-practical-2---allocation-analysis.html#cb218-5" tabindex="-1"></a>  <span class="at">var.equal=</span>T, <span class="co"># this makes the method use pooled variances, as we did in lectures</span></span>
<span id="cb218-6"><a href="computer-practical-2---allocation-analysis.html#cb218-6" tabindex="-1"></a>  <span class="at">conf.level =</span> <span class="fl">0.95</span> <span class="co"># note that this is 1-alpha</span></span>
<span id="cb218-7"><a href="computer-practical-2---allocation-analysis.html#cb218-7" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  opt_red$Birthweight[opt_red$Group == &quot;T&quot;] and opt_red$Birthweight[opt_red$Group == &quot;C&quot;]
## t = 0.74585, df = 807, p-value = 0.456
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -58.49266 130.18492
## sample estimates:
## mean of x mean of y 
##  3216.670  3180.824</code></pre>
<p>We find that the difference in Birthweights between the groups is not even close to significant (<span class="math inline">\(p=0.456\)</span>).</p>
<p>We can’t do a <span class="math inline">\(t\)</span>-test with differences because there is no comparable baseline measurement.</p>
</div>
</details>
<p>Now we will move on to ANCOVA.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-86" class="exercise"><strong>Exercise B.21  </strong></span>Before fitting the model, think about what you expect to find. Bear in mind:</p>
<ul>
<li>the result above</li>
<li>the description of risk factors of preterm birth / low birth weight in the help file for <code>opt</code></li>
<li>which variables you will include in your model</li>
</ul>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-87" class="solution"><em>Solution</em>. </span>The <span class="math inline">\(p\)</span>-value from the <span class="math inline">\(t\)</span>-test was very high, so it seems unlikely that we’ll find a significant treatment effect using ANCOVA unless there are some significant interactions going on between covariates.</p>
<p>The help file says (under ‘Background’):</p>
<blockquote>
<p>Many risk factors for preterm birth have already been identified, including maternal age, drug use, and diabetes. However, such factors are exhibited in only about half of preterm birth mothers, highlighting a need to expand our understanding of what contributes to preterm birth risk.</p>
</blockquote>
<p>Therefore, if we include related factors in our model (many of which we have in our dataset) we should expect to see significant coefficients. But, it sounds like there is a lot that isn’t well understood, so our model is likely not to explain a huge proportion of the variance.</p>
</div>
</details>
<div class="exercise">
<p><span id="exr:unlabeled-div-88" class="exercise"><strong>Exercise B.22  </strong></span>Fit an ANCOVA model. What do you find?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-89" class="solution"><em>Solution</em>. </span>To fit a linear model including every variable as a covariate (apart from the target variable), we can do</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="computer-practical-2---allocation-analysis.html#cb220-1" tabindex="-1"></a>lm_full <span class="ot">=</span> <span class="fu">lm</span>(Birthweight <span class="sc">~</span> ., <span class="at">data =</span> opt_red[ ,<span class="sc">-</span><span class="dv">1</span>]) <span class="co"># don&#39;t include the ID column!</span></span>
<span id="cb220-2"><a href="computer-practical-2---allocation-analysis.html#cb220-2" tabindex="-1"></a><span class="fu">summary</span>(lm_full)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Birthweight ~ ., data = opt_red[, -1])
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -3019.46  -233.35    46.89   382.82  1935.06 
## 
## Coefficients: (1 not defined because of singularities)
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            3906.439    702.835   5.558 3.91e-08 ***
## ClinicMN                -57.521     73.391  -0.784  0.43345    
## ClinicMS               -173.068     88.189  -1.962  0.05011 .  
## ClinicNY               -146.548    100.180  -1.463  0.14397    
## GroupT                   28.780     49.914   0.577  0.56440    
## Age                      -1.686      5.417  -0.311  0.75572    
## BlackYes               -158.055    127.807  -1.237  0.21664    
## WhiteYes                -47.195    100.791  -0.468  0.63976    
## Nat.AmYes              -224.757    112.946  -1.990  0.04699 *  
## AsianYes               -142.693    301.298  -0.474  0.63594    
## HispNo                  133.343     75.097   1.776  0.07624 .  
## HispYes                 126.498    115.009   1.100  0.27177    
## EducationLT 8 yrs       -43.324     70.513  -0.614  0.53915    
## EducationMT 12 yrs       23.011     66.301   0.347  0.72864    
## Public.AsstceYes       -144.623     62.886  -2.300  0.02176 *  
## HypertensionY          -372.548    148.033  -2.517  0.01207 *  
## DiabetesYes             443.811    170.343   2.605  0.00938 ** 
## BL.Diab.TypeType I     -425.019    318.490  -1.334  0.18249    
## BL.Diab.TypeType II          NA         NA      NA       NA    
## BMI                       2.124      3.857   0.551  0.58206    
## Use.TobYes              -17.794    134.088  -0.133  0.89446    
## BL.Cig.Day              -23.101     11.560  -1.998  0.04607 *  
## Use.AlcYes             -159.827    223.653  -0.715  0.47509    
## BL.Drks.Day              28.460     24.851   1.145  0.25252    
## Drug.AddNo             -498.971    659.330  -0.757  0.44944    
## Drug.AddYes            -475.778    806.745  -0.590  0.55555    
## Prev.pregYes             85.355     70.825   1.205  0.22856    
## N.prev.preg             -17.281     18.228  -0.948  0.34345    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 653.6 on 686 degrees of freedom
##   (110 observations deleted due to missingness)
## Multiple R-squared:  0.06774,    Adjusted R-squared:  0.03241 
## F-statistic: 1.917 on 26 and 686 DF,  p-value: 0.004183</code></pre>
<p>We see from the model summary that our model is terrible: <span class="math inline">\(R^2=0.03241\)</span>, which means it is explaining about 3% of the variance in Birthweight.</p>
<p>If you want to use only certain terms, you can include them in the formula, for example</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="computer-practical-2---allocation-analysis.html#cb222-1" tabindex="-1"></a>lm_eg <span class="ot">=</span> <span class="fu">lm</span>(Birthweight <span class="sc">~</span> Group <span class="sc">+</span> Age <span class="sc">+</span> Hypertension, <span class="at">data=</span>opt_red)</span></code></pre></div>
<p>We see that, as we expected, the <code>Group</code> variable is not significant (<span class="math inline">\(p=0.5644\)</span>). However, some terms are significant, for example whether or not the participant has diabetes, and how many cigarettes a mother smokes per day - this isn’t surprising given the contextual information we had.</p>
</div>
</details>
<div class="exercise">
<p><span id="exr:unlabeled-div-90" class="exercise"><strong>Exercise B.23  </strong></span>Perform some diagnostic checks on your model. Do you have any reason to suspect it isn’t adequate?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-91" class="solution"><em>Solution</em>. </span>One thing to notice from the linear model summary is that many coefficients have proportionally quite large standard errors. This could be because of a lack of data (eg. if there are very few participants in some category) or because of multicollinearity (in which case the model cannot know which of the linked variables to attribute the effect to). Combining some categories or carefully removing some covariates could help improve the model.</p>
<p>We can also study the residuals of our model, to check that they appear to be homoskedastic and approximately normal with mean 0.</p>
<p>The first step is to extract the residuals and the fitted values (which are also useful). We will create a new data frame called <code>opt_diag</code> with these in, so that we can plot things easily but don’t pollute our original dataset (in case we want to fit any more models)</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="computer-practical-2---allocation-analysis.html#cb223-1" tabindex="-1"></a>opt_diag <span class="ot">=</span> <span class="fu">na.omit</span>(opt_red) <span class="co"># lm only fits where all variables are present</span></span>
<span id="cb223-2"><a href="computer-practical-2---allocation-analysis.html#cb223-2" tabindex="-1"></a>opt_diag<span class="sc">$</span>resid <span class="ot">=</span> <span class="fu">resid</span>(lm_full)</span>
<span id="cb223-3"><a href="computer-practical-2---allocation-analysis.html#cb223-3" tabindex="-1"></a>opt_diag<span class="sc">$</span>fitted <span class="ot">=</span> <span class="fu">fitted</span>(lm_full)</span></code></pre></div>
<p>Some examples of plots are</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="computer-practical-2---allocation-analysis.html#cb224-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>opt_diag, <span class="fu">aes</span>(<span class="at">x=</span>resid, <span class="at">fill=</span>Group)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="computer-practical-2---allocation-analysis.html#cb225-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>opt_diag, <span class="fu">aes</span>(<span class="at">x=</span>fitted, <span class="at">y=</span>resid, <span class="at">col=</span>Group)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-165-2.png" width="672" /></p>
</div>
</details>
<div class="exercise">
<p><span id="exr:unlabeled-div-92" class="exercise"><strong>Exercise B.24  </strong></span>Given the results of your ANCOVA model, what do you think the risks would be if the study had been much smaller, or if the allocation had not been well-balanced?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<div class="solution">
<p><span id="unlabeled-div-93" class="solution"><em>Solution</em>. </span>In this case, it would be possible for the baseline factors that did turn out to be significant to make it appear that the treatment had a significant effect. This wouldn’t be possible with ANCOVA, but it would with a <span class="math inline">\(t\)</span>-test in which the other covariates aren’t considered.</p>
</div>
</details>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-efron1971forcing" class="csl-entry">
Efron, Bradley. 1971. <span>“Forcing a Sequential Experiment to Be Balanced.”</span> <em>Biometrika</em> 58 (3): 403–17.
</div>
<div id="ref-giardiello1993treatment" class="csl-entry">
Giardiello, Francis M, Stanley R Hamilton, Anne J Krush, Steven Piantadosi, Linda M Hylind, Paul Celano, Susan V Booker, C Rahj Robinson, and G Johan A Offerhaus. 1993. <span>“Treatment of Colonic and Rectal Adenomas with Sulindac in Familial Adenomatous Polyposis.”</span> <em>New England Journal of Medicine</em> 328 (18): 1313–16.
</div>
<div id="ref-ruetzler2013randomized" class="csl-entry">
Ruetzler, Kurt, Michael Fleck, Sabine Nabecker, Kristina Pinter, Gordian Landskron, Andrea Lassnigg, Jing You, and Daniel I Sessler. 2013. <span>“A Randomized, Double-Blind Comparison of Licorice Versus Sugar-Water Gargle for Prevention of Postoperative Sore Throat and Postextubation Coughing.”</span> <em>Anesthesia &amp; Analgesia</em> 117 (3): 614–21.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="computer-practical-1---missing-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CT4H_notes.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"bookdown": null
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
