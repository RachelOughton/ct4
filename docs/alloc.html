<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Allocation | Clinical Trials 4H</title>
  <meta name="description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Allocation | Clinical Trials 4H" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Allocation | Clinical Trials 4H" />
  
  <meta name="twitter:description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  

<meta name="author" content="Rachel Oughton" />


<meta name="date" content="2025-01-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rct-plan.html"/>
<link rel="next" href="computer-practical-1---missing-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Clinical Trials 4H!</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#practical-details"><i class="fa fa-check"></i>Practical details</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#lectures"><i class="fa fa-check"></i>Lectures</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#computer-classes"><i class="fa fa-check"></i>Computer classes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#office-hour"><i class="fa fa-check"></i>Office Hour</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#assessment"><i class="fa fa-check"></i>Assessment</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#books-and-resources"><i class="fa fa-check"></i>Books and resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect-from-this-module"><i class="fa fa-check"></i>What to expect from this module</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-i-expect-from-you"><i class="fa fa-check"></i>What I expect from you</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="rct-intro.html"><a href="rct-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to Clinical Trials</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rct-intro.html"><a href="rct-intro.html#causal-inference-and-clinical-trials"><i class="fa fa-check"></i><b>1.1</b> Causal inference and clinical trials</a></li>
<li class="chapter" data-level="1.2" data-path="rct-intro.html"><a href="rct-intro.html#the-structure-of-a-clinical-trial"><i class="fa fa-check"></i><b>1.2</b> The structure of a clinical trial</a>
<ul>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#the-population-of-eligible-patients"><i class="fa fa-check"></i>The population of eligible patients</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#entry-to-the-trial"><i class="fa fa-check"></i>Entry to the trial</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#allocation-to-groups"><i class="fa fa-check"></i>Allocation to groups</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#comparing-results"><i class="fa fa-check"></i>Comparing results</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#why-bother-with-a-control-group"><i class="fa fa-check"></i>Why bother with a control group?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="rct-intro.html"><a href="rct-intro.html#primout"><i class="fa fa-check"></i><b>1.3</b> The primary outcome</a></li>
<li class="chapter" data-level="1.4" data-path="rct-intro.html"><a href="rct-intro.html#ethical-issues"><i class="fa fa-check"></i><b>1.4</b> Ethical issues</a></li>
<li class="chapter" data-level="1.5" data-path="rct-intro.html"><a href="rct-intro.html#phases-of-clinical-trials"><i class="fa fa-check"></i><b>1.5</b> Phases of clinical trials</a>
<ul>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-zero"><i class="fa fa-check"></i>Phase zero</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-one"><i class="fa fa-check"></i>Phase one</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-two"><i class="fa fa-check"></i>Phase two</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-three"><i class="fa fa-check"></i>Phase three</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-four"><i class="fa fa-check"></i>Phase four</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Part I: Continuous outcome variables</b></span></li>
<li class="chapter" data-level="2" data-path="rct-plan.html"><a href="rct-plan.html"><i class="fa fa-check"></i><b>2</b> Sample size for a normally distributed primary outcome variable</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rct-plan.html"><a href="rct-plan.html#the-treatment-effect"><i class="fa fa-check"></i><b>2.1</b> The treatment effect</a></li>
<li class="chapter" data-level="2.2" data-path="rct-plan.html"><a href="rct-plan.html#reminder-hypothesis-tests-with-a-focus-on-rcts"><i class="fa fa-check"></i><b>2.2</b> Reminder: hypothesis tests (with a focus on RCTs)</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="rct-plan.html"><a href="rct-plan.html#one-tailed-or-two-tailed"><i class="fa fa-check"></i><b>2.2.1</b> One-tailed or two-tailed?</a></li>
<li class="chapter" data-level="2.2.2" data-path="rct-plan.html"><a href="rct-plan.html#insignificant-results"><i class="fa fa-check"></i><b>2.2.2</b> Insignificant results</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="rct-plan.html"><a href="rct-plan.html#sec-measDcont"><i class="fa fa-check"></i><b>2.3</b> Constructing a measure of effect size</a></li>
<li class="chapter" data-level="2.4" data-path="rct-plan.html"><a href="rct-plan.html#sec-power"><i class="fa fa-check"></i><b>2.4</b> Power: If <span class="math inline">\(H_0\)</span> is false</a></li>
<li class="chapter" data-level="2.5" data-path="rct-plan.html"><a href="rct-plan.html#sec-ssformulacont"><i class="fa fa-check"></i><b>2.5</b> A sample size formula</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="alloc.html"><a href="alloc.html"><i class="fa fa-check"></i><b>3</b> Allocation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="alloc.html"><a href="alloc.html#bias"><i class="fa fa-check"></i><b>3.1</b> Bias</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="alloc.html"><a href="alloc.html#where-does-bias-come-from"><i class="fa fa-check"></i><b>3.1.1</b> Where does bias come from?</a></li>
<li class="chapter" data-level="3.1.2" data-path="alloc.html"><a href="alloc.html#implications-for-allocation"><i class="fa fa-check"></i><b>3.1.2</b> Implications for allocation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="alloc.html"><a href="alloc.html#sec-allocation"><i class="fa fa-check"></i><b>3.2</b> Allocation methods</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="alloc.html"><a href="alloc.html#simple-random-allocation"><i class="fa fa-check"></i><b>3.2.1</b> Simple random allocation</a></li>
<li class="chapter" data-level="3.2.2" data-path="alloc.html"><a href="alloc.html#random-permuted-blocks"><i class="fa fa-check"></i><b>3.2.2</b> Random permuted blocks</a></li>
<li class="chapter" data-level="3.2.3" data-path="alloc.html"><a href="alloc.html#bcurn"><i class="fa fa-check"></i><b>3.2.3</b> Biased coin designs and urn schemes</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="alloc.html"><a href="alloc.html#incorporating-baseline-measurements"><i class="fa fa-check"></i><b>3.3</b> Incorporating baseline measurements</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="alloc.html"><a href="alloc.html#stratified-sampling"><i class="fa fa-check"></i><b>3.3.1</b> Stratified sampling</a></li>
<li class="chapter" data-level="3.3.2" data-path="alloc.html"><a href="alloc.html#minimization"><i class="fa fa-check"></i><b>3.3.2</b> Minimization</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="alloc.html"><a href="alloc.html#problems-around-allocation"><i class="fa fa-check"></i><b>3.4</b> Problems around allocation</a></li>
</ul></li>
<li class="appendix"><span><b>Computer practicals</b></span></li>
<li class="chapter" data-level="A" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html"><i class="fa fa-check"></i><b>A</b> Computer Practical 1 - Missing data</a>
<ul>
<li class="chapter" data-level="" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#r-practicalities"><i class="fa fa-check"></i>R practicalities</a></li>
<li class="chapter" data-level="A.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#missing-data"><i class="fa fa-check"></i><b>A.1</b> Missing data</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#datasets"><i class="fa fa-check"></i><b>A.1.1</b> Datasets</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#understanding-the-patterns-of-missingness"><i class="fa fa-check"></i><b>A.2</b> Understanding the patterns of missingness</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#visualising-missingness"><i class="fa fa-check"></i><b>A.2.1</b> Visualising missingness</a></li>
<li class="chapter" data-level="A.2.2" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#summary-tables"><i class="fa fa-check"></i><b>A.2.2</b> Summary tables</a></li>
<li class="chapter" data-level="A.2.3" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#mechanisms-of-missingness"><i class="fa fa-check"></i><b>A.2.3</b> Mechanisms of missingness</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#exploring-the-relationship-between-missingness-and-other-variables"><i class="fa fa-check"></i><b>A.3</b> Exploring the relationship between missingness and other variables</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#sec-statsum"><i class="fa fa-check"></i><b>A.3.1</b> Statistical summaries of the effect of missingness</a></li>
<li class="chapter" data-level="A.3.2" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#modelling-missingness"><i class="fa fa-check"></i><b>A.3.2</b> Modelling missingness</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#what-to-do-about-missing-data"><i class="fa fa-check"></i><b>A.4</b> What to do about missing data?!</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#discarding-some-non-missing-data"><i class="fa fa-check"></i><b>A.4.1</b> Discarding some (non-missing) data</a></li>
<li class="chapter" data-level="A.4.2" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#imputing-data"><i class="fa fa-check"></i><b>A.4.2</b> Imputing data</a></li>
<li class="chapter" data-level="A.4.3" data-path="computer-practical-1---missing-data.html"><a href="computer-practical-1---missing-data.html#multiple-imputation"><i class="fa fa-check"></i><b>A.4.3</b> Multiple imputation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Clinical Trials 4H</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="alloc" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Allocation<a href="alloc.html#alloc" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Once we’ve decided how many participants we need in our trial, we need to determine how they will each be assigned to a trial arm. This is process is known as <strong>allocation</strong> (or sometimes as <strong>randomization</strong>). Before we think about methods for allocation, we are going to spend some time talking about bias.</p>
<div id="bias" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Bias<a href="alloc.html#bias" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In statistics, <em>bias</em> is a systematic tendency for the results of our analysis to be different from the true value. We see this particularly when we are using sample data to estimate a parameter. We will revisit what we have learned in previous courses about bias before going on to see how it affects RCTs.</p>
<div class="definition">
<p><span id="def:unlabeled-div-11" class="definition"><strong>Definition 3.1  (Bias of an estimate) </strong></span>Suppose that <span class="math inline">\(T\)</span> is a statistic calculated to estimate a parameter <span class="math inline">\(\theta\)</span>. The <strong>bias</strong> of <span class="math inline">\(T\)</span> is <span class="math display">\[E\left(T\right) - \theta.\]</span> If the bias of <span class="math inline">\(T\)</span> is zero, we say that <span class="math inline">\(T\)</span> is an <strong>unbiased estimator</strong> of <span class="math inline">\(\theta\)</span>.</p>
</div>
<p>An example you will have seen before is the standard deviation. If we have some data <span class="math inline">\(x_1,\,\ldots,x_n\)</span> that are IID <span class="math inline">\(N\left(\mu,\,\sigma^2\right)\)</span>, we can calculate the sample variance</p>
<p><span class="math display">\[ s^2 = \frac{1}{n}\sum\limits_{i=1}^n\left(x_i - \bar{x}\right)^2 .\]</span></p>
<p>In this case, <span class="math inline">\(E\left(s^2\right) \neq {\sigma^2}\)</span> (you’ve probably seen this proved so we’re not going to prove it now), and <span class="math inline">\(s^2\)</span> is a biased estimator of <span class="math inline">\(\sigma^2\)</span>. However, we know that</p>
<p><span class="math display">\[E \left(\frac{n}{n-1}s^2\right) = \sigma^2,\]</span>
and therefore we can apply this correction to the sample variance <span class="math inline">\(s^2\)</span> to produce an unbiased estimate of the population variance <span class="math inline">\(\sigma^2\)</span>. Here, the sample are representative of the population, but the size of the sample leads to some bias.</p>
<p>Now, suppose our sample <span class="math inline">\(x_1,\ldots,x_n\)</span> were drawn from <span class="math inline">\(N\left(\mu,\sigma^2\right)\)</span>, but were <strong>not</strong> independent of one another. Then, neither our estimator <span class="math inline">\(s^2\)</span>, nor our bias-corrected estimator <span class="math inline">\(\frac{n}{n-1}s^2\)</span> would have expected value <span class="math inline">\(\sigma^2\)</span>. Furthermore, we cannot use our sample <span class="math inline">\(x_1,\ldots,x_n\)</span> to produce an unbiased estimator of <span class="math inline">\(\sigma^2\)</span>, or even of the mean <span class="math inline">\(\mu\)</span>.</p>
<p>This scenario is much closer to what we mean when we talk about <em>bias</em> in a clinical trial setting. Suppose we are testing some new treatment <span class="math inline">\(T\)</span> against the standard <span class="math inline">\(C\)</span>. We measure some outcome <span class="math inline">\(X\)</span> for each patient, and our hypothesis is that <span class="math inline">\(X\)</span> behaves differently for those in the treatment group than for those in the control group. It is common practice to express this additively,
<span class="math display">\[E\left(X\right) = \mu + \tau,\]</span>
where <span class="math inline">\(\tau\)</span> is our treatment effect, which we can estimate using the difference in the groups’ means, <span class="math inline">\(\bar{X}_T - \bar{X}_C\)</span>. Our null hypothesis is that <span class="math inline">\(\tau = 0\)</span>, and our alternative hypothesis is that <span class="math inline">\(\tau\neq{0}\)</span>, and therefore an estimate of <span class="math inline">\(\tau\)</span> from our data is very important! Put equivalently, it is important that there is no bias in our estimates of <span class="math inline">\(\bar{X}_C\)</span> and <span class="math inline">\(\bar{X}_T\)</span>.</p>
<p>Usually, what this comes down to is that the assumption that the data are independent, identically distributed random variables from the relevant distributions (which we have already relied on a lot for our sample size calculations) has been violated in some way.</p>
<div class="example">
<p><span id="exm:unlabeled-div-12" class="example"><strong>Example 3.1  </strong></span>Historically, women and the elderly are underrepresented in clinical trials (<span class="citation">Cottingham and Fisher (<a href="#ref-cottingham2022gendered">2022</a>)</span>) and results are often translated from young or middle aged healthy men to these other groups (<span class="citation">Vitale et al. (<a href="#ref-vitale2017under">2017</a>)</span>). This isn’t reasonable, since women have very different hormonal activity from men, causing them to often react differently to drugs compared to men involved in the trial. The standard dose (based on trials with mostly male participants) can also be too high for many women. The complicated nature of women’s hormones is sometimes even given as a reason for not including them in the trial. Women and elderly people are also both more likely to have adverse effects to drugs in some fields.</p>
<p>There are also ethical reasons behind the low numbers of women in trials, especially phase I and phase II trials. If a woman is possibly pregnant (and trials tend to be extremely cautious in deciding who might be pregnant!) then they are quite often excluded, in order to protect the (actual or hypothetical) fetus. Indeed, in 1977 the Food and Drug Administration (FDA) in the US recommended that women be excluded from phase I and II trials (<span class="citation">Health (<a href="#ref-nationalhistory">2023</a>)</span>) as a result of some severe cases of fetuses being harmed by drugs (especially Thalidamide) . This means that even some very mainstream drugs, for example antihistamines (<span class="citation">Kar et al. (<a href="#ref-kar2012review">2012</a>)</span>), haven’t been tested for safety/efficacy during pregnancy, as well as some (for example HIV treatments) that would be of huge benefit to many many pregnant women. <a href="https://www.politico.eu/article/telescope-hiv-aids-unitaid-gender-pregnant-trials/">This article</a> is an interesting read if you would like to know more.</p>
</div>
<p>In the above example, the trial cohort is very deliberately (and arguably sometimes defensibly) not representative of the target population. However, bias can creep into trials in a number of ways.</p>
<div id="where-does-bias-come-from" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Where does bias come from?<a href="alloc.html#where-does-bias-come-from" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Having established that bias is a serious issue in clinical trials, we will think about several sources of bias. Some of these we will elaborate on as we get to the relevant part of methodology. Most sources of bias creep in during the allocation or selection phase.</p>
<div id="selection-bias" class="section level4 unnumbered hasAnchor">
<h4>Selection bias<a href="alloc.html#selection-bias" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Selection bias occurs when certain patients or subjects are systematically more (or less) likely be entered into the trial because of the treatment they will receive. In a properly run trial this isn’t possible, because it is only after a participant has been recruited that
their treatment is chosen. If a medical professional is not comfortable with a particular patient potentially receiving one of the possible treatments, then that patient should not be entered into the trial at all. If there are many such [technically eligible] patients, then this might cause the estimated treatment effect to be worryingly far from the true population treatment effect, since the recruited group of participants would not be very representative of the true population (this is not technically selection bias, but it comes from the same problem).</p>
<p>It may happen that the doctor knows which treatment a patient would be given, for example if the allocation follows some deterministic pattern, or is fully known to the doctor in advance. Consciously or subconsciously this knowledge may influence the description they give to potential participants, and this in turn may affect which patients sign up, and the balance of the groups. In practice there should be various safeguards against this situation.</p>
</div>
<div id="allocation-bias" class="section level4 unnumbered hasAnchor">
<h4>Allocation bias<a href="alloc.html#allocation-bias" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Mathematically, allocation bias is similar to selection bias, but instead of coming from human ‘error’, it arises from the random process of allocation.</p>
<p>Suppose a trial investigates a drug that is likely to have a much stronger effect on male patients than on female patients. The cohort of recruited participants are randomised into treatment and control groups, and it happens that there is a much smaller proportion of female patients in the treatment group than in the control group. This will distort the estimated treatment effect.</p>
<p>We will investigate various strategies for randomization designed to address this issue for known factors.</p>
<div class="example">
<p><span id="exm:unlabeled-div-13" class="example"><strong>Example 3.2  </strong></span><em>This example is framed in terms of selection bias, but applies equally to allocation bias</em></p>
<p>Suppose we run a trial comparing a surgical (S) and a non-surgical (N) treatment for some condition. Patients who are eligible are given the opportunity to join the trial by a single doctor.</p>
<p>The severity of the disease is graded as 1 (less serious) or 2 (more serious) for each patient. Across the full group of patients, proportion <span class="math inline">\(\lambda\)</span> have severity 1 and proportion <span class="math inline">\(1-\lambda\)</span> have severity 2.</p>
<p>Our primary outcome is survival time, <span class="math inline">\(X\)</span>, which depends on the severity of disease:</p>
<p><span class="math display">\[\begin{align*}
E\left(X\mid{1}\right) &amp; = \mu_1\\
E\left(X\mid{2}\right) &amp; = \mu_2
\end{align*}\]</span></p>
<p>and we assume <span class="math inline">\(\mu_1&gt;\mu_2\)</span>.</p>
<p>For the overall trial group, for untreated patients we have</p>
<p><span class="math display">\[ E\left(X\right) = \mu = \lambda \mu_1 + \left(1-\lambda\right)\mu_2.\]</span>
Suppose that for treatment group <span class="math inline">\(N\)</span>, the expected survival time increase by <span class="math inline">\(\tau_N\)</span>, and similarly for group <span class="math inline">\(S\)</span>, so that we have</p>
<p><span class="math display">\[\begin{align*}
E\left(X\mid{N,1}\right) &amp; = \mu_1 + \tau_N\\
E\left(X\mid{N,2}\right) &amp; = \mu_2 + \tau_N\\
E\left(X\mid{S,1}\right) &amp; = \mu_1 + \tau_S\\
E\left(X\mid{S,2}\right) &amp; = \mu_2 + \tau_S.
\end{align*}\]</span></p>
<p>If all patients were admitted with equal probability to the trial (ie. independent of the severity of their disease) then the expected survival time for group <span class="math inline">\(N\)</span>, <span class="math inline">\(E\left(X\mid{N}\right)\)</span>, would be</p>
<p><span class="math display">\[\begin{align*}
E\left(X\mid{1,N}\right)P\left(1\mid{N}\right) +  E\left(X\mid{2,N}\right)P\left(2\mid{N}\right)&amp; = \left(\mu_1 + \tau_N\right)\lambda + \left(\mu_2+\tau_N\right)\left(1-\lambda\right)\\
&amp; = \mu + \tau_N.
\end{align*}\]</span></p>
<p>Similarly, the expected survival time in group <span class="math inline">\(S\)</span> would be <span class="math inline">\(\mu+\tau_S\)</span>, and the treatment effect difference between the two would be <span class="math inline">\(\tau = \tau_N - \tau_S\)</span> and the trial is unbiased.</p>
<p>Suppose that although all eligible patients are willing to enter the trial, the doctor is reticent to subject patients with more severe disease (severity 2) to the surgical procedure. This is reflected in the way they explain the trial to each patient, particularly those with severity 2 whom the doctor knows will be assigned to group <span class="math inline">\(S\)</span>. In turn this leads to a reduced proportion <span class="math inline">\(q = 1-p\)</span> of those with severity 2 assigned to surgery entering the trial (event <span class="math inline">\(A\)</span>):</p>
<p><span class="math display">\[\begin{align*}
P\left(A\mid{N,1}\right) = P\left(A\mid{S,1}\right) = P\left(A\mid{N,2}\right) &amp; = 1 \\
P\left(A\mid{S,2}\right) &amp; = 1-p = q.
\end{align*}\]</span></p>
<p>Since our analysis is based only on those who enter the trial, our estimated treatment effect will be</p>
<p><span class="math display">\[E\left(X\mid{A, N}\right) - E\left(X\mid{A, S}\right). \]</span>
We can split these according to disease severity, so that</p>
<p><span class="math display">\[E\left(X\mid{A,N}\right) = E\left(X\mid{A,N,1}\right)P\left(1\mid{A,N}\right) + E\left(X\mid{A,N,2}\right)P\left(2\mid{A,N}\right) \]</span>
and similarly for group <span class="math inline">\(S\)</span>.</p>
<p>We can calculate <span class="math inline">\(P\left(1\mid{A,N}\right)\)</span> using Bayes’ theorem,</p>
<p><span class="math display">\[\begin{align*}
P\left(1\mid{A,N}\right) &amp; =  \frac{P\left(A\mid{1,N}\right)P\left(1\mid{N}\right)}{P\left(A\mid{N}\right)}\\
&amp; = \frac{P\left(A\mid{1,N}\right)P\left(1\mid{N}\right)}{P\left(A\mid{N,1}\right)P\left(1\mid{N}\right) + P\left(A\mid{N,2}\right)P\left(2\mid{N}\right)} \\
&amp;= \frac{1\times{\lambda}}{1\times {\lambda} + 1 \times{\left(1-\lambda\right)}}\\
&amp; = \lambda.
\end{align*}\]</span>
Therefore we also have <span class="math inline">\(P\left(2\mid{A,N}\right) = 1 -P\left(1\mid{A,N}\right) =  1-\lambda\)</span>.</p>
<p>Following the same process for group <span class="math inline">\(S\)</span>, we arrive at</p>
<p><span class="math display">\[\begin{align*}
P\left(1\mid{A,S}\right) &amp; =  \frac{P\left(A\mid{1,S}\right)P\left(1\mid{S}\right)}{P\left(A\mid{S}\right)}\\
&amp; = \frac{P\left(A\mid{1,S}\right)P\left(1\mid{S}\right)}{P\left(A\mid{S,1}\right)P\left(1\mid{S}\right) + P\left(A\mid{S,2}\right)P\left(2\mid{S}\right)} \\
&amp; = \frac{\lambda}{\lambda + q\left(1-\lambda\right)},
\end{align*}\]</span></p>
<p>which we will call <span class="math inline">\(b\)</span>.</p>
<p>Notice that <span class="math inline">\(P\left(2\mid{S}\right)= 1-\lambda\)</span>, since it is not conditional on actually participating in the trial. Therefore,</p>
<p><span class="math display">\[\begin{align*}
E\left(X\mid{A,N}\right) &amp; = E \left(X\mid{N,1}\right)P\left(1\mid{A,N}\right) + E \left(X\mid{N,2}\right)P\left(2\mid{A,N}\right) \\
&amp; = \left(\mu_1 + \tau_N\right)\lambda + \left(\mu_2 + \tau_N\right)\left(1-\lambda\right) \\
&amp; = \lambda\mu_1 + \left(1-\lambda\right)\mu_2 + \tau_N
\end{align*}\]</span></p>
<p>and</p>
<p><span class="math display">\[\begin{align*}
E\left(X\mid{A,S}\right) &amp; = E \left(X\mid{S,1}\right)P\left(1\mid{A,S}\right) + E \left(X\mid{S,2}\right)P\left(2\mid{A,S}\right) \\
&amp; = \left(\mu_1 + \tau_S\right)b + \left(\mu_2 + \tau_S\right)\left(1-b\right) \\
&amp; = b\mu_1 + \left(1-b\right)\mu_2 + \tau_S.
\end{align*}\]</span></p>
<p>From here, we can calculate the expected value of the treatment effect <span class="math inline">\(\tau\)</span> as (substituting our equation for <span class="math inline">\(b\)</span> and rearranging):</p>
<p><span class="math display">\[\begin{align*}
E\left(X\mid{A,N}\right) - E\left(X\mid{A,S}\right) &amp; = \tau_N - \tau_S + \left(\lambda - b\right)\left(\mu_1 - \mu_2\right) \\
&amp; = \tau_N - \tau_S - \frac{p\lambda\left(1-\lambda\right)\left(\mu_1  - \mu_2\right)}{\lambda + q\left(1-\lambda\right)},
\end{align*}\]</span></p>
<p>where the third term represents the bias.</p>
<p>Notice that if <span class="math inline">\(q=1-p = 1\)</span>, then there is no bias. There is also no bias if <span class="math inline">\(\mu_1 = \mu_2\)</span>, ie. if there is no difference between the disease severity groups in terms of survival time.</p>
<p>Assuming <span class="math inline">\(\mu_1 - \mu_2 &gt;0\)</span>, then the bias term is positive and</p>
<p><span class="math display">\[E\left(X\mid{A,N}\right)- E\left(X\mid{A,S}\right) &lt; \tau_N - \tau_S.\]</span>
If <span class="math inline">\(N\)</span> is the better treatment, then <span class="math inline">\(\tau_N - \tau_S&gt;0\)</span> and the bias will cause the trial to underplay the treatment effect. Conversely, if <span class="math inline">\(S\)</span> is better, then <span class="math inline">\(\tau_N-\tau_S&lt;0\)</span> and the trial will exaggerate the treatment effect. Essentially, this is because more severely ill patients have been assigned to <span class="math inline">\(N\)</span> than to <span class="math inline">\(S\)</span>, which reduces the average survival time for those in group <span class="math inline">\(N\)</span>.</p>
</div>
</div>
<div id="assessment-bias" class="section level4 unnumbered hasAnchor">
<h4>Assessment bias<a href="alloc.html#assessment-bias" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Measurements are made on participants throughout the trial. These measurements will often be objective, for example the patients’ weight, or concentration of blood sugar. However, some types of measurement are much more subject to the individual practitioner assessing the patient. For example, many skin conditions are assessed visually, for example estimating the proportion of the body affected. Measuring quantities such as quality of life or psychological well-being involve many subjective judgements on the part of both patient and clinician.</p>
<p>Clearly it is ideal for both the patient and the clinician not to know which arm of the trial the patient was part of (this is known as a <strong>double blind trial</strong>). For treatments involving drugs, this is usually straightforward. However, for surgical interventions it is often impossible to keep a trial ‘blind’, and for interventions involving therapy (for example cognitive behavioural therapy) it is impossible for the patient to be unaware. In this situation, it is possible for the patient or clinician’s judgement to be affected by their knowledge of the allocation, thus affecting the estimated treatment effect.</p>
</div>
<div id="slight-aside-publication-bias" class="section level4 unnumbered hasAnchor">
<h4>Slight aside: publication bias<a href="alloc.html#slight-aside-publication-bias" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In most areas of science, including clinical trials, the ultimate aim is to affect practice. This is usually done by publishing a write-up of the trial, including its design, methods, analysis and results, and publishing that in a [medical] journal. These are peer-reviewed, which means that experts from the relevant field are ask to review submitted papers, and either reject or accept them (usually conditional on some revision). These reviewers advise the editor of the journal, who ultimately decides whether or not the paper will be published.</p>
<p>There is compelling evidence that papers reporting positive / conclusive results are more likely to be published than papers about [viable] trials that ultimately fail to reject the null hypothesis. As we know, in most cases if the null hypothesis is rejected this is indicative that there is a true treatment difference. However, sometimes by random chance a trial will detect a difference even when there isn’t one (approximately 5% of the time if <span class="math inline">\(\alpha=0.05\)</span>). If these papers are disproportionately likely to be published, the body of literature will not reflect the truth, and there may be serious implications for practice. This is a huge issue in the pharmaceutical industry, and one from which we can’t escape. If you’d like to learn more about it the book ‘Bad Pharma’ by <span class="citation">Goldacre (<a href="#ref-goldacre2012bad">2012</a>)</span> is an excellent source.</p>
<p>Measures are being taken to prevent this: for example, leading medical journal <em>The Lancet</em> insists that any clinical trial related paper is registered with them before the first participant has been recruited, with details of the design and statistical analysis plan. This is then reviewed before the trial begins.</p>
</div>
</div>
<div id="implications-for-allocation" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Implications for allocation<a href="alloc.html#implications-for-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Historically (and probably still, to an extent), clinical trials have not necessarily used random allocation to assign participants to groups. <span class="citation">Altman and Bland (<a href="#ref-altman1999treatment">1999</a>)</span> gives an overview of why this has led to bias, and gives some examples.</p>
<p>Sometimes analyses compare groups in serial, so that <span class="math inline">\(N_A\)</span> patients one year (say) form the control group, and <span class="math inline">\(N_B\)</span> patients in a subsequent year, who are given treatment <span class="math inline">\(B\)</span>, form the intervention group. In this scenario it is impossible to control for all other changes that have occurred with time, and this leads to a systematic bias, usually in favour of treatment <span class="math inline">\(B\)</span>.</p>
<p>Given the need for contemporary control participants, the question becomes how to assign participants to each group. If the clinician is able to choose who receives which treatment, or if each patient is allowed to choose or refuse certain treatments, this is almost certain to introduce bias. This is avoided by using random allocation.</p>
<p>There are two important aspects to the allocation being <em>random</em> that we will draw attention to.</p>
<ol style="list-style-type: decimal">
<li>Every patient should have the same probability of being assigned to each treatment group.</li>
<li>The treatment group for a particular patient should not be able to be predicted.</li>
</ol>
<p>Point 1 is important because, as we have already mentioned, the statistical theory we use to plan and analyse the trial is based on the groups being random samples from the population.</p>
<p>Point 2 is important to avoid biases that come through the assignment of a particular patient being known either in advance or after the fact. There are some approaches that ‘pass’ the first point, but fail at the second. As well as strict alternation (<span class="math inline">\(ABABAB\ldots\)</span>), some such methods use patient characteristics such as date of birth or first letter of surname, which is not related to the trial outcome, but which enables allocations to be predicted.</p>
<p>We will now explore some commonly used methods of allocation. We will usually assume two equally sized groups, <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, but it is simple to generalize to three or more groups, or to unequal allocation.</p>
</div>
</div>
<div id="sec-allocation" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Allocation methods<a href="alloc.html#sec-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="simple-random-allocation" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Simple random allocation<a href="alloc.html#simple-random-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Perhaps intuitively the most simple method is a ‘toin coss’, where each participant has a probability 0.5 of being placed in each group. As participants arrive, assignment <span class="math inline">\(C\)</span> or <span class="math inline">\(T\)</span> is generated (with equal probability). Statistically, this scheme is ideal, since it generates the random sample we need, and the assignment of each participant is statistically independent of that of all other participants. It also doesn’t require a ‘master’ randomisation; several clinicians can individually assign participants to treatment groups in parallel and the statistical properties are maintained.</p>
<p>This method is used effectively in many large trials, but for small trials it can be statistically problematic. The main reason for this is chance imbalance of group sizes.</p>
<p>Suppose we have two groups, <span class="math inline">\(T\)</span> of size <span class="math inline">\(N_T\)</span> and <span class="math inline">\(C\)</span> of size <span class="math inline">\(N_C\)</span>, with <span class="math inline">\(N_T + N_C = 2n\)</span>. Patients are allocated independently with equal probability, which means</p>
<p><span class="math display">\[N_C \sim \operatorname{Bi}\left(2n,\frac{1}{2}\right), \]</span>
and similar for <span class="math inline">\(N_T\)</span>. If the two groups are of unequal size, the larger will be of some size <span class="math inline">\(N_{max}\)</span> between <span class="math inline">\(n\)</span> and <span class="math inline">\(2n\)</span>, such that for <span class="math inline">\(r = n+1,\,\ldots,\,2n,\)</span></p>
<p><span class="math display">\[\begin{align*}
P\left(N_{max} = r\right) &amp; = P\left(N_C = r\right) + P\left(N_T = r\right) \\
&amp; = 2\binom{2n}{r}\left(\frac{1}{2}\right)^{2n}.
\end{align*}\]</span>
The probability that <span class="math inline">\(N_C = N_T = n\)</span> is</p>
<p><span class="math display">\[ P\left(N_T = N_C = n\right)= \binom{2n}{n}\left(\frac{1}{2}\right)^{2n}. \]</span>
These probabilities are shown in Figure <a href="alloc.html#fig:srs-alloc">3.1</a>. We can see that this method leads to very unequal groups relatively easily; with <span class="math inline">\(n=15\)</span>, <span class="math inline">\(P\left(N_{max}\geq 20\right) = 0.099\)</span>, so there is around a one in ten chance that one group will be double or more the size of the other.</p>
<div class="figure"><span style="display:block;" id="fig:srs-alloc"></span>
<img src="CT4H_notes_files/figure-html/srs-alloc-1.png" alt="The probability distribution of largest group size for n=15." width="672" />
<p class="caption">
Figure 3.1: The probability distribution of largest group size for n=15.
</p>
</div>
<p>As we have seen when thinking about sample sizes in Section <a href="rct-plan.html#sec-power">2.4</a>, this will reduce the power <span class="math inline">\(\Psi\)</span> of the trial, since it depends on <span class="math inline">\(\lambda\left(N_C,\,N_T\right) = \sqrt{\frac{1}{N_C} + \frac{1}{N_T}}\)</span>.</p>
<div class="aside">
<p>In this chapter, and in the computer practical on allocation, we will study the behaviour of various allocation methods by implementing them many times. This gives us an idea of how variable the results are, especially in terms of being likely to introduce bias or reduce power. In almost all real trials, patients are allocated and begin treatment as they arrive, and this may happen over the course of weeks or months. The allocation that is generated is the final allocation.</p>
</div>
<p>For larger trials, this imbalance will be less pronounced, for example Figure <a href="alloc.html#fig:srsalloc200">3.2</a> shows the same for <span class="math inline">\(n=200\)</span>.</p>
<div class="figure"><span style="display:block;" id="fig:srsalloc200"></span>
<img src="CT4H_notes_files/figure-html/srsalloc200-1.png" alt="The probability distribution of largest group size for n=200." width="672" />
<p class="caption">
Figure 3.2: The probability distribution of largest group size for n=200.
</p>
</div>
<p>In this case <span class="math inline">\(P\left(N_{max} \geq 220\right)=0.051\)</span>, so the chance of highly imbalanced groups is much lower. However, we may want to achieve balance on some factor thought to be important, for example sex, age group or disease state, and in this case there may be small numbers even in a large trial.</p>
<p>We saw in the sample size section that the greatest power is achieved when group sizes are equal, since this minimises the function</p>
<p><span class="math display">\[\lambda\left(n,m\right) = \sqrt{\frac{1}{n}+\frac{1}{m}}.\]</span>
However, with simple random sampling we can’t guarantee equal group sizes.</p>
<div class="example">
<p><span id="exm:unlabeled-div-14" class="example"><strong>Example 3.3  </strong></span>Suppose we are designing a trial to have <span class="math inline">\(\alpha=0.05\)</span>, and our minimum detectable effect size is such that <span class="math inline">\(\frac{\tau_M}{\sigma}=1\)</span>. If 30 participants are recruited, then we can calculate the power of the study using methods from Chapter 2:</p>
<p><span class="math display">\[1-\beta = \Phi\left(\sqrt{\frac{n_T\,n_C}{30}} - 1.96\right). \]</span>
The first term in the standard normal CDF comes from the fact that</p>
<p><span class="math display">\[\left[\lambda\left(n,m\right)\right]^{-1} = \sqrt{\frac{nm}{n+m}} .\]</span>
If we have equal group sizes <span class="math inline">\(n_T=n_C=15\)</span>, then the power achieved is 78%.
If the group sizes are 10 and 20, we have a power of 73%.
If the group sizes are 6 and 24, the power goes down to 59%.</p>
<p>So, as we saw when looking at power, we don’t lose too much if the group sizes are 2:1, but a more pronounced imbalace has resulted in a much more noticeable loss. There may be other disadvantages to having such imbalance, for example increased costs, or a reduction in the amount of information gained about side effects. If this imbalance can be avoided, it should be.</p>
</div>
</div>
<div id="random-permuted-blocks" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Random permuted blocks<a href="alloc.html#random-permuted-blocks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One commonly used method to randomly allocate participants while avoiding imbalance is to use <em>random permuted blocks</em> (RPBs). With RPBs we randomly generate the allocation in <em>blocks</em> of some predetermined size. If the blocks have size <span class="math inline">\(2m\)</span>, and there are two groups then there are <span class="math display">\[\binom{2m}{m},\]</span> but this method can be adapted to more than two groups and to unequal group size.</p>
<div class="example">
<p><span id="exm:unlabeled-div-15" class="example"><strong>Example 3.4  </strong></span>If we have two groups, <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, then there are six <em>blocks</em> of length 4 containing two <span class="math inline">\(A\)</span>s and two <span class="math inline">\(B\)</span>s</p>
<p><span class="math display">\[
\begin{aligned}
1.&amp; AABB\\
2.&amp; ABAB\\
3.&amp; ABBA\\
4.&amp; BAAB\\
5.&amp; BABA\\
6.&amp; BBAA.
\end{aligned}
\]</span></p>
<p>We can also randomly generate a sequence of numbers from <span class="math inline">\(\left\lbrace 1, 2, 3, 4, 5, 6 \right\rbrace\)</span>, where each number has equal probability. This sequence will correspond to a sequence in <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> with four times the length. In this method, each patient is equally likely to receive <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, but there will never be a difference of more than two between the size of the two groups.</p>
<p>For example, suppose the sequence begins <span class="math inline">\(2,1,3,6,\ldots\)</span>. Replacing each number by its block, we have <span class="math inline">\(ABAB\;AABB\;ABBA\;BBAA\;\ldots\)</span>.</p>
</div>
<p>One serious disadvantage of this method is that if the block size is fixed, and the doctors involved in the trial know which participants have received which treatments (which is unavoidable in cases such as surgery), then the allocation for some patients can be perfectly predicted. For blocks of size four this is true for the fourth in every block, and for the third and fourth if the first two were the same. This means that selection bias may be a problem in more than 25% of participants, which is deemed unacceptable; indeed, it fails our second point about randomization.</p>
<div id="rpbs-with-random-block-length" class="section level4 hasAnchor" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> RPBs with random block length<a href="alloc.html#rpbs-with-random-block-length" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The issue above can be circumvented by not only randomly choosing from a selection of blocks, but also randomly choosing the length of the block. For example, there are
<span class="math display">\[ \binom{6}{3} = 20\]</span>
possible blocks of size 6. Instead of always selecting from the six possible 4-blocks, a sampling scheme can be as follows.</p>
<ol style="list-style-type: decimal">
<li>A random number <span class="math inline">\(X\)</span> is drawn from <span class="math inline">\(\left\lbrace 4,6\right\rbrace\)</span> to select the block length.</li>
<li>A second random number <span class="math inline">\(Y\)</span> is drawn from 1 to 6 (if the block length is four) or 1 to 20 (if the block length is 6).</li>
<li>The block corresponding to <span class="math inline">\(Y\)</span> is chosen and participants assigned accordingly.</li>
<li>If more participants are needed, go back to step 1.</li>
</ol>
<p>As well as ensuring that patients are equally likely to receive treatments <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, and that <span class="math inline">\(N_A\)</span> and <span class="math inline">\(N_B\)</span> can never differ by more than three, this method hugely reduces the possibility of enabling selection bias. The assignment of a patient can only be perfectly predicted if the difference is three, and this happens only for two of the twenty blocks of length six.</p>
</div>
</div>
<div id="bcurn" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Biased coin designs and urn schemes<a href="alloc.html#bcurn" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It may be that we prefer a method that achieves balance while retaining the pure stochasticity of simple random sampling. An advantage of RPBs was that once the sequence was generated, no computing power was needed. However, it is safe now to assume that any hospital pharmacy, nurse’s station, GP office or other medical facility will have a computer with access to the internet (or some internal database), and therefore more sophisticated methods are available. It is also very likely that all trial data may be stored on some central database, and so methods that rely on knowing the allocation so far (albeit in some encrypted form) should be possible even if there are multiple clinicians and sites involved.</p>
<p>Biased coin designs and urn schemes both work by adjusting the probabilities of allocation according to balance of the design so far, such that a participant is less likely to be assigned to an over-represented group.</p>
<div id="biased-coin-designs" class="section level4 hasAnchor" number="3.2.3.1">
<h4><span class="header-section-number">3.2.3.1</span> Biased coin designs<a href="alloc.html#biased-coin-designs" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The biased coin design was introduced by <span class="citation">Efron (<a href="#ref-efron1971forcing">1971</a>)</span>, with the aim of ensuring balance whilst not becoming vulnerable to various forms of experimental bias. <span class="citation">Efron (<a href="#ref-efron1971forcing">1971</a>)</span> suggested the biased coin design be used within categories (eg. age group, sex, disease state etc.), but in this section we will think about the whole cohort (the maths for a subgroup would be the same).</p>
<p>Suppose we are using a biased coin design for a trial to compare two treatments, <span class="math inline">\(T\)</span> and <span class="math inline">\(C\)</span>. At the point where some number <span class="math inline">\(n\)</span> (not the total trial cohort) have been allocated, we can use the notation <span class="math inline">\(N_T\left(n\right)\)</span> for the number of participants allocated to treatment <span class="math inline">\(T\)</span>, and <span class="math inline">\(N_C\left(n\right)\)</span> for the number of participants allocated to treatment <span class="math inline">\(C\)</span>. Using these, we can denote the <em>imbalance</em> in treatment numbers by</p>
<p><span class="math display">\[ D\left(n\right) = N_T\left(n\right) - N_C\left(n\right) = 2N_T\left(n\right) - n.\]</span>
We use the imbalance <span class="math inline">\(D\left(n\right)\)</span> to alter the probability of allocation to each treatment in order to restore (or maintain) balance in the following way:</p>
<ul>
<li>If <span class="math inline">\(D\left(n\right)=0\)</span>, allocate patient <span class="math inline">\(n+1\)</span> to treatment <span class="math inline">\(T\)</span> with probability <span class="math inline">\(\frac{1}{2}\)</span>.</li>
<li>If <span class="math inline">\(D\left(n\right)&lt;0\)</span>, allocate patient <span class="math inline">\(n+1\)</span> to treatment <span class="math inline">\(T\)</span> with probability <span class="math inline">\(P\)</span>.</li>
<li>If <span class="math inline">\(D\left(n\right)&gt;0\)</span>, allocate patient <span class="math inline">\(n+1\)</span> to treatment <span class="math inline">\(T\)</span> with probability <span class="math inline">\(1-P\)</span>.</li>
</ul>
<p>where <span class="math inline">\(P\in\left(\frac{1}{2}, 1\right)\)</span>.</p>
<blockquote>
<p>Question: What would happen if <span class="math inline">\(P=\frac{1}{2}\)</span> or <span class="math inline">\(P=1\)</span>?</p>
</blockquote>
<p>If, at some point in the trial, we have <span class="math inline">\(\lvert D\left(n\right)\rvert = j\)</span>, for some <span class="math inline">\(j&gt;0\)</span>, then we must have either</p>
<p><span class="math display">\[ \lvert D\left(n+1\right)\rvert = j+1 \]</span>
or
<span class="math display">\[ \lvert D\left(n+1\right)\rvert = j-1 .\]</span>
Because of the way we have set up the scheme,</p>
<p><span class="math display">\[ p\big(\lvert D\left(n+1\right)\rvert = j+1\big) = 1-P \]</span>
and</p>
<p><span class="math display">\[ p\big(\lvert D\left(n+1\right)\rvert = j-1\big) = P.\]</span>
If <span class="math inline">\(\lvert D\left(n\right) \rvert = 0\)</span>, ie. the scheme is in exact balance after <span class="math inline">\(n\)</span> allocations, then we must have <span class="math inline">\(\lvert D\left(n\right)\rvert = 1\)</span>.</p>
<p>The absolute imbalances therefore form a simple random walk on the non-negative integers, with transition probabilities</p>
<p><span class="math display">\[
  \begin{aligned}
P\bigg(\lvert D\left(n+1\right) \rvert = 1 \; \bigg| \;\lvert D\left(n\right)\rvert=0\bigg)&amp; = 1\\
P\bigg(\lvert D\left(n+1\right) \rvert = j+ 1 \; \bigg| \; \lvert D\left(n\right)\rvert=j\bigg)&amp; = 1 - P\\
P\bigg(\lvert D\left(n+1\right) \rvert = j-1 \; \bigg| \; \lvert D\left(n\right)\rvert=j\bigg)&amp; = P
\end{aligned}
\]</span>
Figure <a href="alloc.html#fig:biasedcoin-p2thirds">3.3</a> shows four realisations of this random walk with <span class="math inline">\(P=0.667\)</span> (Efron’s preferred value). We see that sometimes the imbalance gets quite high, but in general it isn’t too far from 0.</p>
<div class="figure"><span style="display:block;" id="fig:biasedcoin-p2thirds"></span>
<img src="CT4H_notes_files/figure-html/biasedcoin-p2thirds-1.png" alt="Absolute imbalance for a biased-coin scheme  with $P=0.667$." width="672" />
<p class="caption">
Figure 3.3: Absolute imbalance for a biased-coin scheme with <span class="math inline">\(P=0.667\)</span>.
</p>
</div>
<p>Figure <a href="alloc.html#fig:p-nearlyhalf">3.4</a> shows four realisations of the random walk with <span class="math inline">\(P=0.55\)</span>. Here, the imbalance is able to get very high (note the change in <span class="math inline">\(y\)</span>-axis); for example in the first plot, if we stopped the trial at <span class="math inline">\(n=50\)</span> we would have 34 participants in one arm and only 16 in the other.</p>
<div class="figure"><span style="display:block;" id="fig:p-nearlyhalf"></span>
<img src="CT4H_notes_files/figure-html/p-nearlyhalf-1.png" alt="Absolute imbalance for a biased-coin scheme  with $P = 0.55$." width="672" />
<p class="caption">
Figure 3.4: Absolute imbalance for a biased-coin scheme with <span class="math inline">\(P = 0.55\)</span>.
</p>
</div>
<p>By contrast, with <span class="math inline">\(P=0.9\)</span> as in Figure <a href="alloc.html#fig:p-nearlyone">3.5</a>, there is much less imbalance. However, this brings with it greater predictability. Although allocation is always random, given some degree of imbalance (likely to be known about by those executing the trial), the probability of guessing the next allocation correctly is high (0.9). This invites the biases we have been trying to avoid, albeit in an imperfect form.</p>
<div class="figure"><span style="display:block;" id="fig:p-nearlyone"></span>
<img src="CT4H_notes_files/figure-html/p-nearlyone-1.png" alt="Absolute imbalance for a biased-coin scheme  with $P = 0.9$." width="672" />
<p class="caption">
Figure 3.5: Absolute imbalance for a biased-coin scheme with <span class="math inline">\(P = 0.9\)</span>.
</p>
</div>
<p>Efron’s suggestion for implementation was that each clinician would received an unordered stack of envelopes. Each would contain three more envelopes, each with instructions covering one of the three possible cases (<span class="math inline">\(\lvert D\left(n\right)\rvert&lt;0,\,\lvert D\left(n\right)\rvert=0\)</span> and <span class="math inline">\(\lvert D\left(n\right)\rvert&gt;0\)</span>). The clinician would open the appropriate envelope and implement the instruction. Remember this was 1971!</p>
<p>A big disadvantage to the biased coin scheme is that the same probability is used regardless of the size of the imbalance (assuming it isn’t zero). In the next section, we introduce a method where the probability of allocating the next patient to the underrepresented treatment gets larger as the imbalance grows.</p>
</div>
<div id="urn-models" class="section level4 hasAnchor" number="3.2.3.2">
<h4><span class="header-section-number">3.2.3.2</span> Urn models<a href="alloc.html#urn-models" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><em>Urn models</em> for treatment allocation use urns in the way that you might well remember from school probability (or indeed often we had drawers of socks). They were first applied to clinical trials by <span class="citation">Wei (<a href="#ref-wei1978application">1978</a>)</span>. In this setting, the urn starts off with a ball for each treatment, and a ball is added to the urn each time a participant is allocated. The ball is labelled according to the treatment allocation that participant <strong>did not</strong> receive.</p>
<p>To allocate the next participant, a ball is drawn from the urn. If the allocations at this point are balanced, then the participant has equal probability of being allocated to each treatment. If there is imbalance, there will be more balls labelled by the underrepresented treatment, and so the participant is more likely to be allocated to that one. The greater the imbalance, the higher the probability of reducing it.</p>
<p>The process described so far is a <span class="math inline">\(UD\left(1,1\right)\)</span>; there is one ball for each treatment to start with, and one ball is added to the urn after each allocation. To be more general, we can assume a <span class="math inline">\(UD\left(r,s\right)\)</span> scheme. Now, there are <span class="math inline">\(r\)</span> balls for each treatment in the urn to begin with, and <span class="math inline">\(s\)</span> are added after each allocation.</p>
<p>Near the start of the allocation, the probabilities are likely to change a lot to address imbalance, but once a ‘reasonable number’ of allocations have been made it is likely to settle into simple random sampling (or very close).</p>
<p>Once again, we can find the transition probabilities by considering the absolute imbalance <span class="math inline">\(\lvert D\left(n\right) \rvert\)</span>.</p>
<p>Suppose that after participant <span class="math inline">\(n\)</span>, <span class="math inline">\(N_T\left(n\right)\)</span> participants have been allocated to group <span class="math inline">\(T\)</span>, and <span class="math inline">\(N_C\left(n\right) = n - N_T\left(n\right)\)</span> to group <span class="math inline">\(C\)</span>. The imbalance is therefore</p>
<p><span class="math display">\[D\left(n\right) = N_T\left(n\right) - N_C\left(n\right) = 2N_T\left(n\right) - n.\]</span>
After <span class="math inline">\(n\)</span> allocations there will be <span class="math inline">\(2r + ns\)</span> balls in the urn: <span class="math inline">\(r\)</span> for each treatment at the start, and <span class="math inline">\(s\)</span> added after each allocation. Of these, <span class="math inline">\(r + N_C\left(n\right)s\)</span> will be labelled by treatment <span class="math inline">\(T\)</span> and <span class="math inline">\(r + N_T\left(n\right)s\)</span> by treatment <span class="math inline">\(C\)</span>.</p>
<p>To think about the probabilities for the absolute imbalance <span class="math inline">\(\lvert D\left(n\right)\rvert\)</span>, we have to be careful now about which direction it is in. If the trial currently (after allocation <span class="math inline">\(n\)</span>) has an imbalance of participants in favour of treatment <span class="math inline">\(C\)</span>, then the probability that it becomes less imbalanced at the next allocation is the probability of the next allocation being to treatment <span class="math inline">\(T\)</span>, which is</p>
<p><span class="math display">\[
  \begin{aligned}
p\left(\lvert D\left(n+1\right)\rvert = j-1 \mid D\left(n\right)=j, j&gt;0\right) &amp; = \frac{r + N_C\left(n\right)s}{2r + ns} \\
&amp; = \frac{r + \frac{1}{2}\left(n + D\left(n\right)\right)s}{2r + ns} \\
&amp; = \frac{1}{2} + \frac{D\left(n\right)s}{2\left(2r + ns\right)} \\
&amp; = \frac{1}{2} + \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}.
\end{aligned}
\]</span>
Similarly, if there is currently an excess of patients allocated to treatment <span class="math inline">\(T\)</span>, then the imbalance will be reduced if the next allocation is to treatment <span class="math inline">\(C\)</span>, and so the conditional probability is</p>
<p><span class="math display">\[
  \begin{aligned}
p\left(\lvert D\left(n+1\right)\rvert = j-1 \mid D\left(n\right)=j, j&lt;0\right) &amp; = \frac{r + N_T\left(n\right)s}{2r + ns} \\
&amp; = \frac{r + \frac{1}{2}\left(n - D\left(n\right)\right)s}{2r + ns} \\
&amp; = \frac{1}{2} - \frac{D\left(n\right)s}{2\left(2r + ns\right)}\\
&amp; = \frac{1}{2} + \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}.
\end{aligned}
\]</span></p>
<p>Because the process is symmetrical, an imbalance of a given magnitude (say <span class="math inline">\(\lvert D\left(n\right)\rvert=j\)</span>) is equally likely to be in either direction. That is</p>
<p><span class="math display">\[p\big(D\left(n\right) &lt; 0 \mid \lvert D\left(n\right)\rvert =j \big)= p\big(D\left(n\right) &gt; 0 \mid \lvert D\left(n\right)\rvert =j \big) = \frac{1}{2}.\]</span></p>
<p>Therefore we can use the law of total probability (or partition theorem) to find that</p>
<p><span class="math display">\[
  p\big(\lvert D\left(n+1\right) \rvert = j-1 \mid \lvert D\left(n\right) \rvert = j \big) = \frac{1}{2}  + \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}.
\]</span>
Since the two probabilities are equal this is trivial. Since the only other possibility is that the imbalance is increased by one, we also have</p>
<p><span class="math display">\[p\big(\lvert D\left(n+1\right) \rvert = j+1 \mid \lvert D\left(n\right) \rvert = j \big) = \frac{1}{2}  - \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}. \]</span>
As with the biased coin design, we also have the possibility that the imbalance after <span class="math inline">\(n\)</span> allocations is zero, in which case the absolute imbalance after the next allocation will definitely be one. This gives us another simple random walk, with</p>
<p><span class="math display">\[
  \begin{aligned}
P\big(\lvert D\left(n+1\right) \rvert = 1 \mid \lvert D\left(n\right)=0\big)&amp; = 1\\
P\big(\lvert D\left(n+1\right) \rvert = j+ 1 \mid \lvert D\left(n\right)=j\big)&amp; = \frac{1}{2}  - \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}\\
P\big(\lvert D\left(n+1\right) \rvert = j-1 \mid \lvert D\left(n\right)=j\big)&amp; = \frac{1}{2}  + \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}
\end{aligned}
\]</span></p>
<div class="figure"><span style="display:block;" id="fig:urn11"></span>
<img src="CT4H_notes_files/figure-html/urn11-1.png" alt="Four realisations of absolute imbalance for r=1, s=1, N=50." width="672" />
<p class="caption">
Figure 3.6: Four realisations of absolute imbalance for r=1, s=1, N=50.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:urn18"></span>
<img src="CT4H_notes_files/figure-html/urn18-1.png" alt="Four realisations of absolute imbalance for r=1, s=8, N=50." width="672" />
<p class="caption">
Figure 3.7: Four realisations of absolute imbalance for r=1, s=8, N=50.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:urn81"></span>
<img src="CT4H_notes_files/figure-html/urn81-1.png" alt="Four realisations of absolute imbalance for r=8, s=1, N=50." width="672" />
<p class="caption">
Figure 3.8: Four realisations of absolute imbalance for r=8, s=1, N=50.
</p>
</div>
<p>We see that imbalance is reduced, particularly for small <span class="math inline">\(n\)</span>. A small <span class="math inline">\(r\)</span> and large <span class="math inline">\(s\)</span> enhance this, since the large number (<span class="math inline">\(s\)</span>) of balls added to the urn with each allocation weight the probabilities more heavily, as in Figure <a href="alloc.html#fig:urn18">3.7</a>. By contrast, if <span class="math inline">\(r\)</span> is large and <span class="math inline">\(s\)</span> is small, as in Figure <a href="alloc.html#fig:urn81">3.8</a>, the probabilities stay closer to <span class="math inline">\(\left(\frac{1}{2}, \frac{1}{2}\right)\)</span> and so more imbalance occurs early on.</p>
</div>
</div>
</div>
<div id="incorporating-baseline-measurements" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Incorporating baseline measurements<a href="alloc.html#incorporating-baseline-measurements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>At the start of the trial (ideally before allocation) various baseline measurements are usually taken. If the primary outcome variable is a continuous measurement (eg. blood pressure, weight,…) this same quantity will often be included, so that there is some measure of each participant’s condition/symptoms at the start of the trial. Factors such as age, sex, level of symptoms, things to do with treatment history and many others are included. Essentially, we include any variable we can that may lead to bias if not properly dealt with. The crucial thing is that none of these measurements (taken when they are) should be affected by the trial.</p>
<p>Such baseline measurements can be used in allocation.</p>
<div id="stratified-sampling" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Stratified sampling<a href="alloc.html#stratified-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The usual method of achieving balance with respect to prognostic factors is to divide each factor into several levels and to consider treatment assignment separately for patients having each particular combination of such factor levels. Such groups of patients are commonly referred to as randomization groups or strata. Treatment assignment is performed entirely separately for each stratum, a permuted block design of the type mentioned above often being used. In fact, using purely random treatment assignment for each stratum is equivalent to simple random assignment, so that some equalization of treatment numbers within each stratum is essential. Both the biased coin design and the urn design were intended for use in this way, adjusting in relation to imbalance within each stratum independently. This whole procedure is analogous to performing a factorial experiment, without being able to control the factor levels of the experimental units.</p>
<div class="example">
<p><span id="exm:unlabeled-div-16" class="example"><strong>Example 3.5  </strong></span>Suppose we are planning a trial involving people over the age of 50, and we anticipate that age and sex might both play an important role in how participants respond to the treatment.</p>
<p>For sex, we use the levels ‘male’ and ‘female’, and for age we split the range into 50-65, 66-80 and 81 or over. We therefore have six strata, and we use an allocation strategy independently in each stratum. For example, below we have used randomly permuted blocks of length four.</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Male
</th>
<th style="text-align:left;">
Female
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
50-65
</td>
<td style="text-align:left;">
ABAB BBAA …
</td>
<td style="text-align:left;">
ABBA BBAA …
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
66-80
</td>
<td style="text-align:left;">
BAAB AABB …
</td>
<td style="text-align:left;">
BABA BAAB …
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
81 and over
</td>
<td style="text-align:left;">
ABAB ABBA …
</td>
<td style="text-align:left;">
ABBA BAAB …
</td>
</tr>
</tbody>
</table>
<p>Each time a new participant arrives, we follow the randomization pattern for their stratum. We could use another allocation scheme within each stratum, for example an urn model or a biased coin. It is important that we use one that aims to conserve balance, or else the benefits of stratification are lost.</p>
</div>
<p>A difficulty with stratified sampling is that the number of strata can quickly become large as the number of factors (or the number of levels within some factors) increases. For example, if we have four prognostic factors each with three levels, there are <span class="math inline">\(3^4=81\)</span> strata. This creates a situation that is at best unwieldy, and at worst completely unworkable; in a small trial (with say 100 patients in each arm) there may be some strata with no patients in (this is actually not a problem), and probably many more with only one (this is much more problematic).</p>
</div>
<div id="minimization" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Minimization<a href="alloc.html#minimization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Minimization was first proposed by <span class="citation">Taves (<a href="#ref-taves1974minimization">1974</a>)</span>, then shortly after by <span class="citation">Pocock and Simon (<a href="#ref-pocock1975sequential">1975</a>)</span> and <span class="citation">Freedman and White (<a href="#ref-freedman1976use">1976</a>)</span>. The aim of minimization is to minimize the difference between the two groups. It was developed for use with strata, as an alternative to randomly permuted blocks. Although the method was developed in the seventies, it has only gained popularity relatively recently, mainly as computers have become widely available.</p>
<p>To form the strata, the people running the trial must first specify all of the factors they would like to be balanced between the two groups. These should be any variables that are thought to possibly affect the outcome.</p>
<div class="example">
<p><span id="exm:unlabeled-div-17" class="example"><strong>Example 3.6  </strong></span>The study by <span class="citation">Kallis et al. (<a href="#ref-kallis1994pre">1994</a>)</span> compares the effect of giving aspirin to patients before coronary artery surgery with giving them a placebo. Interestingly, the effects of aspirin were found to be both positive (decreases platelet aggregation to arachidonic acid and to collagen) and negative (increased likelihood of post-operative excessive blood loss).
For their prognostic factors, <span class="citation">Kallis et al. (<a href="#ref-kallis1994pre">1994</a>)</span> chose age (<span class="math inline">\(\leq{50}\)</span> or <span class="math inline">\(&gt;50\)</span>), sex (M or F), operating surgeon (3 possibilities) and number of coronary arteries affected (1 or 2). This creates 24 strata. The trial had 100 participants, meaning an average of 4.17 in each stratum.</p>
</div>
<p>When a patient enters the trial, their level of each factor is listed. The patient is then allocated in such a way as to minimise any difference in these factors between the two groups. The minimization method has evolved since its conception, and exists in several forms. Two areas in which methods vary are</p>
<ul>
<li>Whether continuous variables have to be binned</li>
<li>Whether there is any randomness</li>
</ul>
<p>It is generally agreed that if the risk of selection bias cannot be avoided, there should be an element of randomness. It is also usually accepted that if a variable is included in the minimization, it should also be included in the statistical analysis.</p>
<div id="minimization-algorithm" class="section level4 hasAnchor" number="3.3.2.1">
<h4><span class="header-section-number">3.3.2.1</span> Minimization algorithm<a href="alloc.html#minimization-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Suppose we have a trial in which patients are recruited sequentially and need to be allocated to a trial arm (of which there are two). <span class="citation">Pocock and Simon (<a href="#ref-pocock1975sequential">1975</a>)</span> give an algorithm in the general case of <span class="math inline">\(N\)</span> treatment arms, but we will not do that here.</p>
<p>Suppose there are several prognostic factors over which we require balance, and that these factors have <span class="math inline">\(I, J, K, ...\)</span> levels. In our example above, there would be <span class="math inline">\(I=2,\; J=2,\; K=3,\; L=2\)</span>. Note that this equates to 24 strata.</p>
<p>At some point in the trial, suppose we have recruited <span class="math inline">\(n_{ijkl}\)</span> patients with levels <span class="math inline">\(i,\,j,\,k,\,l\)</span> of the factors. For example, this may be males, aged over 50, assigned to the second surgeon, with both coronary arteries affected. Within these, <span class="math inline">\(n^A_{ijkl}\)</span> have been assigned to treatment arm <span class="math inline">\(A\)</span>, and <span class="math inline">\(n^B_{ijkl}\)</span> to arm <span class="math inline">\(B\)</span>. So we have</p>
<p><span class="math display">\[ n^A_{ijkl} + n^B_{ijkl} = n_{ijkl} .\]</span></p>
<p>If we were to use random permuted blocks within each stratum, then we would be assured that</p>
<p><span class="math display">\[\lvert n^A_{ijkl} - n^B_{ijkl} \rvert \leq{\frac{1}{2}b},\]</span>
where <span class="math inline">\(b\)</span> is the block length. However, there are two issues with this:</p>
<ul>
<li>There may be very few patients in some strata, in which case RPBs will fail to provide adequate balance.</li>
<li>It is unlikely that we actually need this level of balance.</li>
</ul>
<p>The first point is a pragmatic one - the method usually guaranteed to achieve good balance is likely to fail, at least for some strata. The second is more theoretical. In general, we require that groups be balanced according to each individual prognostic factor, but not to interactions. For example, it is often believed that younger patients would have generally better outcomes, but that other factors do not systematically affect this difference.</p>
<p>Therefore, it is enough to make sure that the following are all small:</p>
<p><span class="math display">\[
\begin{aligned}
\lvert n^A_{i+++} - n^B_{i+++} \rvert&amp;\text{ for each }i=1,\ldots,I\\
\lvert n^A_{+j++} - n^B_{+j++} \rvert&amp;\text{ for each }j=1,\ldots,J\\
\ldots&amp;
\end{aligned}
\]</span>
where <span class="math inline">\(+\)</span> represents summation over the other factors, so that for example</p>
<p><span class="math display">\[n^A_{++k+} = \sum\limits_{i,j,l}{n^A_{ijkl}}\]</span>
is the total number of patients with level <span class="math inline">\(k\)</span> of that factor assigned to treatment arm <span class="math inline">\(A\)</span>.</p>
<p>Therefore, instead of having <span class="math inline">\(IJKL\)</span> constraints constraints, as we would with using randomly permuted blocks (or some other randomization method) within each stratum, we have <span class="math inline">\(I+J+K+L\)</span> constraints, one for each level of each factor. In our example this is 9 constraints rather than 24.</p>
<p>In order to implement minimisation, we follow these steps:</p>
<ol style="list-style-type: decimal">
<li>Allocate the first patient by simple randomisation.</li>
<li>Suppose that at some point in the trial we have recruited <span class="math inline">\(n_{ijkl}\)</span> patients with prognostic factors <span class="math inline">\(i,\,j,\,k,\,l\)</span>. Of these <span class="math inline">\(n^A_{ijkl}\)</span> are allocated to treatment arm <span class="math inline">\(A\)</span> and <span class="math inline">\(n^B_{ijkl}\)</span> to arm <span class="math inline">\(B\)</span>.</li>
<li>A new patient enters the trial. They have prognostic factors at levels <span class="math inline">\(w,\,x,\,y,\,z\)</span>.</li>
<li>We form the sum</li>
</ol>
<p><span class="math display" id="eq:minim">\[\begin{equation}
  \left(n^A_{w+++} - n^B_{w+++}\right) + \left(n^A_{+x++} - n^B_{+x++}\right) + \left(n^A_{++y+} - n^B_{++y+}\right) + \left(n^A_{+++z} - n^B_{+++z}\right).
  \tag{3.1}
  \end{equation}\]</span></p>
<ol start="5" style="list-style-type: decimal">
<li>If the sum from step 4 is negative (that is, allocation to arm <span class="math inline">\(B\)</span> has dominated up to now) then we allocate the new patient to arm <span class="math inline">\(A\)</span> with probability <span class="math inline">\(P\)</span>, with <span class="math inline">\(P&gt;0.5\)</span>. If the sum is positive, they are allocated to arm <span class="math inline">\(B\)</span> with probability <span class="math inline">\(P\)</span>. If the sum is zero, they are allocated to arm <span class="math inline">\(A\)</span> with probability <span class="math inline">\(\frac{1}{2}\)</span>.</li>
</ol>
<p>Some people set <span class="math inline">\(P=1\)</span>, whereas others would set <span class="math inline">\(\frac{1}{2}&lt;P&lt;1\)</span> to retain some randomness. Although setting <span class="math inline">\(P=1\)</span> makes the system deterministic, to predict the next allocation a doctor (or whoever) would need to know <span class="math inline">\(n^A_{i+++}\)</span> and so on. This is very unlikely unless they are deliberately seeking to disrupt the trial. However, generally the accepted approach is becoming to set <span class="math inline">\(P&lt;1\)</span>.</p>
<div class="example">
<p><span id="exm:unlabeled-div-18" class="example"><strong>Example 3.7  </strong></span>From <span class="citation">Altman (<a href="#ref-altman1990practical">1990</a>)</span> (citing <span class="citation">Fentiman, Rubens, and Hayward (<a href="#ref-fentiman1983control">1983</a>)</span>).
In this trial, 46 patients with breast cancer were allocated to receive either Mustine (arm A) or Talc (arm B) as treatment for pleural effusions (fluid between the walls of the lung). They used four prognostic factors: age (<span class="math inline">\(\leq{50}\)</span> or <span class="math inline">\(&gt;50\)</span>), stage of disease (I or II, III or IV), time in months between diagnosis of breast cancer and diagnosis of pleural effusions (<span class="math inline">\(\leq{30}\)</span> or <span class="math inline">\(&gt;30\)</span>) and menopausal status (Pre or post).</p>
<p>Let’s suppose that 15 patients have already been allocated. The totals of patients in each treatment arm in terms of each level of each prognostic factor are shown in the table below.</p>
<table>
<thead>
<tr class="header">
<th align="left">factor</th>
<th align="left">level</th>
<th align="right">Mustine (A)</th>
<th align="right">Talc (B)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Age</td>
<td align="left">1. 50 or younger</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Age</td>
<td align="left">2. &gt;50</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Stage</td>
<td align="left">1. I or II</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Stage</td>
<td align="left">2. III or IV</td>
<td align="right">6</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Time interval</td>
<td align="left">1. 30 months or less</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Time interval</td>
<td align="left">2. &gt;30 months</td>
<td align="right">4</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Menopausal status</td>
<td align="left">1. Pre</td>
<td align="right">4</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Menopausal status</td>
<td align="left">2. Post</td>
<td align="right">5</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<p>Suppose our sixteenth patient is under 50, has disease at stage III, has less than 30 months between diagnoses and is pre-menopausal.
Our calculation from step 4 of the minimisation algorithm is therefore</p>
<p><span class="math display">\[
\begin{aligned}
\left(n^A_{1+++} - n^B_{1+++}\right) + \left(n^A_{+2++} - n^B_{+2++}\right) + \left(n^A_{++1+} \right.&amp; \left.- n^B_{++1+}\right) + \left(n^A_{+++1} - n^B_{+++1}\right) \\
&amp; = \left(3-4\right) + \left(6-6\right) + \left(4-2\right) + \left(4-3\right) \\
&amp; = -1 + 0 + 2 + 1\\
&amp; = 2 .
\end{aligned}
\]</span>
Since our sum is greater than zero, we allocate the new patient to arm B (talc) with some probability <span class="math inline">\(P\in\left(0.5,1\right)\)</span> and update the table before allocating patient 17.</p>
</div>
<p>One shortcoming of minimisation is that the factors are equally weighted in the algorithm, regardless of the number of patients with that particular factor level. For example, suppose at some later stage of allocation in our Mustine example, only four patients with stage I or II disease had been recruited, and that one of these had been allocated to group <span class="math inline">\(A\)</span> and three to group <span class="math inline">\(B\)</span>. At the same point, 18 of the recruited number were post-menopausal, and of these 10 had been allocated to group <span class="math inline">\(A\)</span> and 8 to group <span class="math inline">\(B\)</span>. The values contributed to the sum in Equation <a href="alloc.html#eq:minim">(3.1)</a> are <span class="math inline">\(+2\)</span> and <span class="math inline">\(-2\)</span>, so these imbalances effectively cancel one another out, but intuitively it would feel sensible to prioritise equal distribution within the stage I or II women, since proportionally this stratum is less balanced. <span class="citation">Wei (<a href="#ref-wei1978application">1978</a>)</span> proposed an extension of the Urn Design that does exactly this, but we won’t cover this method in our course.</p>
</div>
</div>
</div>
<div id="problems-around-allocation" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Problems around allocation<a href="alloc.html#problems-around-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In clinical trials papers, the allocation groups are usually summarised in tables giving summary statistics (eg. mean and SD) of each characteristic for the control group and the intervention group. The aim of these is to show that the groups are similar enough for any difference in outcome to be attributed to the intervention itself. Figure <a href="alloc.html#fig:licorice-participants">3.9</a> shows an example, taken from <span class="citation">Ruetzler et al. (<a href="#ref-ruetzler2013randomized">2013</a>)</span>.</p>
<div class="figure"><span style="display:block;" id="fig:licorice-participants"></span>
<img src="images/licorice.jpg" alt="Summary statistics for an RCT comparing a licorice gargle (the intervention) to a sugar-water gargle (the standard). From @ruetzler2013randomized" width="60%" />
<p class="caption">
Figure 3.9: Summary statistics for an RCT comparing a licorice gargle (the intervention) to a sugar-water gargle (the standard). From <span class="citation">Ruetzler et al. (<a href="#ref-ruetzler2013randomized">2013</a>)</span>
</p>
</div>
<p>The problem here is that only the marginal distributions are compared for similarity. Consider the following (somewhat extreme and minimalistic) scenario. A study aims to investigate the effect of some treatment, and to balance for gender and age in their allocation, resulting in the following summary table.</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Male
</th>
<th style="text-align:left;">
Female
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
Control
</td>
<td style="text-align:left;">
57.51 (7.09)
</td>
<td style="text-align:left;">
40.31 (5.83)
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Intervention
</td>
<td style="text-align:left;">
44.19 (5.96)
</td>
<td style="text-align:left;">
60.03 (5.27)
</td>
</tr>
</tbody>
</table>
<p>This appears to be a reasonably balanced design. However, if we look at the joint distribution, we see that there are problems.</p>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-122-1.png" width="672" /></p>
<p>If the intervention is particularly effective in older men, our trial will not notice. Likewise, if older women generally have a more positive outcome than older men, our trial may erroneously find the intervention to be effective.</p>
<p>Although this example is highly manufactured and [hopefully!] unlikely to take place in real life, for clinical trials there are often many demographic variables and prognostic factors being taken into account. Achieving joint balance across all them is very difficult, and extremely unlikely to happen if it isn’t aimed for. <span class="citation">Treasure and MacRae (<a href="#ref-treasure1998minimisation">1998</a>)</span> give an example in relation to a hypothetical study on heart disease</p>
<blockquote>
<p>Supposing one group has more elderly women with diabetes and symptoms of heart failure. It would then be impossible to attribute a better outcome in the other group to the beneficial effects of treatment since poor left ventricular function and age at outset are major determinants of survival in any longitudinal study of heart disease, and women with diabetes, as a group, are likely to do worse. At this point the primary objective of randomisation—exclusion of confounding factors—has failed. … If a very big trial fails, because, for example, the play of chance put more hypertensive smokers in one group than the other, the tragedy for the trialists, and all involved, is even greater.</p>
</blockquote>
<p>However, this issue is rarely addressed in clinical trials: a lot of faith is placed (with reasonable justification) in the likely balance achieved by random sampling, whatever method is used. We will also see in the next Chapter that we can account for some degree of imbalance at the analysis stage.</p>

</div>
</div>



<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-altman1990practical" class="csl-entry">
Altman, Douglas G. 1990. <em>Practical Statistics for Medical Research</em>. CRC press.
</div>
<div id="ref-altman1999treatment" class="csl-entry">
Altman, Douglas G, and J Martin Bland. 1999. <span>“Treatment Allocation in Controlled Trials: Why Randomise?”</span> <em>Bmj</em> 318 (7192): 1209–9.
</div>
<div id="ref-cottingham2022gendered" class="csl-entry">
Cottingham, Marci D, and Jill A Fisher. 2022. <span>“Gendered Logics of Biomedical Research: Women in US Phase i Clinical Trials.”</span> <em>Social Problems</em> 69 (2): 492–509.
</div>
<div id="ref-efron1971forcing" class="csl-entry">
Efron, Bradley. 1971. <span>“Forcing a Sequential Experiment to Be Balanced.”</span> <em>Biometrika</em> 58 (3): 403–17.
</div>
<div id="ref-fentiman1983control" class="csl-entry">
Fentiman, Ian S, Robert D Rubens, and John L Hayward. 1983. <span>“Control of Pleural Effusions in Patients with Breast Cancer a Randomized Trial.”</span> <em>Cancer</em> 52 (4): 737–39.
</div>
<div id="ref-freedman1976use" class="csl-entry">
Freedman, LS, and Susan J White. 1976. <span>“On the Use of Pocock and Simon’s Method for Balancing Treatment Numbers over Prognostic Factors in the Controlled Clinical Trial.”</span> <em>Biometrics</em>, 691–94.
</div>
<div id="ref-goldacre2012bad" class="csl-entry">
Goldacre, B. 2012. <em>Bad Pharma: How Medicine Is Broken, and How We Can Fix It</em>. HarperCollins Publishers. <a href="https://books.google.co.uk/books?id=4amY1Q6Id4QC">https://books.google.co.uk/books?id=4amY1Q6Id4QC</a>.
</div>
<div id="ref-nationalhistory" class="csl-entry">
Health, National Institute of. 2023. <span>“History of Women’s Participation in Clinical Research.”</span> Office of Research on Women’s Health. https://orwh. od. nih. gov/toolkit …. <a href="https://orwh.od.nih.gov/toolkit/recruitment/history">https://orwh.od.nih.gov/toolkit/recruitment/history</a>.
</div>
<div id="ref-kallis1994pre" class="csl-entry">
Kallis, P, JA Tooze, S Talbot, D Cowans, DH Bevan, and T Treasure. 1994. <span>“Pre-Operative Aspirin Decreases Platelet Aggregation and Increases Post-Operative Blood Loss–a Prospective, Randomised, Placebo Controlled, Double-Blind Clinical Trial in 100 Patients with Chronic Stable Angina.”</span> <em>European Journal of Cardio-Thoracic Surgery: Official Journal of the European Association for Cardio-Thoracic Surgery</em> 8 (8): 404–9.
</div>
<div id="ref-kar2012review" class="csl-entry">
Kar, Sumit, Ajay Krishnan, Preetha K, and Atul Mohankar. 2012. <span>“A Review of Antihistamines Used During Pregnancy.”</span> <em>Journal of Pharmacology and Pharmacotherapeutics</em> 3 (2): 105–8.
</div>
<div id="ref-pocock1975sequential" class="csl-entry">
Pocock, Stuart J, and Richard Simon. 1975. <span>“Sequential Treatment Assignment with Balancing for Prognostic Factors in the Controlled Clinical Trial.”</span> <em>Biometrics</em>, 103–15.
</div>
<div id="ref-ruetzler2013randomized" class="csl-entry">
Ruetzler, Kurt, Michael Fleck, Sabine Nabecker, Kristina Pinter, Gordian Landskron, Andrea Lassnigg, Jing You, and Daniel I Sessler. 2013. <span>“A Randomized, Double-Blind Comparison of Licorice Versus Sugar-Water Gargle for Prevention of Postoperative Sore Throat and Postextubation Coughing.”</span> <em>Anesthesia &amp; Analgesia</em> 117 (3): 614–21.
</div>
<div id="ref-taves1974minimization" class="csl-entry">
Taves, Donald R. 1974. <span>“Minimization: A New Method of Assigning Patients to Treatment and Control Groups.”</span> <em>Clinical Pharmacology &amp; Therapeutics</em> 15 (5): 443–53.
</div>
<div id="ref-treasure1998minimisation" class="csl-entry">
Treasure, Tom, and Kenneth D MacRae. 1998. <span>“Minimisation: The Platinum Standard for Trials?: Randomisation Doesn’t Guarantee Similarity of Groups; Minimisation Does.”</span> <em>Bmj</em>. British Medical Journal Publishing Group.
</div>
<div id="ref-vitale2017under" class="csl-entry">
Vitale, Cristiana, Massimo Fini, Ilaria Spoletini, Mitja Lainscak, Petar Seferovic, and Giuseppe MC Rosano. 2017. <span>“Under-Representation of Elderly and Women in Clinical Trials.”</span> <em>International Journal of Cardiology</em> 232: 216–21.
</div>
<div id="ref-wei1978application" class="csl-entry">
Wei, LJ. 1978. <span>“An Application of an Urn Model to the Design of Sequential Controlled Clinical Trials.”</span> <em>Journal of the American Statistical Association</em> 73 (363): 559–63.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rct-plan.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="computer-practical-1---missing-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CT4H_notes.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"bookdown": null
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
