library(ggplot2)
library(gridExtra)
library(kableExtra)
library(readr)
library(readxl)
library(tidyverse)
library(visdat)
library(reshape2)
library(gtsummary)
# require(utf8)
# setwd("/Users/rachelo/OneDrive - Durham University/AP2020_21/Projects/CoP/SmartWater/FM_analysis/")
dur_int = read_excel(path = "CoDurham/Intervention group Jan 25 Durham Forensic Product Register and Stock.xlsx", sheet = 1)
names(dur_int) = gsub(",", "", names(dur_int), fixed=T)
names(dur_int) = gsub("\r", " ", names(dur_int))
names(dur_int) = gsub("\n", " ", names(dur_int))
dur_int_valID = dur_int[grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID = dur_int[-grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID$`victim unique ID RED SIGMA NUMBER...1`
dur_int = dur_int_valID
dur_int$`victim sex`[dur_int$`victim sex` == "female"] = "Female"
dur_int = dur_int[dur_int$`victim sex`=="Female",]
IP_ind = sort(c(grep("Partner", dur_int$`IPV DA?`), grep("Yes", dur_int$`IPV DA?`)))
table(dur_int$`IPV DA?`[IP_ind])
table(dur_int$`IPV DA?`[-IP_ind])
dur_int = dur_int[IP_ind,]
nrow(dur_int)
length(unique(dur_int$`victim unique ID RED SIGMA NUMBER...1`))
dur_int_vic_dup = duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`)
dur_int_dupID = dur_int$`victim unique ID RED SIGMA NUMBER...1`[dur_int_vic_dup]
dur_int[dur_int$`victim unique ID RED SIGMA NUMBER...1` %in% dur_int_dupID,] %>%
kable() %>% kable_styling("striped") %>%
scroll_box(width="900px")
dur_int = dur_int[!duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`),]
dur_int$`warning delivered to perpetrator (y/n)`[dur_int$`victim unique ID RED SIGMA NUMBER...1` == "PER00128001"]
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(ggplot2)
library(gridExtra)
library(kableExtra)
library(readr)
library(readxl)
library(tidyverse)
library(visdat)
library(reshape2)
library(gtsummary)
# require(utf8)
# setwd("/Users/rachelo/OneDrive - Durham University/AP2020_21/Projects/CoP/SmartWater/FM_analysis/")
dur_int = read_excel(path = "CoDurham/Intervention group Jan 25 Durham Forensic Product Register and Stock.xlsx", sheet = 1)
names(dur_int) = gsub(",", "", names(dur_int), fixed=T)
names(dur_int) = gsub("\r", " ", names(dur_int))
names(dur_int) = gsub("\n", " ", names(dur_int))
dur_int_valID = dur_int[grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID = dur_int[-grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID$`victim unique ID RED SIGMA NUMBER...1`
dur_int = dur_int_valID
dur_int$`victim sex`[dur_int$`victim sex` == "female"] = "Female"
dur_int = dur_int[dur_int$`victim sex`=="Female",]
IP_ind = sort(c(grep("Partner", dur_int$`IPV DA?`), grep("Yes", dur_int$`IPV DA?`)))
table(dur_int$`IPV DA?`[IP_ind])
table(dur_int$`IPV DA?`[-IP_ind])
dur_int = dur_int[IP_ind,]
nrow(dur_int)
length(unique(dur_int$`victim unique ID RED SIGMA NUMBER...1`))
dur_int_vic_dup = duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`)
dur_int_dupID = dur_int$`victim unique ID RED SIGMA NUMBER...1`[dur_int_vic_dup]
dur_int[dur_int$`victim unique ID RED SIGMA NUMBER...1` %in% dur_int_dupID,] %>%
kable() %>% kable_styling("striped") %>%
scroll_box(width="900px")
dur_int = dur_int[!duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`),]
nrow(dur_int)
dur_comp = read_excel("CoDurham/Raw data draw comparison data from here RIR 031 34 - Op Wicker data FINAL.xlsx", sheet = 3)
table(dur_comp$Role)
dur_comp = dur_comp[dur_comp$Role %in% c("Offender", "Suspect", "Victim"),]
table(dur_comp$Role)
dur_comp_vic = dur_comp[dur_comp$Role == "Victim",]
dur_comp_sus = dur_comp[dur_comp$Role %in% c("Offender", "Suspect"),]
dur_comp_vic = dur_comp_vic[grep("Female", dur_comp_vic$Gender),]
table(dur_comp_vic$Relationship)
IP_ind = grep("Relationship", dur_comp_vic$Relationship)
table(dur_comp_vic$`Relationship Subtype`[IP_ind]) # those selected
table(dur_comp_vic$`Relationship Subtype`[-IP_ind]) # those not selected
dur_comp_vic = dur_comp_vic[IP_ind, ]
length(unique(dur_comp_vic$`SAF URN`))
date_from_vic = as.Date(dur_comp_vic$`Date From`, format = "%Y-%m-%d")
summary(date_from_vic)
date_cr_vic = as.Date(dur_comp_vic$`Date Created`, format = "%Y-%m-%d")
dur_comp_vic_daterange = between(
date_from_vic,
left = as.Date("2023-09-12", format = "%Y-%m-%d"),
right = as.Date("2023-10-15", format = "%Y-%m-%d"))
summary(dur_comp_vic_daterange)
dur_comp_vic = dur_comp_vic[dur_comp_vic_daterange,]
summary(as.Date(dur_comp_vic$`Date From`, format="%Y-%m-%d"))
length(unique(dur_comp_vic$`SAF URN`))
dur_comp_dupID = dur_comp_vic$`SAF URN`[duplicated(dur_comp_vic$`SAF URN`)]
dur_comp_vic[dur_comp_vic$`SAF URN`%in%dur_comp_dupID,] %>% kable() %>%
kable_styling("striped") %>% scroll_box(height="600px", width = "900px")
dput(names(dur_comp))
dur_comp_vic_dup = dur_comp_vic[
dur_comp_vic$`SAF URN`%in%dur_comp_dupID,
]
dur_comp_vic_dup_summary = data.frame(
SAF_URN = unique(dur_comp_vic_dup$`SAF URN`)
)
dur_comp_vic_dup_summary = data.frame(
SAF_URN = unique(dur_comp_vic_dup$`SAF URN`)
)
dur_comp_vic_dup_summary$HO_Codes = sapply(
1:nrow(dur_comp_vic_dup_summary),
function(i){
SAF_URN_i = dur_comp_vic_dup_summary$SAF_URN[i]
HO_codes_i = dur_comp_vic_dup$`HO Code`[dur_comp_vic_dup$`SAF URN` == SAF_URN_i]
paste(HO_codes_i, collapse = "; ")
}
)
dur_comp_vic_dup_summary
?write_excel
write_excel_csv
?write_excel_csv
write_excel_csv(dur_comp_vic_dup, file = "CoDurham/comp_SAFURN_duplicates.csv")
write_excel_csv(dur_comp_vic_dup_summary, file = "CoDurham/comp_SAFURN_duplicates_summary.csv")
names(dur_in)
names(dur_int)
dur_int_df$police_force = dur_int$`police force`
dur_int_df$police_district = dur_int$`police force district eg South Durham West East. Darlo`
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(ggplot2)
library(gridExtra)
library(kableExtra)
library(readr)
library(readxl)
library(tidyverse)
library(visdat)
library(reshape2)
library(gtsummary)
# require(utf8)
# setwd("/Users/rachelo/OneDrive - Durham University/AP2020_21/Projects/CoP/SmartWater/FM_analysis/")
dur_int = read_excel(path = "CoDurham/Intervention group Jan 25 Durham Forensic Product Register and Stock.xlsx", sheet = 1)
names(dur_int) = gsub(",", "", names(dur_int), fixed=T)
names(dur_int) = gsub("\r", " ", names(dur_int))
names(dur_int) = gsub("\n", " ", names(dur_int))
dur_int_valID = dur_int[grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID = dur_int[-grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID$`victim unique ID RED SIGMA NUMBER...1`
dur_int = dur_int_valID
dur_int$`victim sex`[dur_int$`victim sex` == "female"] = "Female"
dur_int = dur_int[dur_int$`victim sex`=="Female",]
IP_ind = sort(c(grep("Partner", dur_int$`IPV DA?`), grep("Yes", dur_int$`IPV DA?`)))
table(dur_int$`IPV DA?`[IP_ind])
table(dur_int$`IPV DA?`[-IP_ind])
dur_int = dur_int[IP_ind,]
nrow(dur_int)
length(unique(dur_int$`victim unique ID RED SIGMA NUMBER...1`))
dur_int_vic_dup = duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`)
dur_int_dupID = dur_int$`victim unique ID RED SIGMA NUMBER...1`[dur_int_vic_dup]
dur_int[dur_int$`victim unique ID RED SIGMA NUMBER...1` %in% dur_int_dupID,] %>%
kable() %>% kable_styling("striped") %>%
scroll_box(width="900px")
dur_int = dur_int[!duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`),]
nrow(dur_int)
dur_comp = read_excel("CoDurham/Raw data draw comparison data from here RIR 031 34 - Op Wicker data FINAL.xlsx", sheet = 3)
table(dur_comp$Role)
dur_comp = dur_comp[dur_comp$Role %in% c("Offender", "Suspect", "Victim"),]
table(dur_comp$Role)
dur_comp_vic = dur_comp[dur_comp$Role == "Victim",]
dur_comp_sus = dur_comp[dur_comp$Role %in% c("Offender", "Suspect"),]
dur_comp_vic = dur_comp_vic[grep("Female", dur_comp_vic$Gender),]
table(dur_comp_vic$Relationship)
IP_ind = grep("Relationship", dur_comp_vic$Relationship)
table(dur_comp_vic$`Relationship Subtype`[IP_ind]) # those selected
table(dur_comp_vic$`Relationship Subtype`[-IP_ind]) # those not selected
dur_comp_vic = dur_comp_vic[IP_ind, ]
length(unique(dur_comp_vic$`SAF URN`))
date_from_vic = as.Date(dur_comp_vic$`Date From`, format = "%Y-%m-%d")
summary(date_from_vic)
date_cr_vic = as.Date(dur_comp_vic$`Date Created`, format = "%Y-%m-%d")
dur_comp_vic_daterange = between(
date_from_vic,
left = as.Date("2023-09-12", format = "%Y-%m-%d"),
right = as.Date("2023-10-15", format = "%Y-%m-%d"))
summary(dur_comp_vic_daterange)
dur_comp_vic = dur_comp_vic[dur_comp_vic_daterange,]
summary(as.Date(dur_comp_vic$`Date From`, format="%Y-%m-%d"))
length(unique(dur_comp_vic$`SAF URN`))
dur_comp_dupID = dur_comp_vic$`SAF URN`[duplicated(dur_comp_vic$`SAF URN`)]
dur_comp_vic[dur_comp_vic$`SAF URN`%in%dur_comp_dupID,] %>% kable() %>%
kable_styling("striped") %>% scroll_box(height="600px", width = "900px")
dur_int_df = data.frame(
victim_ID = dur_int$`victim unique ID RED SIGMA NUMBER...1`,
victim_sex = dur_int$`victim sex`,
victim_age = dur_int$`Vic age`,
victim_ethnicity = dur_int$`victim ethnicity`
)
gtsummary::tbl_summary(dur_int_df[ ,2:4])
dur_comp_df = data.frame(victim_ID = unique(dur_comp_vic$`Person URN`))
dur_comp_df$victim_sex = NA
dur_comp_df$victim_age = NA
dur_comp_df$victim_ethnicity = NA # can't see a column for ethnicity in the comp data
for (i in 1:nrow(dur_comp_df)){
dur_comp_df$victim_sex[i] = unique(dur_comp_vic$Gender[dur_comp_vic$`Person URN` == dur_comp_df$victim_ID[i]])
dur_comp_df$victim_age[i] = unique(dur_comp_vic$Age[dur_comp_vic$`Person URN` == dur_comp_df$victim_ID[i]])
}
gtsummary::tbl_summary(dur_comp_df[ ,2:4])
dur_int_df = data.frame(
victim_ID = dur_int$`victim unique ID RED SIGMA NUMBER...1`,
victim_sex = dur_int$`victim sex`,
victim_age = dur_int$`Vic age`,
victim_ethnicity = dur_int$`victim ethnicity`
)
gtsummary::tbl_summary(dur_int_df[ ,2:4])
dur_int_df$police_force = dur_int$`police force`
dur_int_df$police_district = dur_int$`police force district eg South Durham West East. Darlo`
table(dur_int_df$police_district)
HO_code_cols = grep("HO Code", names(dur_int))
HO_code_cols
?grep
HO_code_cols = grep("HO Code", names(dur_int), ignore.case=T)
HO_code_cols
HO_code_data = dur_int[ ,HO_code_cols]
HO_code_data
?stack
HO_code_vec = stack(HO_code_data)
HO_code_vec
HO_code_vec = na.omit(stack(HO_code_data))
HO_code_vec
HO_code_vec = na.omit(stack(HO_code_data))$values
HO_code_vec
HO_code_vec = sorted(unique(HO_code_vec))
HO_code_vec = sort(unique(HO_code_vec))
HO_code_vec
HO_comp = dur_comp_vic$`HO Code`
HO_code_vec_comp = sort(unique(HO_comp))
HO_code_vec_comp
HO_code_cols = grep("HO Code", names(dur_int), ignore.case=T)
HO_code_data = dur_int[ ,HO_code_cols]
HO_code_vec = na.omit(stack(HO_code_data))$values
HO_comp = dur_comp_vic$`HO Code`
HO_code_vec = sort(unique(c(HO_comp, HO_code_vec)))
length(HO_code_vec)
write_excel_csv(
data.frame(inc_type = HO_code_vec),
file = "CoDurham/inc_types.csv")
HO_subcode_cols = grep("HO subcode", names(dur_int), ignore.case=T)
HO_subcode_cols
HO_subcode_data = dur_int[ ,HO_subcode_cols]
HO_subcode_vec = na.omit(stack(HO_subcode_data))$values
HO_comp = dur_comp_vic$`HO Subcode`
HO_code_vec = sort(unique(c(HO_comp, HO_subcode_vec)))
length(HO_code_vec)
write_excel_csv(
data.frame(inc_type = HO_code_vec),
file = "CoDurham/inc_types.csv")
HO_code_vec
names(dur_comp_vic_dup)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(ggplot2)
library(gridExtra)
library(kableExtra)
library(readr)
library(readxl)
library(tidyverse)
library(visdat)
library(reshape2)
library(gtsummary)
# require(utf8)
# setwd("/Users/rachelo/OneDrive - Durham University/AP2020_21/Projects/CoP/SmartWater/FM_analysis/")
dur_int = read_excel(path = "CoDurham/Intervention group Jan 25 Durham Forensic Product Register and Stock.xlsx", sheet = 1)
names(dur_int) = gsub(",", "", names(dur_int), fixed=T)
names(dur_int) = gsub("\r", " ", names(dur_int))
names(dur_int) = gsub("\n", " ", names(dur_int))
dur_int_valID = dur_int[grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID = dur_int[-grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID$`victim unique ID RED SIGMA NUMBER...1`
dur_int = dur_int_valID
dur_int$`victim sex`[dur_int$`victim sex` == "female"] = "Female"
dur_int = dur_int[dur_int$`victim sex`=="Female",]
IP_ind = sort(c(grep("Partner", dur_int$`IPV DA?`), grep("Yes", dur_int$`IPV DA?`)))
table(dur_int$`IPV DA?`[IP_ind])
table(dur_int$`IPV DA?`[-IP_ind])
dur_int = dur_int[IP_ind,]
nrow(dur_int)
length(unique(dur_int$`victim unique ID RED SIGMA NUMBER...1`))
dur_int_vic_dup = duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`)
dur_int_dupID = dur_int$`victim unique ID RED SIGMA NUMBER...1`[dur_int_vic_dup]
dur_int[dur_int$`victim unique ID RED SIGMA NUMBER...1` %in% dur_int_dupID,] %>%
kable() %>% kable_styling("striped") %>%
scroll_box(width="900px")
dur_int = dur_int[!duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`),]
nrow(dur_int)
dur_comp = read_excel("CoDurham/Raw data draw comparison data from here RIR 031 34 - Op Wicker data FINAL.xlsx", sheet = 3)
table(dur_comp$Role)
dur_comp = dur_comp[dur_comp$Role %in% c("Offender", "Suspect", "Victim"),]
table(dur_comp$Role)
dur_comp_vic = dur_comp[dur_comp$Role == "Victim",]
dur_comp_sus = dur_comp[dur_comp$Role %in% c("Offender", "Suspect"),]
dur_comp_vic = dur_comp_vic[grep("Female", dur_comp_vic$Gender),]
table(dur_comp_vic$Relationship)
IP_ind = grep("Relationship", dur_comp_vic$Relationship)
table(dur_comp_vic$`Relationship Subtype`[IP_ind]) # those selected
table(dur_comp_vic$`Relationship Subtype`[-IP_ind]) # those not selected
dur_comp_vic = dur_comp_vic[IP_ind, ]
length(unique(dur_comp_vic$`SAF URN`))
date_from_vic = as.Date(dur_comp_vic$`Date From`, format = "%Y-%m-%d")
summary(date_from_vic)
date_cr_vic = as.Date(dur_comp_vic$`Date Created`, format = "%Y-%m-%d")
dur_comp_vic_daterange = between(
date_from_vic,
left = as.Date("2023-09-12", format = "%Y-%m-%d"),
right = as.Date("2023-10-15", format = "%Y-%m-%d"))
summary(dur_comp_vic_daterange)
dur_comp_vic = dur_comp_vic[dur_comp_vic_daterange,]
summary(as.Date(dur_comp_vic$`Date From`, format="%Y-%m-%d"))
length(unique(dur_comp_vic$`SAF URN`))
dur_comp_dupID = dur_comp_vic$`SAF URN`[duplicated(dur_comp_vic$`SAF URN`)]
dur_comp_vic[dur_comp_vic$`SAF URN`%in%dur_comp_dupID,] %>% kable() %>%
kable_styling("striped") %>% scroll_box(height="600px", width = "900px")
dur_comp_vic_dup = dur_comp_vic[
dur_comp_vic$`SAF URN`%in%dur_comp_dupID,
]
dur_comp_vic_dup_summary = data.frame(
SAF_URN = unique(dur_comp_vic_dup$`SAF URN`)
)
dur_comp_vic_dup_summary$HO_subcodes = sapply(
1:nrow(dur_comp_vic_dup_summary),
function(i){
SAF_URN_i = dur_comp_vic_dup_summary$SAF_URN[i]
HO_subcodes_i = dur_comp_vic_dup$`HO Cubcode`[dur_comp_vic_dup$`SAF URN` == SAF_URN_i]
paste(HO_subcodes_i, collapse = "; ")
}
)
write_excel_csv(dur_comp_vic_dup, file = "CoDurham/comp_SAFURN_duplicates.csv")
write_excel_csv(dur_comp_vic_dup_summary, file = "CoDurham/comp_SAFURN_duplicates_summary.csv")
dur_comp_vic_dup_summary = data.frame(
SAF_URN = unique(dur_comp_vic_dup$`SAF URN`)
)
dur_comp_vic_dup_summary$HO_subcodes = sapply(
1:nrow(dur_comp_vic_dup_summary),
function(i){
SAF_URN_i = dur_comp_vic_dup_summary$SAF_URN[i]
HO_subcodes_i = dur_comp_vic_dup$`HO Subcode`[dur_comp_vic_dup$`SAF URN` == SAF_URN_i]
paste(HO_subcodes_i, collapse = "; ")
}
)
write_excel_csv(dur_comp_vic_dup_summary, file = "CoDurham/comp_SAFURN_duplicates_summary.csv")
dur_inc_types = read_csv("CoDurham/inc_types.csv")
dur_inc_types
names(dur_int)
dur_int_codes = dur_int[ ,c(1, grep("subcode", names(dur_int), ignore.case = T))]
dur_int_codes
cat1 = sapply(
1:nrow(dur_int_codes),
function(i){
dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 1 HO subcode`[i]]
}
)
dur_int_codes$cat1 = sapply(
1:nrow(dur_int_codes),
function(i){
dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 1 HO subcode`[i]]
}
)
names(dur_int_codes)
dur_int_codes[ ,c(2,5)]
cat1
dur_int_codes$cat1 = sapply(
1:nrow(dur_int_codes),
function(i){
unique(dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 1 HO subcode`[i]])
}
)
dur_int_codes[ ,c(2,5)]
dur_int_codes$cat2 = sapply(
1:nrow(dur_int_codes),
function(i){
unique(dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 2 HO subcode`[i]])
}
)
dur_int_codes[ ,c(3,6)]
dur_int_codes = dur_int[ ,c(1, grep("subcode", names(dur_int), ignore.case = T))]
dur_int_codes$cat1 = NA
dur_int_codes$cat2 = NA
dur_int_codes$cat3 = NA
dur_int_codes$category = NA
for (i in 1:nrow(dur_int_codes)){
cat1_i = unique(dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 1 HO subcode`[i]])
cat2_i = unique(dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 2 HO subcode`[i]])
cat3_i = unique(dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 3 HO subcode`[i]])
dur_int_codes$cat1[i] = cat1_i
dur_int_codes$cat2[i] = cat2_i
dur_int_codes$cat3[i] = cat3_i
if(length(unique(c(cat1_i, cat2_i, cat3_i)))==1){
dur_int_codes$category[i] = unique(c(cat1_i, cat2_i, cat3_i))
}
}
names(dur_int_codes)
names(dur_int_codes[ ,c(1,2,5,3,6,4,7,8)])
unique(c("A", "A", NA))
write_excel_csv(dur_int_codes[ ,c(1,2,5,3,6,4,7,8)], file = "CoDurham/int_categories.csv")
write_excel_csv(dur_int_codes[ ,c(1,2,5,3,6,4,7,8)], file = "CoDurham/int_principal_crime.csv")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(ggplot2)
library(gridExtra)
library(kableExtra)
library(readr)
library(readxl)
library(tidyverse)
library(visdat)
library(reshape2)
library(gtsummary)
# require(utf8)
# setwd("/Users/rachelo/OneDrive - Durham University/AP2020_21/Projects/CoP/SmartWater/FM_analysis/")
dur_int = read_excel(path = "CoDurham/Intervention group Jan 25 Durham Forensic Product Register and Stock.xlsx", sheet = 1)
names(dur_int) = gsub(",", "", names(dur_int), fixed=T)
names(dur_int) = gsub("\r", " ", names(dur_int))
names(dur_int) = gsub("\n", " ", names(dur_int))
dur_int_valID = dur_int[grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID = dur_int[-grep("^PER", dur_int$`victim unique ID RED SIGMA NUMBER...1`), ]
dur_int_nonID$`victim unique ID RED SIGMA NUMBER...1`
dur_int = dur_int_valID
dur_int$`victim sex`[dur_int$`victim sex` == "female"] = "Female"
dur_int = dur_int[dur_int$`victim sex`=="Female",]
IP_ind = sort(c(grep("Partner", dur_int$`IPV DA?`), grep("Yes", dur_int$`IPV DA?`)))
table(dur_int$`IPV DA?`[IP_ind])
table(dur_int$`IPV DA?`[-IP_ind])
dur_int = dur_int[IP_ind,]
nrow(dur_int)
length(unique(dur_int$`victim unique ID RED SIGMA NUMBER...1`))
dur_int_vic_dup = duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`)
dur_int_dupID = dur_int$`victim unique ID RED SIGMA NUMBER...1`[dur_int_vic_dup]
dur_int[dur_int$`victim unique ID RED SIGMA NUMBER...1` %in% dur_int_dupID,] %>%
kable() %>% kable_styling("striped") %>%
scroll_box(width="900px")
dur_int = dur_int[!duplicated(dur_int$`victim unique ID RED SIGMA NUMBER...1`),]
nrow(dur_int)
dur_comp = read_excel("CoDurham/Raw data draw comparison data from here RIR 031 34 - Op Wicker data FINAL.xlsx", sheet = 3)
table(dur_comp$Role)
dur_comp = dur_comp[dur_comp$Role %in% c("Offender", "Suspect", "Victim"),]
table(dur_comp$Role)
dur_comp_vic = dur_comp[dur_comp$Role == "Victim",]
dur_comp_sus = dur_comp[dur_comp$Role %in% c("Offender", "Suspect"),]
dur_comp_vic = dur_comp_vic[grep("Female", dur_comp_vic$Gender),]
table(dur_comp_vic$Relationship)
IP_ind = grep("Relationship", dur_comp_vic$Relationship)
table(dur_comp_vic$`Relationship Subtype`[IP_ind]) # those selected
table(dur_comp_vic$`Relationship Subtype`[-IP_ind]) # those not selected
dur_comp_vic = dur_comp_vic[IP_ind, ]
length(unique(dur_comp_vic$`SAF URN`))
date_from_vic = as.Date(dur_comp_vic$`Date From`, format = "%Y-%m-%d")
summary(date_from_vic)
date_cr_vic = as.Date(dur_comp_vic$`Date Created`, format = "%Y-%m-%d")
dur_comp_vic_daterange = between(
date_from_vic,
left = as.Date("2023-09-12", format = "%Y-%m-%d"),
right = as.Date("2023-10-15", format = "%Y-%m-%d"))
summary(dur_comp_vic_daterange)
dur_comp_vic = dur_comp_vic[dur_comp_vic_daterange,]
summary(as.Date(dur_comp_vic$`Date From`, format="%Y-%m-%d"))
length(unique(dur_comp_vic$`SAF URN`))
dur_comp_dupID = dur_comp_vic$`SAF URN`[duplicated(dur_comp_vic$`SAF URN`)]
dur_comp_vic[dur_comp_vic$`SAF URN`%in%dur_comp_dupID,] %>% kable() %>%
kable_styling("striped") %>% scroll_box(height="600px", width = "900px")
dur_int_df = data.frame(
victim_ID = dur_int$`victim unique ID RED SIGMA NUMBER...1`,
victim_sex = dur_int$`victim sex`,
victim_age = dur_int$`Vic age`,
victim_ethnicity = dur_int$`victim ethnicity`
)
gtsummary::tbl_summary(dur_int_df[ ,2:4])
dur_comp_df = data.frame(victim_ID = unique(dur_comp_vic$`Person URN`))
dur_comp_df$victim_sex = NA
dur_comp_df$victim_age = NA
dur_comp_df$victim_ethnicity = NA # can't see a column for ethnicity in the comp data
for (i in 1:nrow(dur_comp_df)){
dur_comp_df$victim_sex[i] = unique(dur_comp_vic$Gender[dur_comp_vic$`Person URN` == dur_comp_df$victim_ID[i]])
dur_comp_df$victim_age[i] = unique(dur_comp_vic$Age[dur_comp_vic$`Person URN` == dur_comp_df$victim_ID[i]])
}
gtsummary::tbl_summary(dur_comp_df[ ,2:4])
dur_int_df = data.frame(
victim_ID = dur_int$`victim unique ID RED SIGMA NUMBER...1`,
victim_sex = dur_int$`victim sex`,
victim_age = dur_int$`Vic age`,
victim_ethnicity = dur_int$`victim ethnicity`
)
gtsummary::tbl_summary(dur_int_df[ ,2:4])
dur_int_df$police_force = dur_int$`police force`
dur_int_df$police_district = dur_int$`police force district eg South Durham West East. Darlo`
table(dur_int_df$police_district)
HO_subcode_cols = grep("HO subcode", names(dur_int), ignore.case=T)
HO_subcode_data = dur_int[ ,HO_subcode_cols]
HO_subcode_vec = na.omit(stack(HO_subcode_data))$values
HO_comp = dur_comp_vic$`HO Subcode`
HO_code_vec = sort(unique(c(HO_comp, HO_subcode_vec)))
dur_inc_types = read_csv("CoDurham/inc_types.csv")
dur_int_codes = dur_int[ ,c(1, grep("subcode", names(dur_int), ignore.case = T))]
dur_int_codes$cat1 = NA
dur_int_codes$cat2 = NA
dur_int_codes$cat3 = NA
dur_int_codes$category = NA
for (i in 1:nrow(dur_int_codes)){
cat1_i = unique(dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 1 HO subcode`[i]])
cat2_i = unique(dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 2 HO subcode`[i]])
cat3_i = unique(dur_inc_types$category[dur_inc_types$inc_type == dur_int_codes$`Crime 3 HO subcode`[i]])
dur_int_codes$cat1[i] = cat1_i
dur_int_codes$cat2[i] = cat2_i
dur_int_codes$cat3[i] = cat3_i
if(length(unique(na.omit(c(cat1_i, cat2_i, cat3_i))))==1){
dur_int_codes$category[i] = unique(na.omit(c(cat1_i, cat2_i, cat3_i)))
}
}
dur_int_codes[ ,c(1,2,5,3,6,4,7,8)] %>% kable() %>% kable_styling("striped") %>%
scroll_box(width="900px", height = "600px")
write_excel_csv(dur_int_codes[ ,c(1,2,5,3,6,4,7,8)], file = "CoDurham/int_principal_crime.csv")
q()
