ylab("Count") + xlab("Time") + theme_bw()
names(qn12)
ggplot(data = qn12) +
geom_mosaic(aes(x = product('Assigned number', Time), fill=Q12))
ggplot(data = qn12) +
geom_mosaic(aes(x = product('Assigned number', Time), fill=Q12))
qn12
FM_surv_long = function(
qn, # question name as string (eg "Q16", "Q18_1" etc.)
data = fm_all5_49_filtered
){
qn_data = data[ ,c(1, grep(qn, names(data)))]
names(qn_data) = gsub("_Q.+$", "", names(qn_data)) # check it works for eg. Q14_3
qn_summ = qn_data %>% pivot_longer(
cols = starts_with("T"),
names_to = "Time",
names_prefix = "T",
values_to = qn
)
names(qn_summ)[1] = "ID"
}
qn12 = FM_surv_long(qn = "Q12")
ggplot(data = qn12) +
geom_mosaic(aes(x = product(ID, Time), fill=Q12))
qn12
FM_surv_long = function(
qn, # question name as string (eg "Q16", "Q18_1" etc.)
data = fm_all5_49_filtered
){
qn_data = data[ ,c(1, grep(qn, names(data)))]
names(qn_data) = gsub("_Q.+$", "", names(qn_data)) # check it works for eg. Q14_3
qn_summ = qn_data %>% pivot_longer(
cols = starts_with("T"),
names_to = "Time",
names_prefix = "T",
values_to = qn
)
names(qn_summ)[1] = "ID"
qn_summ
}
qn12 = FM_surv_long(qn = "Q12")
qn12
ggplot(data = qn12) +
geom_mosaic(aes(x = product(ID, Time), fill=Q12))
ggplot(data = qn12) +
geom_mosaic(aes(x = product(ID, Time), fill=Q12))+
xlab("Time") + ylab("Individual")
ggplot(data = qn12) +
geom_mosaic(aes(x = product(ID, Time), fill=Q12))+
xlab("Time") + ylab("Individual") +
scale_x_discrete(labels = Time)
ggplot(data = qn12) +
geom_mosaic(aes(x = product(ID, Time), fill=Q12))+
xlab("Time") + ylab("Individual") +
scale_x_discrete(labels = 2:4)
ggplot(data = qn12) +
geom_mosaic(aes(x = product(ID, Time), fill=Q12))+
xlab("Time") + ylab("Individual")
?geom_tile
?geom_raster
ggplot(data = qn12) +
geom_raster(aes(x = Time, y=ID, fill=Q12))+
xlab("Time") + ylab("Individual")
fm_all5_49_filtered
ggplot(data = qn12[order(qn12$Q12[qn12$Time == 2,])]) +
geom_raster(aes(x = Time, y=ID, fill=Q12))+
xlab("Time") + ylab("Individual")
ggplot(data = qn12[order(qn12$Q12[qn12$Time == 2]),]) +
geom_raster(aes(x = Time, y=ID, fill=Q12))+
xlab("Time") + ylab("Individual")
ggplot(data = qn12) +
geom_raster(aes(x = Time, y=ID, fill=Q12))+
xlab("Time") + ylab("Individual")
order(qn12$Q12[qn12$Time==2])
qn12$Q12[order(qn12$Q12[qn12$Time==2])]
qn12$Q12[rank(qn12$Q12[qn12$Time==2])]
qn12$Q12[qn12$Time==2]
order(qn12$Q12[qn12$Time==2])
qn12$Q12[order(qn12$Q12[qn12$Time==2])]
qn12[order(qn12$Q12[qn12$Time==2]), ]
ggplot(data = qn12[order(qn12$Q12[qn12$Time==2]), ]) +
geom_raster(aes(x = Time, y=ID, fill=Q12))+
xlab("Time") + ylab("Individual")
ggplot(data = qn12) +
geom_raster(aes(x = Time, y=ID, fill=Q12))+
xlab("Time") + ylab("Individual")
qn13 = FM_surv_long(qn = "Q13")
qn13 = FM_surv_long(qn = "Q13")
debug(FM_surv_long)
qn13 = FM_surv_long(qn = "Q13")
qn_data
dim(qn_data)
names(qn_data)
names(qn_data)
summary(fm_all5_49_filtered$T2_Q13)
summary(fm_all5_49_filtered$T3_Q13)
summary(fm_all5_49_filtered$T4_Q13)
summary(fm_all5_49_filtered$T5_Q13)
summary(fm_all5_49_filtered$T5_Q13)
qn13 = FM_surv_long(data = fm_all5_49_filtered[ ,-c("T5_Q13")], qn = "Q13")
undebug(FM_surv_long)
qn13 = FM_surv_long(data = fm_all5_49_filtered[ ,-c("T5_Q13")], qn = "Q13")
which(names(fm_all5_49_filtered) %in% c("T5_Q13"))
qn13 = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
ggplot(data = qn13) +
geom_raster(aes(x = Time, y=ID, fill=Q13))+
xlab("Time") + ylab("Individual")
ggplot(data = na.omit(qn13), aes(x=Time, fill=Q13)) + geom_bar()
ggplot(data = na.omit(qn13), aes(x=Time, fill=Q13)) + geom_bar() +
xlab("Time") + theme_bw()
ggplot(data = na.omit(qn13), aes(x=Time, fill=Q13)) + geom_bar() +
xlab("Time") + theme_bw()
ggplot(data = qn13) +
geom_raster(aes(x = Time, y=ID, fill=Q13))+
xlab("Time") + ylab("Individual")
ggplot(data = qn13) +
geom_raster(aes(x = Time, y=ID, fill=Q13))+
xlab("Time") + ylab("Individual")
load("/Users/rachelo/Downloads/Q1Q2_short_pt_ls.Rdata")
qn13_st = FM_surv_long("Q13")
qn13 = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
names(fm_all5_49_filtered)
qn16_t1 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T1_Q16", "Assigned number")]
qn16_t1
names(qn13)
qn16_13 = data.frame(
ID = qn16_t1$`Assigned number`,
Time = rep(1, nrow(qn16_t1)),
Q13 = qn16_t1$T1_Q16
)
summary(qn16_13)
qn13 = rbind(qn16_13, qn13)
qn13_t5 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T5_Q13", "Assigned number")]
names(qn13_t5)
qn13_5 = data.frame(
ID = qn13_t5$`Assigned number`,
Time = rep(1, nrow(qn13_t5)),
Q13 = qn13_t5$T5_Q13
)
qn13 = rbind(qn13, qn13_5)
table(qn13$Q13, useNA = "always")
dput(unique(qn13$Q13))
qn13$Q13[qn13$Q13 %in% c("Yes",
"Once", "A few times (2-4)", "Many times (5+)")] = "Yes"
table(qn13$Q13, useNA = "always")
table(qn13$Q13)
names(qn13)
names(qn13)[2] = "Survey"
## Event at survey 1
qn13_st = data.frame(
ID = qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 1)]
)
qn13_st
qn13_st$Survey = rep(1, nrow(qn13_st))
qn13_id2 = qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 2)]
qn13_id2 %in% qn13_st$ID
qn13_id2[!(qn13_id2 %in% qn13_st$ID)]
qn13_2 = data.frame(
ID = qn13_id2,
Survey = rep(2, length(qn13_id2))
)
qn13_st = rbind(qn13_st, qn13_2)
ggplot(data = qn13_st, aes(x=survey, y=Q13)) + geom_bar()
ggplot(data = qn13_st, aes(x=Survey, y=Q13)) + geom_bar()
ggplot(data = qn13_st, aes(x=Survey)) + geom_bar()
qn13_st
ggplot(data = qn13_st[!is.na(qn13_st$ID),], aes(x=Survey)) + geom_bar()
## Event at survey 1
qn13_st = data.frame(
ID = qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 1)]
)
qn13_st
qn13[qn13$Survey==1,]
qn13_id2 = qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 2)]
qn13_id2
qn13_id2 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 2)])
qn13_id2
qn13_id2 = qn13_id2[!(qn13_id2 %in% qn13_st$ID)]
qn13_id2
qn13_2 = data.frame(
ID = qn13_id2,
Survey = rep(2, length(qn13_id2))
)
qn13_st = rbind(qn13_st, qn13_2)
qn13_st
## Event at survey 1
qn13_st = data.frame(
ID = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 1)])
)
qn13_st$Survey = rep(1, nrow(qn13_st))
qn13_id2 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 2)])
qn13_id2 = qn13_id2[!(qn13_id2 %in% qn13_st$ID)]
qn13_2 = data.frame(
ID = qn13_id2,
Survey = rep(2, length(qn13_id2))
)
qn13_st = rbind(qn13_st, qn13_2)
qn13_st
qn13_id3 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 3)])
qn13_id3 = qn13_id3[!(qn13_id3 %in% qn13_st$ID)]
qn13_3 = data.frame(
ID = qn13_id3,
Survey = rep(3, length(qn13_id3))
)
qn13_st = rbind(qn13_st, qn13_3)
qn13_st
qn13_id4 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 4)])
qn13_id4 = qn13_id4[!(qn13_id4 %in% qn13_st$ID)]
qn13_4 = data.frame(
ID = qn13_id4,
Survey = rep(4, length(qn13_id4))
)
qn13_st = rbind(qn13_st, qn13_4)
qn13_st
qn13_id5 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 5)])
qn13_id5 = qn13_id5[!(qn13_id5 %in% qn13_st$ID)]
qn13_5 = data.frame(
ID = qn13_id5,
Survey = rep(5, length(qn13_id5))
)
qn13_st = rbind(qn13_st, qn13_5)
qn13_st
qn13_5
qn13_id5
qn13_id5 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 5)])
qn13_id5
qn13_t5 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T5_Q13", "Assigned number")]
names(qn13)
qn13_t5 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T5_Q13", "Assigned number")]
qn13_5 = data.frame(
ID = qn13_t5$`Assigned number`,
Survey = rep(5, nrow(qn13_t5)),
Q13 = qn13_t5$T5_Q13
)
qn13 = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
qn16_t1 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T1_Q16", "Assigned number")]
qn16_13 = data.frame(
ID = qn16_t1$`Assigned number`,
Time = rep(1, nrow(qn16_t1)),
Q13 = qn16_t1$T1_Q16
)
qn13 = rbind(qn16_13, qn13)
qn13_t5 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T5_Q13", "Assigned number")]
qn13_5 = data.frame(
ID = qn13_t5$`Assigned number`,
Survey = rep(5, nrow(qn13_t5)),
Q13 = qn13_t5$T5_Q13
)
qn13 = rbind(qn13, qn13_5)
qn13_5 = data.frame(
ID = qn13_t5$`Assigned number`,
Time = rep(5, nrow(qn13_t5)),
Q13 = qn13_t5$T5_Q13
)
qn13 = rbind(qn13, qn13_5)
qn13$Q13[qn13$Q13 %in% c("Yes",
"Once", "A few times (2-4)", "Many times (5+)")] = "Yes"
names(qn13)[2] = "Survey"
## Event at survey 1
qn13_st = data.frame(
ID = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 1)])
)
qn13_st$Survey = rep(1, nrow(qn13_st))
qn13_id2 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 2)])
qn13_id2 = qn13_id2[!(qn13_id2 %in% qn13_st$ID)]
qn13_2 = data.frame(
ID = qn13_id2,
Survey = rep(2, length(qn13_id2))
)
qn13_st = rbind(qn13_st, qn13_2)
qn13_id3 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 3)])
qn13_id3 = qn13_id3[!(qn13_id3 %in% qn13_st$ID)]
qn13_3 = data.frame(
ID = qn13_id3,
Survey = rep(3, length(qn13_id3))
)
qn13_st = rbind(qn13_st, qn13_3)
qn13_id4 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 4)])
qn13_id4 = qn13_id4[!(qn13_id4 %in% qn13_st$ID)]
qn13_4 = data.frame(
ID = qn13_id4,
Survey = rep(4, length(qn13_id4))
)
qn13_st = rbind(qn13_st, qn13_4)
qn13_id5 = na.omit(qn13$ID[(qn13$Q13 == "Yes")&(qn13$Survey == 5)])
qn13_id5
qn13_id5 = qn13_id5[!(qn13_id5 %in% qn13_st$ID)]
qn13_5 = data.frame(
ID = qn13_id5,
Survey = rep(5, length(qn13_id5))
)
qn13_st = rbind(qn13_st, qn13_5)
ggplot(data = qn13_st, aes(x=Survey, y=ID)) + geom_bar()
ggplot(data = qn13_st, aes(x=Survey)) + geom_bar()
ggplot(data = qn13_st, aes(x=Survey)) + geom_bar() + ylim(0,13)
ggplot(data = qn13_st, aes(x=Survey)) + geom_bar() + ylim(0,13) +
theme_bw()
ggplot(data = qn13_st, aes(x=Survey)) + geom_bar() + ylim(0,13) +
theme_bw()
274/30
274/31
qn13_st
dim(qn13_st)
dim(fm_all5_49_filtered)
49-27
sum(!(qn13_st$ID %in% fm_all5_49_filtered$`Assigned number`))
sum(!(fm_all5_49_filtered$`Assigned number` %in% qn13_st$ID))
qn13_yn = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
qn13_yn$Q13[qn13_yn$Q13 %in% c("Yes",
"Once", "A few times (2-4)", "Many times (5+)")] = "Yes"
names(qn13_yn)[2] = "Survey"
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual")
qn13_yn = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
qn13_yn$Q13
qn13_yn$Q13[qn13_yn$Q13 %in% c("Yes",
"Once", "A few times (2-4)", "Many times (5+)")]
qn13_yn$Q13[qn13_yn$Q13 %in% c("Yes",
"Once", "A few times (2-4)", "Many times (5+)")] = "Yes"
qn13_yn = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
q13_yn$Q13 = as.character(qn13_yn$Q13)
qn13_yn$Q13 = as.character(qn13_yn$Q13)
qn13_yn$Q13[qn13_yn$Q13 %in% c("Yes",
"Once", "A few times (2-4)", "Many times (5+)")] = "Yes"
table(qn13_yn$Q13)
qn13_yn$Q13 = as.character(qn13_yn$Q13)
table(qn13_yn$Q13)
qn13_yn = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
table(qn13_yn$Q13)
names(qn13_yn)[2] = "Survey"
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual")
qn13_yn$Q13 = as.character(qn13_yn$Q13)
qn13_yn$Q13[qn13_yn$Q13 %in% c("Yes",
"Once", "A few times (2-4)", "Many times (5+)")] = "Yes"
names(qn13_yn)[2] = "Survey"
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual")
qn16_t1 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T1_Q16", "Assigned number")]
qn16_13 = data.frame(
ID = qn16_t1$`Assigned number`,
Time = rep(1, nrow(qn16_t1)),
Q13 = qn16_t1$T1_Q16
)
qn13_yn = rbind(qn16_13, qn13_yn)
qn16_13 = data.frame(
ID = qn16_t1$`Assigned number`,
Survey = rep(1, nrow(qn16_t1)),
Q13 = qn16_t1$T1_Q16
)
qn13_yn = rbind(qn16_13, qn13_yn)
qn13_t5 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T5_Q13", "Assigned number")]
qn13_5 = data.frame(
ID = qn13_t5$`Assigned number`,
Survey = rep(5, nrow(qn13_t5)),
Q13 = qn13_t5$T5_Q13
)
qn13_yn = rbind(qn13_yn, qn13_5)
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual")
qn13_yn$Q13[qn13_yn$Q13 == "No"] = NA
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual")
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual") + theme(axis.text.y = element_blank())
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual") + theme(axis.text.y = element_blank(), axis.ticks = element_blank())
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual") + theme(axis.text.y = element_blank(), axis.ticks = element_blank()) + theme_bw()
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual") + theme(axis.text.y = element_blank(), axis.ticks = element_blank())
ggplot(data = qn13_yn) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual") + theme(axis.text.y = element_blank(), axis.ticks = element_blank())
df700 = read.csv("Downloads/participant_data (4).csv", header=T)
part1 = read.csv("Downloads/participant_data.csv", header=T)
df700 = read.csv("/Users/rachelo/Downloads/participant_data (4).csv", header=T)
df700$arm = sample(c("A", "B"), size=700, replace=T)
write.csv(df700, file = "/Users/rachelo/Downloads/alloc_700.csv", row.names=F, quote=F)
res700  = read.csv("/Users/rachelo/Downloads/trial_results (2).csv", header=T)
names(res700)
cox700 = coxph(Surv(eventtime, status) ~ Age + DiseaseLevel + arm, data = res700)
summary(cox700)
cox.zph(cox700)
plot(cox.zph(cox700))
ggcoxzph(cox.zph(cox700), var = "Age")
fm_all5_49_filtered[ ,c("T2_Q12", "T2_Q13")]
names(fm_all5_49_filtered)
fm_all5_49_filtered$T1_Q17
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyverse)
library(ggmosaic)
library(knitr)
qn17_t1 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T1_Q17", "Assigned number")]
qn17_freq = data.frame(
ID = qn17_t1$`Assigned number`,
Survey = rep(1, nrow(qn17_t1)),
Q13 = qn17_t1$T1_Q17
)
qn17_freq = rbing(qn17_freq, qn13_freq)
qn17_freq = rbind(qn17_freq, qn13_freq)
qn13_freq = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
qn17_freq = rbind(qn17_freq, qn13_freq)
names(qn13_freq)
names(qn13_freq)[2] = "Survey"
qn17_freq = rbind(qn17_freq, qn13_freq)
qn14_t5 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T5_Q14", "Assigned number")]
qn14_t5
qn13_freq = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
names(qn13_freq)[2] = "Survey"
qn17_t1 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T1_Q17", "Assigned number")]
qn17_freq = data.frame(
ID = qn17_t1$`Assigned number`,
Survey = rep(1, nrow(qn17_t1)),
Q13 = qn17_t1$T1_Q17
)
qn13_freq = rbind(qn17_freq, qn13_freq)
qn14_t5 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T5_Q14", "Assigned number")]
qn14_freq = data.frame(
ID = qn14_t5$`Assigned number`,
Survey = rep(1, nrow(qn14_t5)),
Q13 = qn14_t5$T5_Q14
)
qn13_freq = rbind(qn14_freq, qn13_freq)
ggplot(data = qn13_freq) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual") + theme(axis.text.y = element_blank(), axis.ticks = element_blank())
ggplot(data = qn13_freq) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual") + theme(axis.text.y = element_blank(), axis.ticks = element_blank())
qn13_freq = FM_surv_long(data = fm_all5_49_filtered[ ,-which(names(fm_all5_49_filtered) %in% c("T5_Q13"))], qn = "Q13")
names(qn13_freq)[2] = "Survey"
qn17_t1 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T1_Q17", "Assigned number")]
qn17_freq = data.frame(
ID = qn17_t1$`Assigned number`,
Survey = rep(1, nrow(qn17_t1)),
Q13 = qn17_t1$T1_Q17
)
qn13_freq = rbind(qn17_freq, qn13_freq)
qn14_t5 = fm_all5_49_filtered[ ,names(fm_all5_49_filtered)%in%c("T5_Q14", "Assigned number")]
qn14_freq = data.frame(
ID = qn14_t5$`Assigned number`,
Survey = rep(5, nrow(qn14_t5)),
Q13 = qn14_t5$T5_Q14
)
qn13_freq = rbind(qn14_freq, qn13_freq)
ggplot(data = qn13_freq) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual") + theme(axis.text.y = element_blank(), axis.ticks = element_blank())
ggplot(data = qn13_freq) +
geom_raster(aes(x = Survey, y=ID, fill=Q13))+
xlab("Survey") + ylab("Individual") + theme(axis.text.y = element_blank(), axis.ticks = element_blank())
cheese = read.csv("kroger.csv", header=T)
cheese$city = as.factor(cheese$city)
ggplot(data=cheese, aes(x=price, y=vol, col=city)) + geom_point()
# Firstly we define functions for the estimates
between.var = function(
data,
groupvec
){
groups = levels(as.factor(groupvec))
ng = length(groups)
ntot = length(data)
means = sapply(1:ng, function(i){mean(data[groupvec == groups[i]])})
njvec = sapply(1:ng, function(i){length(data[groupvec == groups[i]])})
mean = mean(data)
ssqvec = sapply(1:ng, function(i){(njvec[i]*(means[i]-mean)^2)})
sum(ssqvec)/(ntot-ng)
}
within.var = function(
data,
groupvec
){
groups = levels(as.factor(groupvec))
ng = length(groups)
ntot = length(data)
means = sapply(1:ng, function(i){mean(data[groupvec == groups[i]])})
njvec = sapply(1:ng, function(i){length(data[groupvec == groups[i]])})
g_sums = rep(NA, ng)
for (j in 1:ng){
data_j = data[groupvec == groups[j]]
ssqvec = rep(NA, njvec[j])
for (i in 1:njvec[j]){
ssqvec[i] = (data_j[i] - means[j])^2
}
g_sums[j] = sum(ssqvec)/(ntot - ng)
}
sum(g_sums)
}
wv_price = within.var(cheese$price, cheese$city)
wv_price
bv_price = between.var(cheese$price, cheese$city)
bv_price
icc = bv_price / (bv_price + wv_price)
icc
mean(cheese$price)
sqrt(bv_price)
### for github:
# work macbook
setwd("/Users/rachelo/Documents/GitRepos/ct4")
bookdown::render_book("index.Rmd", "bookdown::gitbook")
bookdown::render_book("index.Rmd", "bookdown::pdf_book")
